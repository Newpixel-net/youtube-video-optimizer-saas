<!-- ================================================================
     YOUTUBE VIDEO OPTIMIZER - AI TOOLS HUB
     ================================================================

     Structure:
     - SECTION 1: External Dependencies (CDN)
     - SECTION 2: Styles (CSS)
     - SECTION 3: HTML Container
     - SECTION 4: Scripts (JavaScript)

     Tools:
     - AI Script Studio - Full script generation from topic
     - Viral Hook Laboratory - Hook optimization and A/B testing
     - Content Multiplier - Repurpose video into multiple formats
     - Thumbnail A/B Arena - CTR prediction and analysis

     Access: All authenticated users (with token system)

     Main Dashboard URL: https://ytseo.siteuo.com/video-optimizer

     Last Updated: 2024
     ================================================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>AI Tools Hub - YouTube Video Optimizer</title>

    <!-- ============================================
         SECTION 1: EXTERNAL DEPENDENCIES
         ============================================ -->

    <!-- 1.1 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1.2 Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>

    <!-- ============================================
         SECTION 2: STYLES
         ============================================ -->
    <style>
        /* ------------------------------------------
           2.1 BASE & RESET
           ------------------------------------------ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: white;
        }

        #app-root {
            width: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        /* ------------------------------------------
           2.2 ANIMATIONS
           ------------------------------------------ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }

        /* ------------------------------------------
           2.3 HERO SECTION
           ------------------------------------------ */
        .hero-section {
            position: relative;
            padding: 2rem 1.5rem 1rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at top right, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom left, rgba(168, 85, 247, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        /* ------------------------------------------
           2.4 STATS BAR
           ------------------------------------------ */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1rem 0;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 2rem;
            font-size: 0.85rem;
        }

        .stat-item .stat-icon {
            font-size: 1rem;
        }

        .stat-item .stat-value {
            font-weight: 700;
            color: white;
        }

        .stat-item .stat-label {
            color: rgba(255, 255, 255, 0.5);
        }

        /* ------------------------------------------
           2.5 CATEGORY SECTIONS
           ------------------------------------------ */
        .category-section {
            margin-bottom: 2rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .category-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .category-title {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            letter-spacing: 0.025em;
        }

        .category-count {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            margin-left: auto;
        }

        .category-toggle {
            display: none;
        }

        /* Mobile collapsible categories */
        @media (max-width: 768px) {
            .category-header {
                cursor: pointer;
                user-select: none;
                padding: 0.875rem 1rem;
                margin-bottom: 0;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 0.75rem;
                border: 1px solid rgba(255, 255, 255, 0.06);
                transition: all 0.3s ease;
            }

            .category-header:hover {
                background: rgba(255, 255, 255, 0.04);
            }

            .category-toggle {
                display: block;
                width: 20px;
                height: 20px;
                margin-left: auto;
                position: relative;
            }

            .category-toggle::before,
            .category-toggle::after {
                content: '';
                position: absolute;
                background: rgba(255, 255, 255, 0.5);
                transition: transform 0.3s ease;
            }

            .category-toggle::before {
                width: 12px;
                height: 2px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .category-toggle::after {
                width: 2px;
                height: 12px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .category-section.expanded .category-toggle::after {
                transform: translate(-50%, -50%) rotate(90deg);
                opacity: 0;
            }

            .category-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.3s ease;
                opacity: 0;
            }

            .category-section.expanded .category-content {
                max-height: 2000px;
                opacity: 1;
                padding-top: 1rem;
            }

            .category-section {
                margin-bottom: 0.75rem;
            }

            .category-count {
                margin-left: 0;
                margin-right: 0.5rem;
            }
        }

        /* ------------------------------------------
           2.6 TOOL CARDS - GLASSMORPHISM
           ------------------------------------------ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
        }

        @media (max-width: 1600px) {
            .tools-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 1400px) {
            .tools-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1100px) {
            .tools-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            animation: cardFadeIn 0.5s ease forwards;
        }

        .tool-card:nth-child(1) { animation-delay: 0.05s; }
        .tool-card:nth-child(2) { animation-delay: 0.1s; }
        .tool-card:nth-child(3) { animation-delay: 0.15s; }
        .tool-card:nth-child(4) { animation-delay: 0.2s; }

        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tool-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 1rem;
            padding: 1px;
            background: linear-gradient(135deg, var(--accent-start, transparent), var(--accent-end, transparent));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .tool-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .tool-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        0 0 40px var(--glow-color, rgba(99, 102, 241, 0.15));
            background: rgba(255, 255, 255, 0.05);
        }

        .tool-card:hover::before {
            opacity: 1;
        }

        .tool-card:hover::after {
            left: 100%;
        }

        .tool-card.script-studio { --accent-start: #f59e0b; --accent-end: #ef4444; --glow-color: rgba(245, 158, 11, 0.2); }
        .tool-card.hook-lab { --accent-start: #ec4899; --accent-end: #8b5cf6; --glow-color: rgba(236, 72, 153, 0.2); }
        .tool-card.content-multiplier { --accent-start: #10b981; --accent-end: #3b82f6; --glow-color: rgba(16, 185, 129, 0.2); }
        .tool-card.thumbnail-arena { --accent-start: #6366f1; --accent-end: #a855f7; --glow-color: rgba(99, 102, 241, 0.2); }
        .tool-card.trend-hijacker { --accent-start: #f97316; --accent-end: #eab308; --glow-color: rgba(249, 115, 22, 0.2); }
        .tool-card.gap-finder { --accent-start: #14b8a6; --accent-end: #06b6d4; --glow-color: rgba(20, 184, 166, 0.2); }
        .tool-card.audience-dna { --accent-start: #8b5cf6; --accent-end: #d946ef; --glow-color: rgba(139, 92, 246, 0.2); }
        .tool-card.collab-match { --accent-start: #0ea5e9; --accent-end: #6366f1; --glow-color: rgba(14, 165, 233, 0.2); }
        .tool-card.revenue-max { --accent-start: #22c55e; --accent-end: #eab308; --glow-color: rgba(34, 197, 94, 0.2); }
        .tool-card.ai-coach { --accent-start: #f43f5e; --accent-end: #fb923c; --glow-color: rgba(244, 63, 94, 0.2); }

        .tool-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .tool-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.35rem;
            flex-shrink: 0;
        }

        .tool-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .tool-card h3 {
            font-size: 0.95rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .tool-card p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            line-height: 1.5;
            margin-bottom: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .tool-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .tool-tokens {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tool-time {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .tool-cta {
            position: absolute;
            bottom: 1.25rem;
            right: 1.25rem;
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .tool-card:hover .tool-cta {
            opacity: 1;
            transform: translateX(0);
        }

        .tool-card:hover .tool-time {
            opacity: 0;
        }

        /* ------------------------------------------
           2.5 TOOL VIEWS
           ------------------------------------------ */
        .tool-view {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tool-view.active {
            display: block;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.75rem;
            padding: 1rem;
            color: white;
            font-size: 1rem;
            width: 100%;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
            padding: 0.875rem 1.5rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 500;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ------------------------------------------
           2.6 RESULTS SECTIONS
           ------------------------------------------ */
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .result-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
        }

        .copy-btn {
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        /* ------------------------------------------
           2.7 TOKEN DISPLAY
           ------------------------------------------ */
        .token-display {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 0.75rem;
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ------------------------------------------
           2.8 TABS
           ------------------------------------------ */
        .tab-container {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: rgba(99, 102, 241, 0.3);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        /* ------------------------------------------
           2.9 LOADING STATES
           ------------------------------------------ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-card {
            background: linear-gradient(145deg, rgba(30, 30, 50, 0.95) 0%, rgba(20, 20, 35, 0.98) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            padding: 2.5rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1.5rem;
        }

        /* ------------------------------------------
           2.10 SCROLLBAR
           ------------------------------------------ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ------------------------------------------
           2.11 RESPONSIVE
           ------------------------------------------ */
        @media (max-width: 768px) {
            .hero-section {
                padding: 1.5rem 1rem;
            }

            .tool-card {
                padding: 1.25rem;
            }

            .tool-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }

        /* ------------------------------------------
           2.12 OPTION CARDS
           ------------------------------------------ */
        .option-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
        }

        .option-card.selected {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
        }

        /* History panel */
        .history-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- ============================================
         SECTION 3: HTML CONTAINER
         ============================================ -->
    <div id="app-root"></div>

    <!-- ============================================
         SECTION 4: SCRIPTS
         ============================================ -->
    <script>
    (function() {
        'use strict';

        /* ==========================================
           4.1 FIREBASE CONFIGURATION
           ========================================== */

        if (typeof firebase === 'undefined') {
            console.error('Firebase SDK not loaded');
            document.getElementById('app-root').innerHTML =
                '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;padding:2rem;">' +
                '<div style="text-align:center;color:white;">' +
                '<h2 style="color:#ef4444;margin-bottom:1rem;">Error Loading Page</h2>' +
                '<p style="color:#9ca3af;">Failed to load Firebase. Please refresh the page.</p></div></div>';
            return;
        }

        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAGczY5ZEIJdTq25BpQdia3lv2I556wOZo",
            authDomain: "ytseo-6d1b0.firebaseapp.com",
            projectId: "ytseo-6d1b0",
            storageBucket: "ytseo-6d1b0.firebasestorage.app",
            messagingSenderId: "382790048044",
            appId: "1:382790048044:web:cd427679ff72108c1f3489"
        };

        firebase.initializeApp(FIREBASE_CONFIG);
        const auth = firebase.auth();
        const functions = firebase.functions();
        const db = firebase.firestore();

        /* ==========================================
           4.2 APPLICATION STATE
           ========================================== */

        const state = {
            currentView: 'initializing', // initializing | hub | script | hooks | multiplier | thumbnail | trends | gaps | audience | collab | revenue | coach | history
            user: null,
            profile: null,
            loading: false,
            error: null,
            success: null,

            // Token system
            tokens: {
                balance: 0,
                plan: 'free',
                rollover: 0
            },

            // Tool-specific state
            // AI Script Studio
            script: {
                topic: '',
                tone: 'engaging',
                length: 'medium',
                includeHook: true,
                includeCTA: true,
                result: null,
                history: []
            },

            // Viral Hook Laboratory
            hooks: {
                topic: '',
                style: 'question',
                count: 5,
                result: null,
                history: []
            },

            // Content Multiplier
            multiplier: {
                videoUrl: '',
                transcript: '',
                formats: ['shorts', 'twitter', 'blog'],
                result: null,
                history: []
            },

            // Thumbnail A/B Arena
            thumbnailArena: {
                thumbnails: [],
                analysisResult: null,
                history: []
            },

            // Trend Hijacker
            trends: {
                niche: '',
                region: 'US',
                timeframe: 'week',
                result: null,
                history: []
            },

            // Content Gap Finder
            gaps: {
                niche: '',
                competitors: '',
                depth: 'moderate',
                result: null,
                history: []
            },

            // Audience DNA Analyzer
            audience: {
                niche: '',
                channelUrl: '',
                depth: 'standard',
                result: null,
                history: []
            },

            // Collab Matchmaker
            collab: {
                niche: '',
                channelSize: 'any',
                contentStyle: 'any',
                result: null,
                history: []
            },

            // Revenue Maximizer Pro
            revenue: {
                niche: '',
                audienceSize: 'small',
                currentMethods: [],
                result: null,
                history: []
            },

            // AI Video Coach
            coach: {
                videoUrl: '',
                transcript: '',
                challenge: '',
                focusArea: 'general',
                result: null,
                history: []
            },

            // History view
            historyType: 'script' // script | hooks | multiplier | thumbnail | trends | gaps | audience | collab | revenue | coach
        };

        /* ==========================================
           4.3 UTILITY FUNCTIONS
           ========================================== */

        const utils = {
            escapeHtml: function(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            formatDate: function(timestamp) {
                if (!timestamp) return '';
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            copyToClipboard: function(text, btn) {
                navigator.clipboard.writeText(text).then(function() {
                    const originalText = btn.textContent;
                    btn.textContent = 'Copied!';
                    btn.style.background = 'rgba(16, 185, 129, 0.3)';
                    setTimeout(function() {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 2000);
                });
            },

            showToast: function(message, type) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 right-4 px-4 py-3 rounded-lg text-white font-medium z-50 fade-in';
                toast.style.background = type === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' :
                                         type === 'error' ? 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)' :
                                         'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(function() {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(10px)';
                    setTimeout(function() { toast.remove(); }, 300);
                }, 3000);
            }
        };

        /* ==========================================
           4.4 RENDER FUNCTION
           ========================================== */

        function render() {
            const root = document.getElementById('app-root');
            let html = '';

            // Loading overlay
            if (state.loading) {
                html += renderLoading();
            }

            // Main content based on view
            switch (state.currentView) {
                case 'initializing':
                    html += renderInitializing();
                    break;
                case 'login':
                    html += renderLoginPrompt();
                    break;
                case 'hub':
                    html += renderHub();
                    break;
                case 'script':
                    html += renderScriptStudio();
                    break;
                case 'hooks':
                    html += renderHookLab();
                    break;
                case 'multiplier':
                    html += renderContentMultiplier();
                    break;
                case 'thumbnail':
                    html += renderThumbnailArena();
                    break;
                case 'history':
                    html += renderHistory();
                    break;
                case 'trends':
                    html += renderTrendHijacker();
                    break;
                case 'gaps':
                    html += renderContentGapFinder();
                    break;
                case 'audience':
                    html += renderAudienceDNA();
                    break;
                case 'collab':
                    html += renderCollabMatchmaker();
                    break;
                case 'revenue':
                    html += renderRevenueMaximizer();
                    break;
                case 'coach':
                    html += renderAICoach();
                    break;
                default:
                    html += renderHub();
            }

            root.innerHTML = html;
            attachEventListeners();
        }

        /* ==========================================
           4.5 VIEW RENDERERS
           ========================================== */

        function renderInitializing() {
            return '<div class="flex items-center justify-center min-h-screen">' +
                '<div class="text-center">' +
                '<div class="spinner mb-4"></div>' +
                '<p class="text-gray-400">Loading AI Tools...</p>' +
                '</div></div>';
        }

        function renderLoginPrompt() {
            return '<div class="flex items-center justify-center min-h-screen p-4">' +
                '<div class="bg-gray-800/50 border border-gray-700 rounded-2xl p-8 text-center max-w-md">' +
                '<div class="text-5xl mb-4">üîê</div>' +
                '<h2 class="text-2xl font-bold text-white mb-2">Sign In Required</h2>' +
                '<p class="text-gray-400 mb-6">Please sign in to access AI Tools</p>' +
                '<a href="/video-optimizer" class="btn-primary inline-block">Go to Dashboard</a>' +
                '</div></div>';
        }

        function renderLoading() {
            return '<div class="loading-overlay">' +
                '<div class="loading-card">' +
                '<div class="spinner"></div>' +
                '<h3 class="text-xl font-bold text-white mb-2">Processing...</h3>' +
                '<p class="text-gray-400">AI is working its magic</p>' +
                '</div></div>';
        }

        function renderHub() {
            var html = '';

            // Header
            html += '<div class="hero-section relative z-10">';
            html += '<div style="max-width: 1800px; margin: 0 auto;">';
            html += '<div class="flex items-center justify-between mb-4">';
            html += '<a href="/video-optimizer" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors text-sm">';
            html += '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>';
            html += '<span>Back to Dashboard</span>';
            html += '</a>';
            html += '<div class="flex items-center gap-3">';
            html += '<button onclick="app.navigateTo(\'history\')" class="flex items-center gap-2 px-3 py-1.5 bg-gray-800/60 hover:bg-gray-700/60 border border-gray-700 rounded-lg text-gray-300 hover:text-white transition-all text-sm">';
            html += '<span>üìú</span>';
            html += '<span class="font-medium">History</span>';
            html += '</button>';
            html += '<div class="token-display">';
            html += '<span class="text-lg">ü™ô</span>';
            html += '<span class="font-bold text-white">' + state.tokens.balance + '</span>';
            html += '<span class="text-gray-400 text-sm">tokens</span>';
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Title
            html += '<div class="text-center mb-4">';
            html += '<h1 class="text-3xl md:text-4xl font-bold text-white mb-2">';
            html += '<span class="bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">AI Tools Hub</span>';
            html += '</h1>';
            html += '<p class="text-gray-400">Powerful AI tools to supercharge your YouTube content</p>';
            html += '</div>';

            // Stats Bar
            html += '<div class="stats-bar">';
            html += '<div class="stat-item"><span class="stat-icon">üõ†Ô∏è</span><span class="stat-value">10</span><span class="stat-label">Tools</span></div>';
            html += '<div class="stat-item"><span class="stat-icon">ü™ô</span><span class="stat-value">' + state.tokens.balance + '</span><span class="stat-label">Available</span></div>';
            html += '<div class="stat-item"><span class="stat-icon">‚≠ê</span><span class="stat-value">Script Studio</span><span class="stat-label">Popular</span></div>';
            html += '<div class="stat-item"><span class="stat-icon">‚ö°</span><span class="stat-value">3-10</span><span class="stat-label">Token Range</span></div>';
            html += '</div>';

            html += '</div></div>';

            // Main Content
            html += '<div style="max-width: 1800px; margin: 0 auto; padding: 1.5rem 1rem;">';

            // Category 1: Content Creation (expanded by default on mobile)
            html += '<div class="category-section expanded" data-category="1">';
            html += '<div class="category-header" onclick="app.toggleCategory(1)">';
            html += '<div class="category-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">‚úèÔ∏è</div>';
            html += '<span class="category-title">Content Creation</span>';
            html += '<span class="category-count">3 tools</span>';
            html += '<span class="category-toggle"></span>';
            html += '</div>';
            html += '<div class="category-content">';
            html += '<div class="tools-grid">';
            html += renderToolCard('script', 'script-studio', 'üé¨', 'AI Script Studio', 'From idea to full video script in 60 seconds with hooks & CTAs.', 5, '~60s', 'Popular', '#f59e0b', '#ef4444', 'text-amber-400');
            html += renderToolCard('hooks', 'hook-lab', 'üé£', 'Viral Hook Lab', 'Win the first 3 seconds. Generate winning hooks with AI prediction.', 3, '~30s', 'Impact', '#ec4899', '#8b5cf6', 'text-pink-400');
            html += renderToolCard('multiplier', 'content-multiplier', 'üîÑ', 'Content Multiplier', 'One video becomes 30 pieces. Extract Shorts, threads & more.', 8, '~2m', '10x', '#10b981', '#3b82f6', 'text-emerald-400');
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Category 2: Visual & CTR (collapsed by default on mobile)
            html += '<div class="category-section" data-category="2">';
            html += '<div class="category-header" onclick="app.toggleCategory(2)">';
            html += '<div class="category-icon" style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);">üé®</div>';
            html += '<span class="category-title">Visual & CTR</span>';
            html += '<span class="category-count">1 tool</span>';
            html += '<span class="category-toggle"></span>';
            html += '</div>';
            html += '<div class="category-content">';
            html += '<div class="tools-grid">';
            html += renderToolCard('thumbnail', 'thumbnail-arena', 'üìä', 'Thumbnail A/B Arena', 'Never guess which thumbnail wins. AI predicts CTR instantly.', 4, '~45s', 'CTR+', '#6366f1', '#a855f7', 'text-indigo-400');
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Category 3: Research & Discovery (collapsed by default on mobile)
            html += '<div class="category-section" data-category="3">';
            html += '<div class="category-header" onclick="app.toggleCategory(3)">';
            html += '<div class="category-icon" style="background: linear-gradient(135deg, #f97316 0%, #14b8a6 100%);">üîç</div>';
            html += '<span class="category-title">Research & Discovery</span>';
            html += '<span class="category-count">3 tools</span>';
            html += '<span class="category-toggle"></span>';
            html += '</div>';
            html += '<div class="category-content">';
            html += '<div class="tools-grid">';
            html += renderToolCard('trends', 'trend-hijacker', 'üéØ', 'Trend Hijacker', 'Catch trending topics before they peak. Early-mover advantage.', 6, '~90s', 'üî• Hot', '#f97316', '#eab308', 'text-orange-400');
            html += renderToolCard('gaps', 'gap-finder', 'üó∫Ô∏è', 'Content Gap Finder', 'Discover untapped opportunities competitors missed.', 6, '~90s', 'Opportunity', '#14b8a6', '#06b6d4', 'text-teal-400');
            html += renderToolCard('audience', 'audience-dna', 'üß¨', 'Audience DNA', 'Decode your audience psychology. Deep demographic insights.', 7, '~2m', 'Deep', '#8b5cf6', '#d946ef', 'text-purple-400');
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Category 4: Growth & Revenue (collapsed by default on mobile)
            html += '<div class="category-section" data-category="4">';
            html += '<div class="category-header" onclick="app.toggleCategory(4)">';
            html += '<div class="category-icon" style="background: linear-gradient(135deg, #22c55e 0%, #f43f5e 100%);">üìà</div>';
            html += '<span class="category-title">Growth & Revenue</span>';
            html += '<span class="category-count">3 tools</span>';
            html += '<span class="category-toggle"></span>';
            html += '</div>';
            html += '<div class="category-content">';
            html += '<div class="tools-grid">';
            html += renderToolCard('collab', 'collab-match', 'ü§ù', 'Collab Matchmaker', 'Find perfect collaboration partners with audience overlap.', 5, '~60s', 'Growth', '#0ea5e9', '#6366f1', 'text-sky-400');
            html += renderToolCard('revenue', 'revenue-max', 'üí∞', 'Revenue Maximizer', 'Unlock hidden revenue streams with pricing guides & pitches.', 8, '~2m', 'üíµ', '#22c55e', '#eab308', 'text-green-400');
            html += renderToolCard('coach', 'ai-coach', 'üß†', 'AI Video Coach', 'Personal YouTube mentor for retention, engagement & growth.', 10, '~3m', 'Premium', '#f43f5e', '#fb923c', 'text-rose-400');
            html += '</div>';
            html += '</div>';
            html += '</div>';

            html += '</div>'; // End container

            return html;
        }

        function renderToolCard(view, cardClass, icon, title, desc, tokens, time, badge, gradStart, gradEnd, tokenColor) {
            var html = '';
            html += '<div class="tool-card ' + cardClass + '" onclick="app.navigateTo(\'' + view + '\')">';
            html += '<div class="tool-card-header">';
            html += '<div class="tool-icon" style="background: linear-gradient(135deg, ' + gradStart + ' 0%, ' + gradEnd + ' 100%);">' + icon + '</div>';
            html += '<div class="tool-badge" style="background: linear-gradient(135deg, ' + gradStart + ' 0%, ' + gradEnd + ' 100%);">' + badge + '</div>';
            html += '</div>';
            html += '<h3>' + title + '</h3>';
            html += '<p>' + desc + '</p>';
            html += '<div class="tool-meta">';
            html += '<div class="tool-tokens ' + tokenColor + '"><span>ü™ô</span><span>' + tokens + '</span></div>';
            html += '<span class="tool-time">' + time + '</span>';
            html += '<span class="tool-cta">Try Now ‚Üí</span>';
            html += '</div>';
            html += '</div>';
            return html;
        }

        function renderScriptStudio() {
            var html = '';

            // Header
            html += renderToolHeader('AI Script Studio', 'üé¨', 'script-studio', '5 tokens per script');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.script.result) {
                // Show results
                html += renderScriptResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Topic input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Video Topic / Idea</label>';
                html += '<textarea id="script-topic" class="input-field h-24" placeholder="Enter your video topic or idea... e.g., \'10 productivity hacks for remote workers\' or \'Why AI will change everything in 2025\'">' + utils.escapeHtml(state.script.topic) + '</textarea>';
                html += '</div>';

                // Tone selection
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Script Tone</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var tones = [
                    { id: 'engaging', name: 'Engaging', icon: 'üéØ' },
                    { id: 'educational', name: 'Educational', icon: 'üìö' },
                    { id: 'entertaining', name: 'Entertaining', icon: 'üéâ' },
                    { id: 'professional', name: 'Professional', icon: 'üíº' }
                ];
                tones.forEach(function(tone) {
                    var selected = state.script.tone === tone.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setScriptTone(\'' + tone.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + tone.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + tone.name + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Length selection
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Script Length</label>';
                html += '<div class="grid grid-cols-3 gap-3">';
                var lengths = [
                    { id: 'short', name: 'Short', desc: '3-5 min', icon: '‚ö°' },
                    { id: 'medium', name: 'Medium', desc: '8-12 min', icon: 'üìù' },
                    { id: 'long', name: 'Long', desc: '15-20 min', icon: 'üìñ' }
                ];
                lengths.forEach(function(len) {
                    var selected = state.script.length === len.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setScriptLength(\'' + len.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + len.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + len.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + len.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Options
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Include</label>';
                html += '<div class="flex flex-wrap gap-4">';
                html += '<label class="flex items-center gap-2 cursor-pointer">';
                html += '<input type="checkbox" id="include-hook" ' + (state.script.includeHook ? 'checked' : '') + ' class="w-5 h-5 rounded accent-indigo-500">';
                html += '<span class="text-gray-300">Opening Hook</span>';
                html += '</label>';
                html += '<label class="flex items-center gap-2 cursor-pointer">';
                html += '<input type="checkbox" id="include-cta" ' + (state.script.includeCTA ? 'checked' : '') + ' class="w-5 h-5 rounded accent-indigo-500">';
                html += '<span class="text-gray-300">Call-to-Action</span>';
                html += '</label>';
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.generateScript()" class="btn-primary w-full text-lg py-4" ' + (state.loading ? 'disabled' : '') + '>';
                html += '<span class="text-xl mr-2">üé¨</span> Generate Script';
                html += '</button>';

                html += '</div>'; // End form card
            }

            html += '</div>'; // End container

            return html;
        }

        function renderScriptResults() {
            var html = '';
            var result = state.script.result;

            html += '<div class="mb-6">';
            html += '<button onclick="app.clearScriptResult()" class="btn-secondary mb-4">';
            html += '‚Üê Create New Script';
            html += '</button>';
            html += '</div>';

            // Script sections
            if (result.hook) {
                html += '<div class="result-card mb-4">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h3 class="text-lg font-bold text-amber-400">üé£ Opening Hook</h3>';
                html += '<button class="copy-btn" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result.hook).replace(/'/g, "\\'") + '\', this)">Copy</button>';
                html += '</div>';
                html += '<p class="text-gray-300 whitespace-pre-wrap">' + utils.escapeHtml(result.hook) + '</p>';
                html += '</div>';
            }

            if (result.intro) {
                html += '<div class="result-card mb-4">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h3 class="text-lg font-bold text-blue-400">üìñ Introduction</h3>';
                html += '<button class="copy-btn" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result.intro).replace(/'/g, "\\'") + '\', this)">Copy</button>';
                html += '</div>';
                html += '<p class="text-gray-300 whitespace-pre-wrap">' + utils.escapeHtml(result.intro) + '</p>';
                html += '</div>';
            }

            if (result.mainContent) {
                html += '<div class="result-card mb-4">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h3 class="text-lg font-bold text-green-400">üìù Main Content</h3>';
                html += '<button class="copy-btn" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result.mainContent).replace(/'/g, "\\'") + '\', this)">Copy</button>';
                html += '</div>';
                html += '<p class="text-gray-300 whitespace-pre-wrap">' + utils.escapeHtml(result.mainContent) + '</p>';
                html += '</div>';
            }

            if (result.cta) {
                html += '<div class="result-card mb-4">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h3 class="text-lg font-bold text-purple-400">üéØ Call-to-Action</h3>';
                html += '<button class="copy-btn" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result.cta).replace(/'/g, "\\'") + '\', this)">Copy</button>';
                html += '</div>';
                html += '<p class="text-gray-300 whitespace-pre-wrap">' + utils.escapeHtml(result.cta) + '</p>';
                html += '</div>';
            }

            // Full script copy
            html += '<div class="mt-6 text-center">';
            html += '<button class="btn-primary" onclick="app.copyFullScript()">üìã Copy Full Script</button>';
            html += '</div>';

            return html;
        }

        function renderHookLab() {
            var html = '';

            // Header
            html += renderToolHeader('Viral Hook Laboratory', 'üé£', 'hook-lab', '3 tokens per generation');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.hooks.result) {
                // Show results
                html += renderHookResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Topic input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Video Topic</label>';
                html += '<input type="text" id="hook-topic" class="input-field" placeholder="What is your video about?" value="' + utils.escapeHtml(state.hooks.topic) + '">';
                html += '</div>';

                // Hook style
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Hook Style</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                var styles = [
                    { id: 'question', name: 'Question', icon: '‚ùì', desc: 'Spark curiosity' },
                    { id: 'controversy', name: 'Controversy', icon: 'üî•', desc: 'Challenge beliefs' },
                    { id: 'promise', name: 'Promise', icon: 'üéÅ', desc: 'Value proposition' },
                    { id: 'story', name: 'Story', icon: 'üìñ', desc: 'Personal narrative' },
                    { id: 'statistic', name: 'Statistic', icon: 'üìä', desc: 'Shocking data' },
                    { id: 'challenge', name: 'Challenge', icon: 'üí™', desc: 'Direct challenge' }
                ];
                styles.forEach(function(style) {
                    var selected = state.hooks.style === style.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setHookStyle(\'' + style.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + style.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + style.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + style.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Number of hooks
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Number of Hooks</label>';
                html += '<div class="flex gap-2">';
                [3, 5, 10].forEach(function(num) {
                    var selected = state.hooks.count === num ? 'bg-indigo-600' : 'bg-gray-700';
                    html += '<button onclick="app.setHookCount(' + num + ')" class="px-4 py-2 rounded-lg font-medium ' + selected + '">' + num + '</button>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.generateHooks()" class="btn-primary w-full text-lg py-4" ' + (state.loading ? 'disabled' : '') + '>';
                html += '<span class="text-xl mr-2">üé£</span> Generate Hooks';
                html += '</button>';

                html += '</div>'; // End form card
            }

            html += '</div>'; // End container

            return html;
        }

        function renderHookResults() {
            var html = '';
            var result = state.hooks.result;

            html += '<div class="mb-6">';
            html += '<button onclick="app.clearHookResult()" class="btn-secondary mb-4">';
            html += '‚Üê Generate New Hooks';
            html += '</button>';
            html += '</div>';

            if (result.hooks && result.hooks.length > 0) {
                result.hooks.forEach(function(hook, index) {
                    html += '<div class="result-card mb-4">';
                    html += '<div class="flex items-start justify-between gap-4">';
                    html += '<div class="flex-1">';
                    html += '<div class="flex items-center gap-2 mb-2">';
                    html += '<span class="bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded">#' + (index + 1) + '</span>';
                    if (hook.score) {
                        html += '<span class="text-amber-400 text-sm">‚≠ê ' + hook.score + '/100 predicted CTR</span>';
                    }
                    html += '</div>';
                    html += '<p class="text-white text-lg">' + utils.escapeHtml(hook.text || hook) + '</p>';
                    if (hook.explanation) {
                        html += '<p class="text-gray-500 text-sm mt-2">üí° ' + utils.escapeHtml(hook.explanation) + '</p>';
                    }
                    html += '</div>';
                    html += '<button class="copy-btn flex-shrink-0" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(hook.text || hook).replace(/'/g, "\\'") + '\', this)">Copy</button>';
                    html += '</div>';
                    html += '</div>';
                });
            }

            return html;
        }

        function renderContentMultiplier() {
            var html = '';

            // Header
            html += renderToolHeader('Content Multiplier', 'üîÑ', 'content-multiplier', '8 tokens per video');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.multiplier.result) {
                // Show results
                html += renderMultiplierResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Input type tabs
                html += '<div class="tab-container mb-6">';
                html += '<button class="tab-btn active" onclick="app.setMultiplierInput(\'transcript\')">Paste Transcript</button>';
                html += '<button class="tab-btn" onclick="app.setMultiplierInput(\'url\')">YouTube URL</button>';
                html += '</div>';

                // Transcript input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Video Transcript or Script</label>';
                html += '<textarea id="multiplier-transcript" class="input-field h-40" placeholder="Paste your video transcript or script here...">' + utils.escapeHtml(state.multiplier.transcript) + '</textarea>';
                html += '</div>';

                // Output formats
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Output Formats</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                var formats = [
                    { id: 'shorts', name: 'YouTube Shorts', icon: 'üì±', desc: '3 viral clips' },
                    { id: 'twitter', name: 'Twitter Thread', icon: 'üê¶', desc: '10-15 tweets' },
                    { id: 'blog', name: 'Blog Post', icon: 'üìù', desc: 'SEO optimized' },
                    { id: 'quotes', name: 'Quote Cards', icon: 'üí¨', desc: '5 shareable quotes' },
                    { id: 'email', name: 'Email Newsletter', icon: 'üìß', desc: 'Subscriber digest' },
                    { id: 'linkedin', name: 'LinkedIn Post', icon: 'üíº', desc: 'Professional format' }
                ];
                formats.forEach(function(format) {
                    var selected = state.multiplier.formats.includes(format.id) ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.toggleMultiplierFormat(\'' + format.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + format.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + format.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + format.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.multiplyContent()" class="btn-primary w-full text-lg py-4" ' + (state.loading ? 'disabled' : '') + '>';
                html += '<span class="text-xl mr-2">üîÑ</span> Multiply Content';
                html += '</button>';

                html += '</div>'; // End form card
            }

            html += '</div>'; // End container

            return html;
        }

        function renderMultiplierResults() {
            var html = '';
            var result = state.multiplier.result;

            html += '<div class="mb-6">';
            html += '<button onclick="app.clearMultiplierResult()" class="btn-secondary mb-4">';
            html += '‚Üê Multiply New Content';
            html += '</button>';
            html += '</div>';

            // Tabs for different formats
            html += '<div class="tab-container">';
            var tabs = Object.keys(result);
            tabs.forEach(function(tab, index) {
                var active = index === 0 ? 'active' : '';
                html += '<button class="tab-btn ' + active + '" onclick="app.showMultiplierTab(\'' + tab + '\')">' + tab.charAt(0).toUpperCase() + tab.slice(1) + '</button>';
            });
            html += '</div>';

            // Tab content
            tabs.forEach(function(tab, index) {
                var display = index === 0 ? 'block' : 'none';
                html += '<div id="multiplier-tab-' + tab + '" style="display:' + display + '">';

                if (Array.isArray(result[tab])) {
                    result[tab].forEach(function(item, i) {
                        html += '<div class="result-card mb-4">';
                        html += '<div class="flex items-start justify-between gap-4">';
                        html += '<div class="flex-1">';
                        html += '<span class="text-indigo-400 text-sm font-medium">#' + (i + 1) + '</span>';
                        html += '<p class="text-gray-300 whitespace-pre-wrap mt-1">' + utils.escapeHtml(item) + '</p>';
                        html += '</div>';
                        html += '<button class="copy-btn flex-shrink-0" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(item).replace(/'/g, "\\'").replace(/\n/g, "\\n") + '\', this)">Copy</button>';
                        html += '</div>';
                        html += '</div>';
                    });
                } else {
                    html += '<div class="result-card">';
                    html += '<div class="flex items-start justify-between gap-4">';
                    html += '<p class="text-gray-300 whitespace-pre-wrap flex-1">' + utils.escapeHtml(result[tab]) + '</p>';
                    html += '<button class="copy-btn flex-shrink-0" onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result[tab]).replace(/'/g, "\\'").replace(/\n/g, "\\n") + '\', this)">Copy</button>';
                    html += '</div>';
                    html += '</div>';
                }

                html += '</div>';
            });

            return html;
        }

        function renderThumbnailArena() {
            var html = '';

            // Header
            html += renderToolHeader('Thumbnail A/B Arena', 'üìä', 'thumbnail-arena', '4 tokens per analysis');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.thumbnailArena.analysisResult) {
                // Show results
                html += renderThumbnailResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                html += '<div class="text-center mb-6">';
                html += '<h3 class="text-xl font-bold text-white mb-2">Upload Thumbnails to Compare</h3>';
                html += '<p class="text-gray-400">AI will predict CTR and analyze which thumbnail will perform best</p>';
                html += '</div>';

                // Upload area
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';

                // Thumbnail A
                html += '<div class="border-2 border-dashed border-gray-600 rounded-xl p-6 text-center hover:border-indigo-500 transition-colors cursor-pointer" onclick="document.getElementById(\'thumbnail-a\').click()">';
                html += '<input type="file" id="thumbnail-a" accept="image/*" class="hidden" onchange="app.handleThumbnailUpload(\'a\', event)">';
                if (state.thumbnailArena.thumbnails[0]) {
                    html += '<img src="' + state.thumbnailArena.thumbnails[0].preview + '" class="w-full h-32 object-cover rounded-lg mb-2">';
                    html += '<p class="text-green-400 text-sm">Thumbnail A uploaded</p>';
                } else {
                    html += '<div class="text-4xl mb-2">üñºÔ∏è</div>';
                    html += '<p class="text-gray-400">Click to upload Thumbnail A</p>';
                }
                html += '</div>';

                // Thumbnail B
                html += '<div class="border-2 border-dashed border-gray-600 rounded-xl p-6 text-center hover:border-indigo-500 transition-colors cursor-pointer" onclick="document.getElementById(\'thumbnail-b\').click()">';
                html += '<input type="file" id="thumbnail-b" accept="image/*" class="hidden" onchange="app.handleThumbnailUpload(\'b\', event)">';
                if (state.thumbnailArena.thumbnails[1]) {
                    html += '<img src="' + state.thumbnailArena.thumbnails[1].preview + '" class="w-full h-32 object-cover rounded-lg mb-2">';
                    html += '<p class="text-green-400 text-sm">Thumbnail B uploaded</p>';
                } else {
                    html += '<div class="text-4xl mb-2">üñºÔ∏è</div>';
                    html += '<p class="text-gray-400">Click to upload Thumbnail B</p>';
                }
                html += '</div>';

                html += '</div>';

                // Analyze button
                var canAnalyze = state.thumbnailArena.thumbnails.length >= 2;
                html += '<button onclick="app.analyzeThumbnails()" class="btn-primary w-full text-lg py-4" ' + (!canAnalyze || state.loading ? 'disabled' : '') + '>';
                html += '<span class="text-xl mr-2">üìä</span> Analyze & Predict Winner';
                html += '</button>';

                if (!canAnalyze) {
                    html += '<p class="text-gray-500 text-center mt-2 text-sm">Upload at least 2 thumbnails to compare</p>';
                }

                html += '</div>'; // End form card
            }

            html += '</div>'; // End container

            return html;
        }

        function renderThumbnailResults() {
            var html = '';
            var result = state.thumbnailArena.analysisResult;

            html += '<div class="mb-6">';
            html += '<button onclick="app.clearThumbnailResult()" class="btn-secondary mb-4">';
            html += '‚Üê Analyze New Thumbnails';
            html += '</button>';
            html += '</div>';

            // Winner announcement
            if (result.winner) {
                html += '<div class="bg-gradient-to-r from-amber-500/20 to-yellow-500/20 border border-amber-500/30 rounded-xl p-6 mb-6 text-center">';
                html += '<div class="text-4xl mb-2">üèÜ</div>';
                html += '<h3 class="text-2xl font-bold text-amber-400">Thumbnail ' + result.winner.toUpperCase() + ' Wins!</h3>';
                html += '<p class="text-gray-300 mt-2">Predicted to get <span class="text-amber-400 font-bold">' + result.winnerScore + '%</span> higher CTR</p>';
                html += '</div>';
            }

            // Thumbnail comparisons
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';

            if (result.thumbnailA) {
                html += '<div class="result-card ' + (result.winner === 'a' ? 'border-amber-500' : '') + '">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h4 class="font-bold text-white">Thumbnail A</h4>';
                html += '<span class="text-2xl font-bold ' + (result.winner === 'a' ? 'text-amber-400' : 'text-gray-400') + '">' + result.thumbnailA.score + '%</span>';
                html += '</div>';
                if (state.thumbnailArena.thumbnails[0]) {
                    html += '<img src="' + state.thumbnailArena.thumbnails[0].preview + '" class="w-full h-32 object-cover rounded-lg mb-3">';
                }
                html += '<div class="space-y-2">';
                if (result.thumbnailA.strengths) {
                    html += '<p class="text-green-400 text-sm">‚úÖ ' + result.thumbnailA.strengths.join(', ') + '</p>';
                }
                if (result.thumbnailA.weaknesses) {
                    html += '<p class="text-red-400 text-sm">‚ö†Ô∏è ' + result.thumbnailA.weaknesses.join(', ') + '</p>';
                }
                html += '</div>';
                html += '</div>';
            }

            if (result.thumbnailB) {
                html += '<div class="result-card ' + (result.winner === 'b' ? 'border-amber-500' : '') + '">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h4 class="font-bold text-white">Thumbnail B</h4>';
                html += '<span class="text-2xl font-bold ' + (result.winner === 'b' ? 'text-amber-400' : 'text-gray-400') + '">' + result.thumbnailB.score + '%</span>';
                html += '</div>';
                if (state.thumbnailArena.thumbnails[1]) {
                    html += '<img src="' + state.thumbnailArena.thumbnails[1].preview + '" class="w-full h-32 object-cover rounded-lg mb-3">';
                }
                html += '<div class="space-y-2">';
                if (result.thumbnailB.strengths) {
                    html += '<p class="text-green-400 text-sm">‚úÖ ' + result.thumbnailB.strengths.join(', ') + '</p>';
                }
                if (result.thumbnailB.weaknesses) {
                    html += '<p class="text-red-400 text-sm">‚ö†Ô∏è ' + result.thumbnailB.weaknesses.join(', ') + '</p>';
                }
                html += '</div>';
                html += '</div>';
            }

            html += '</div>';

            // Recommendations
            if (result.recommendations) {
                html += '<div class="result-card mt-6">';
                html += '<h4 class="font-bold text-white mb-3">üí° Recommendations</h4>';
                html += '<ul class="space-y-2">';
                result.recommendations.forEach(function(rec) {
                    html += '<li class="text-gray-300 flex items-start gap-2">';
                    html += '<span class="text-indigo-400">‚Ä¢</span>';
                    html += '<span>' + utils.escapeHtml(rec) + '</span>';
                    html += '</li>';
                });
                html += '</ul>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // TREND HIJACKER RENDERER
        // ==========================================
        function renderTrendHijacker() {
            var html = '';

            // Header
            html += renderToolHeader('Trend Hijacker', 'üéØ', 'trend-hijacker', '6 tokens per analysis');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.trends.result) {
                // Show results
                html += renderTrendResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Niche input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Niche / Topic Area</label>';
                html += '<input type="text" id="trend-niche" class="input-field" placeholder="e.g., productivity, fitness, tech reviews, cooking, gaming..." value="' + utils.escapeHtml(state.trends.niche) + '">';
                html += '<p class="text-gray-500 text-sm mt-1">Enter your content niche to find relevant trending topics</p>';
                html += '</div>';

                // Region selection
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Target Region</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var regions = [
                    { id: 'US', name: 'United States', icon: 'üá∫üá∏' },
                    { id: 'GB', name: 'United Kingdom', icon: 'üá¨üáß' },
                    { id: 'CA', name: 'Canada', icon: 'üá®üá¶' },
                    { id: 'AU', name: 'Australia', icon: 'üá¶üá∫' },
                    { id: 'DE', name: 'Germany', icon: 'üá©üá™' },
                    { id: 'FR', name: 'France', icon: 'üá´üá∑' },
                    { id: 'IN', name: 'India', icon: 'üáÆüá≥' },
                    { id: 'GLOBAL', name: 'Global', icon: 'üåç' }
                ];
                regions.forEach(function(region) {
                    var selected = state.trends.region === region.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setTrendRegion(\'' + region.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + region.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + region.name + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Timeframe selection
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Trend Timeframe</label>';
                html += '<div class="grid grid-cols-3 gap-3">';
                var timeframes = [
                    { id: 'day', name: 'Today', desc: 'Last 24 hours', icon: '‚ö°' },
                    { id: 'week', name: 'This Week', desc: 'Last 7 days', icon: 'üìÖ' },
                    { id: 'month', name: 'This Month', desc: 'Last 30 days', icon: 'üìÜ' }
                ];
                timeframes.forEach(function(tf) {
                    var selected = state.trends.timeframe === tf.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setTrendTimeframe(\'' + tf.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + tf.icon + '</div>';
                    html += '<div class="font-medium text-white">' + tf.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + tf.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.generateTrends()" class="btn-primary w-full">';
                html += '<span class="mr-2">üéØ</span> Find Trending Topics';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderTrendResults() {
            var html = '';
            var result = state.trends.result;

            // Success header
            html += '<div class="bg-gradient-to-r from-orange-500/20 to-yellow-500/20 border border-orange-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">üî• Trending Topics Found!</h3>';
            html += '<p class="text-gray-400">Based on ' + utils.escapeHtml(state.trends.niche) + ' in ' + state.trends.region + '</p>';
            html += '</div>';
            html += '<button onclick="app.resetTrends()" class="btn-secondary">New Search</button>';
            html += '</div>';
            html += '</div>';

            // Trending topics
            if (result.trends && result.trends.length > 0) {
                html += '<div class="space-y-4">';
                result.trends.forEach(function(trend, index) {
                    var urgencyColor = trend.urgency === 'high' ? 'text-red-400' : trend.urgency === 'medium' ? 'text-yellow-400' : 'text-green-400';
                    var urgencyBg = trend.urgency === 'high' ? 'bg-red-500/20' : trend.urgency === 'medium' ? 'bg-yellow-500/20' : 'bg-green-500/20';

                    html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 hover:border-orange-500/50 transition-all">';
                    html += '<div class="flex items-start justify-between mb-3">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<span class="text-2xl font-bold text-orange-400">#' + (index + 1) + '</span>';
                    html += '<div>';
                    html += '<h4 class="text-lg font-bold text-white">' + utils.escapeHtml(trend.topic) + '</h4>';
                    html += '<div class="flex items-center gap-2 mt-1">';
                    html += '<span class="px-2 py-0.5 rounded text-xs font-medium ' + urgencyBg + ' ' + urgencyColor + '">' + (trend.urgency || 'medium').toUpperCase() + ' URGENCY</span>';
                    html += '<span class="text-gray-500 text-sm">Score: ' + (trend.score || 85) + '/100</span>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';

                    // Trend details
                    html += '<p class="text-gray-400 mb-3">' + utils.escapeHtml(trend.description || 'Emerging trend with high potential') + '</p>';

                    // Suggested angles
                    if (trend.angles && trend.angles.length > 0) {
                        html += '<div class="mb-3">';
                        html += '<p class="text-sm font-medium text-gray-300 mb-2">üí° Content Angles:</p>';
                        html += '<div class="flex flex-wrap gap-2">';
                        trend.angles.forEach(function(angle) {
                            html += '<span class="px-3 py-1 bg-gray-700/50 rounded-full text-sm text-gray-300">' + utils.escapeHtml(angle) + '</span>';
                        });
                        html += '</div>';
                        html += '</div>';
                    }

                    // Suggested title
                    if (trend.suggestedTitle) {
                        html += '<div class="bg-gray-900/50 rounded-lg p-3 mt-3">';
                        html += '<p class="text-sm text-gray-400 mb-1">üìù Suggested Video Title:</p>';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(trend.suggestedTitle) + '</p>';
                        html += '<button onclick="utils.copyToClipboard(\'' + utils.escapeHtml(trend.suggestedTitle).replace(/'/g, "\\'") + '\', this)" class="text-orange-400 hover:text-orange-300 text-sm mt-2">Copy Title</button>';
                        html += '</div>';
                    }

                    html += '</div>';
                });
                html += '</div>';
            }

            // Insights section
            if (result.insights) {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-xl p-5 mt-6">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üìä Market Insights</h4>';
                html += '<p class="text-gray-400">' + utils.escapeHtml(result.insights) + '</p>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // CONTENT GAP FINDER RENDERER
        // ==========================================
        function renderContentGapFinder() {
            var html = '';

            // Header
            html += renderToolHeader('Content Gap Finder', 'üó∫Ô∏è', 'gap-finder', '6 tokens per analysis');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.gaps.result) {
                // Show results
                html += renderGapResults();
            } else {
                // Show form
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Niche input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Niche / Topic Area</label>';
                html += '<input type="text" id="gap-niche" class="input-field" placeholder="e.g., personal finance, home workouts, Python programming..." value="' + utils.escapeHtml(state.gaps.niche) + '">';
                html += '<p class="text-gray-500 text-sm mt-1">Enter your niche to discover content opportunities</p>';
                html += '</div>';

                // Competitors input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Competitor Channels (Optional)</label>';
                html += '<textarea id="gap-competitors" class="input-field h-20" placeholder="Enter competitor channel names or URLs, one per line (optional)...">' + utils.escapeHtml(state.gaps.competitors) + '</textarea>';
                html += '<p class="text-gray-500 text-sm mt-1">List competitors to analyze their content gaps</p>';
                html += '</div>';

                // Analysis depth
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Analysis Depth</label>';
                html += '<div class="grid grid-cols-3 gap-3">';
                var depths = [
                    { id: 'quick', name: 'Quick Scan', desc: 'Top opportunities', icon: '‚ö°' },
                    { id: 'moderate', name: 'Moderate', desc: 'Balanced analysis', icon: 'üìä' },
                    { id: 'deep', name: 'Deep Dive', desc: 'Comprehensive', icon: 'üî¨' }
                ];
                depths.forEach(function(depth) {
                    var selected = state.gaps.depth === depth.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setGapDepth(\'' + depth.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + depth.icon + '</div>';
                    html += '<div class="font-medium text-white">' + depth.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + depth.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.findGaps()" class="btn-primary w-full">';
                html += '<span class="mr-2">üó∫Ô∏è</span> Find Content Gaps';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderGapResults() {
            var html = '';
            var result = state.gaps.result;

            // Success header
            html += '<div class="bg-gradient-to-r from-teal-500/20 to-cyan-500/20 border border-teal-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">üéØ Content Opportunities Found!</h3>';
            html += '<p class="text-gray-400">Analysis of ' + utils.escapeHtml(state.gaps.niche) + '</p>';
            html += '</div>';
            html += '<button onclick="app.resetGaps()" class="btn-secondary">New Analysis</button>';
            html += '</div>';
            html += '</div>';

            // Gap opportunities
            if (result.gaps && result.gaps.length > 0) {
                html += '<div class="space-y-4">';
                result.gaps.forEach(function(gap, index) {
                    var difficultyColor = gap.difficulty === 'easy' ? 'text-green-400' : gap.difficulty === 'medium' ? 'text-yellow-400' : 'text-red-400';
                    var difficultyBg = gap.difficulty === 'easy' ? 'bg-green-500/20' : gap.difficulty === 'medium' ? 'bg-yellow-500/20' : 'bg-red-500/20';
                    var potentialWidth = (gap.potential || 75) + '%';

                    html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 hover:border-teal-500/50 transition-all">';

                    // Header with ranking
                    html += '<div class="flex items-start justify-between mb-3">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<span class="text-2xl font-bold text-teal-400">#' + (index + 1) + '</span>';
                    html += '<div>';
                    html += '<h4 class="text-lg font-bold text-white">' + utils.escapeHtml(gap.topic) + '</h4>';
                    html += '<div class="flex items-center gap-2 mt-1">';
                    html += '<span class="px-2 py-0.5 rounded text-xs font-medium ' + difficultyBg + ' ' + difficultyColor + '">' + (gap.difficulty || 'medium').toUpperCase() + '</span>';
                    html += '<span class="text-gray-500 text-sm">Opportunity Score: ' + (gap.potential || 75) + '/100</span>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';

                    // Description
                    html += '<p class="text-gray-400 mb-3">' + utils.escapeHtml(gap.description || 'Untapped content opportunity in your niche') + '</p>';

                    // Why it\'s a gap
                    if (gap.reason) {
                        html += '<div class="bg-teal-500/10 rounded-lg p-3 mb-3">';
                        html += '<p class="text-sm text-teal-300"><strong>Why this is a gap:</strong> ' + utils.escapeHtml(gap.reason) + '</p>';
                        html += '</div>';
                    }

                    // Potential bar
                    html += '<div class="mb-3">';
                    html += '<div class="flex justify-between text-sm mb-1">';
                    html += '<span class="text-gray-400">Potential</span>';
                    html += '<span class="text-teal-400">' + (gap.potential || 75) + '%</span>';
                    html += '</div>';
                    html += '<div class="w-full bg-gray-700 rounded-full h-2">';
                    html += '<div class="bg-gradient-to-r from-teal-500 to-cyan-500 h-2 rounded-full" style="width: ' + potentialWidth + '"></div>';
                    html += '</div>';
                    html += '</div>';

                    // Suggested titles
                    if (gap.suggestedTitles && gap.suggestedTitles.length > 0) {
                        html += '<div class="bg-gray-900/50 rounded-lg p-3">';
                        html += '<p class="text-sm text-gray-400 mb-2">üìù Video Ideas:</p>';
                        html += '<ul class="space-y-1">';
                        gap.suggestedTitles.forEach(function(title) {
                            html += '<li class="flex items-center justify-between">';
                            html += '<span class="text-white text-sm">' + utils.escapeHtml(title) + '</span>';
                            html += '<button onclick="utils.copyToClipboard(\'' + utils.escapeHtml(title).replace(/'/g, "\\'") + '\', this)" class="text-teal-400 hover:text-teal-300 text-xs">Copy</button>';
                            html += '</li>';
                        });
                        html += '</ul>';
                        html += '</div>';
                    }

                    html += '</div>';
                });
                html += '</div>';
            }

            // Market summary
            if (result.summary) {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-xl p-5 mt-6">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üìà Market Summary</h4>';
                html += '<p class="text-gray-400">' + utils.escapeHtml(result.summary) + '</p>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // AUDIENCE DNA ANALYZER RENDERER
        // ==========================================
        function renderAudienceDNA() {
            var html = '';

            // Header
            html += renderToolHeader('Audience DNA Analyzer', 'üß¨', 'audience-dna', '7 tokens per analysis');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.audience.result) {
                html += renderAudienceResults();
            } else {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Niche input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Niche / Content Area</label>';
                html += '<input type="text" id="audience-niche" class="input-field" placeholder="e.g., personal finance for millennials, beginner photography, home fitness..." value="' + utils.escapeHtml(state.audience.niche) + '">';
                html += '</div>';

                // Channel URL (optional)
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Channel URL (Optional)</label>';
                html += '<input type="text" id="audience-channel" class="input-field" placeholder="https://youtube.com/@yourchannel" value="' + utils.escapeHtml(state.audience.channelUrl) + '">';
                html += '<p class="text-gray-500 text-sm mt-1">Add your channel for more personalized insights</p>';
                html += '</div>';

                // Analysis depth
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Analysis Depth</label>';
                html += '<div class="grid grid-cols-3 gap-3">';
                var depths = [
                    { id: 'quick', name: 'Quick Scan', desc: 'Key demographics', icon: '‚ö°' },
                    { id: 'standard', name: 'Standard', desc: 'Full profile', icon: 'üìä' },
                    { id: 'deep', name: 'Deep Dive', desc: 'Psychographics', icon: 'üî¨' }
                ];
                depths.forEach(function(depth) {
                    var selected = state.audience.depth === depth.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setAudienceDepth(\'' + depth.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + depth.icon + '</div>';
                    html += '<div class="font-medium text-white">' + depth.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + depth.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.analyzeAudience()" class="btn-primary w-full">';
                html += '<span class="mr-2">üß¨</span> Analyze Audience DNA';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderAudienceResults() {
            var html = '';
            var result = state.audience.result;

            // Success header
            html += '<div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">üß¨ Audience DNA Decoded!</h3>';
            html += '<p class="text-gray-400">Profile for ' + utils.escapeHtml(state.audience.niche) + '</p>';
            html += '</div>';
            html += '<button onclick="app.resetAudience()" class="btn-secondary">New Analysis</button>';
            html += '</div>';
            html += '</div>';

            // Demographics section
            if (result.demographics) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-4">üë• Demographics</h4>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
                if (result.demographics.ageRange) {
                    html += '<div class="text-center p-3 bg-gray-900/50 rounded-lg">';
                    html += '<div class="text-2xl mb-1">üìÖ</div>';
                    html += '<div class="text-gray-400 text-xs">Age Range</div>';
                    html += '<div class="text-white font-bold">' + utils.escapeHtml(result.demographics.ageRange) + '</div>';
                    html += '</div>';
                }
                if (result.demographics.gender) {
                    html += '<div class="text-center p-3 bg-gray-900/50 rounded-lg">';
                    html += '<div class="text-2xl mb-1">‚ößÔ∏è</div>';
                    html += '<div class="text-gray-400 text-xs">Gender Split</div>';
                    html += '<div class="text-white font-bold">' + utils.escapeHtml(result.demographics.gender) + '</div>';
                    html += '</div>';
                }
                if (result.demographics.location) {
                    html += '<div class="text-center p-3 bg-gray-900/50 rounded-lg">';
                    html += '<div class="text-2xl mb-1">üåç</div>';
                    html += '<div class="text-gray-400 text-xs">Top Location</div>';
                    html += '<div class="text-white font-bold">' + utils.escapeHtml(result.demographics.location) + '</div>';
                    html += '</div>';
                }
                if (result.demographics.income) {
                    html += '<div class="text-center p-3 bg-gray-900/50 rounded-lg">';
                    html += '<div class="text-2xl mb-1">üíµ</div>';
                    html += '<div class="text-gray-400 text-xs">Income Level</div>';
                    html += '<div class="text-white font-bold">' + utils.escapeHtml(result.demographics.income) + '</div>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
            }

            // Interests
            if (result.interests && result.interests.length > 0) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üéØ Interests & Hobbies</h4>';
                html += '<div class="flex flex-wrap gap-2">';
                result.interests.forEach(function(interest) {
                    html += '<span class="px-3 py-1.5 bg-purple-500/20 text-purple-300 rounded-full text-sm">' + utils.escapeHtml(interest) + '</span>';
                });
                html += '</div>';
                html += '</div>';
            }

            // Pain points
            if (result.painPoints && result.painPoints.length > 0) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üò´ Pain Points & Challenges</h4>';
                html += '<ul class="space-y-2">';
                result.painPoints.forEach(function(pain) {
                    html += '<li class="flex items-start gap-2 text-gray-300">';
                    html += '<span class="text-red-400">‚Ä¢</span>';
                    html += '<span>' + utils.escapeHtml(pain) + '</span>';
                    html += '</li>';
                });
                html += '</ul>';
                html += '</div>';
            }

            // Content preferences
            if (result.contentPreferences) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üì∫ Content Preferences</h4>';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
                if (result.contentPreferences.formats) {
                    html += '<div>';
                    html += '<p class="text-gray-400 text-sm mb-2">Preferred Formats:</p>';
                    html += '<p class="text-white">' + utils.escapeHtml(result.contentPreferences.formats.join(', ')) + '</p>';
                    html += '</div>';
                }
                if (result.contentPreferences.length) {
                    html += '<div>';
                    html += '<p class="text-gray-400 text-sm mb-2">Ideal Video Length:</p>';
                    html += '<p class="text-white">' + utils.escapeHtml(result.contentPreferences.length) + '</p>';
                    html += '</div>';
                }
                if (result.contentPreferences.watchTime) {
                    html += '<div>';
                    html += '<p class="text-gray-400 text-sm mb-2">Peak Watch Times:</p>';
                    html += '<p class="text-white">' + utils.escapeHtml(result.contentPreferences.watchTime) + '</p>';
                    html += '</div>';
                }
                if (result.contentPreferences.tone) {
                    html += '<div>';
                    html += '<p class="text-gray-400 text-sm mb-2">Preferred Tone:</p>';
                    html += '<p class="text-white">' + utils.escapeHtml(result.contentPreferences.tone) + '</p>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
            }

            // Recommendations
            if (result.recommendations && result.recommendations.length > 0) {
                html += '<div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-5">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üí° Content Recommendations</h4>';
                html += '<ul class="space-y-2">';
                result.recommendations.forEach(function(rec) {
                    html += '<li class="flex items-start gap-2 text-gray-300">';
                    html += '<span class="text-purple-400">‚Üí</span>';
                    html += '<span>' + utils.escapeHtml(rec) + '</span>';
                    html += '</li>';
                });
                html += '</ul>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // COLLAB MATCHMAKER RENDERER
        // ==========================================
        function renderCollabMatchmaker() {
            var html = '';

            // Header
            html += renderToolHeader('Collab Matchmaker', 'ü§ù', 'collab-match', '5 tokens per search');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.collab.result) {
                html += renderCollabResults();
            } else {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Niche input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Niche / Content Area</label>';
                html += '<input type="text" id="collab-niche" class="input-field" placeholder="e.g., tech reviews, cooking tutorials, gaming commentary..." value="' + utils.escapeHtml(state.collab.niche) + '">';
                html += '</div>';

                // Channel size preference
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Preferred Partner Size</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var sizes = [
                    { id: 'any', name: 'Any Size', desc: 'All creators', icon: 'üåê' },
                    { id: 'small', name: 'Small', desc: '1K-10K subs', icon: 'üå±' },
                    { id: 'medium', name: 'Medium', desc: '10K-100K subs', icon: 'üìà' },
                    { id: 'large', name: 'Large', desc: '100K+ subs', icon: 'üöÄ' }
                ];
                sizes.forEach(function(size) {
                    var selected = state.collab.channelSize === size.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setCollabSize(\'' + size.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + size.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + size.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + size.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Content style preference
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Content Style Match</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var styles = [
                    { id: 'any', name: 'Any Style', icon: 'üé®' },
                    { id: 'educational', name: 'Educational', icon: 'üìö' },
                    { id: 'entertainment', name: 'Entertainment', icon: 'üé≠' },
                    { id: 'lifestyle', name: 'Lifestyle', icon: '‚ú®' }
                ];
                styles.forEach(function(style) {
                    var selected = state.collab.contentStyle === style.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setCollabStyle(\'' + style.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + style.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + style.name + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.findCollabs()" class="btn-primary w-full">';
                html += '<span class="mr-2">ü§ù</span> Find Collaboration Partners';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderCollabResults() {
            var html = '';
            var result = state.collab.result;

            // Success header
            html += '<div class="bg-gradient-to-r from-sky-500/20 to-indigo-500/20 border border-sky-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">ü§ù Perfect Matches Found!</h3>';
            html += '<p class="text-gray-400">Collaboration partners for ' + utils.escapeHtml(state.collab.niche) + '</p>';
            html += '</div>';
            html += '<button onclick="app.resetCollab()" class="btn-secondary">New Search</button>';
            html += '</div>';
            html += '</div>';

            // Partner matches
            if (result.matches && result.matches.length > 0) {
                html += '<div class="space-y-4">';
                result.matches.forEach(function(match, index) {
                    var matchColor = match.compatibility >= 80 ? 'text-green-400' : match.compatibility >= 60 ? 'text-yellow-400' : 'text-gray-400';

                    html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 hover:border-sky-500/50 transition-all">';

                    html += '<div class="flex items-start justify-between mb-3">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<div class="w-12 h-12 rounded-full bg-gradient-to-br from-sky-500 to-indigo-500 flex items-center justify-center text-xl font-bold">' + (index + 1) + '</div>';
                    html += '<div>';
                    html += '<h4 class="text-lg font-bold text-white">' + utils.escapeHtml(match.creatorType) + '</h4>';
                    html += '<div class="flex items-center gap-2 mt-1">';
                    html += '<span class="' + matchColor + ' font-bold">' + match.compatibility + '% Match</span>';
                    html += '<span class="text-gray-500">‚Ä¢</span>';
                    html += '<span class="text-gray-400 text-sm">' + utils.escapeHtml(match.audienceSize || 'Various sizes') + '</span>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';

                    // Why they match
                    html += '<p class="text-gray-400 mb-3">' + utils.escapeHtml(match.reason) + '</p>';

                    // Collab ideas
                    if (match.collabIdeas && match.collabIdeas.length > 0) {
                        html += '<div class="mb-3">';
                        html += '<p class="text-sm font-medium text-gray-300 mb-2">üí° Collaboration Ideas:</p>';
                        html += '<div class="flex flex-wrap gap-2">';
                        match.collabIdeas.forEach(function(idea) {
                            html += '<span class="px-3 py-1 bg-sky-500/20 text-sky-300 rounded-full text-sm">' + utils.escapeHtml(idea) + '</span>';
                        });
                        html += '</div>';
                        html += '</div>';
                    }

                    // Outreach template
                    if (match.outreachTemplate) {
                        html += '<div class="bg-gray-900/50 rounded-lg p-3">';
                        html += '<div class="flex items-center justify-between mb-2">';
                        html += '<p class="text-sm text-gray-400">üìß Outreach Template:</p>';
                        html += '<button onclick="utils.copyToClipboard(\'' + utils.escapeHtml(match.outreachTemplate).replace(/'/g, "\\'").replace(/\n/g, "\\n") + '\', this)" class="text-sky-400 hover:text-sky-300 text-xs">Copy</button>';
                        html += '</div>';
                        html += '<p class="text-gray-300 text-sm whitespace-pre-line">' + utils.escapeHtml(match.outreachTemplate) + '</p>';
                        html += '</div>';
                    }

                    html += '</div>';
                });
                html += '</div>';
            }

            // Tips
            if (result.tips) {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-xl p-5 mt-6">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üéØ Collaboration Tips</h4>';
                html += '<p class="text-gray-400">' + utils.escapeHtml(result.tips) + '</p>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // REVENUE MAXIMIZER PRO RENDERER
        // ==========================================
        function renderRevenueMaximizer() {
            var html = '';

            // Header
            html += renderToolHeader('Revenue Maximizer Pro', 'üí∞', 'revenue-max', '8 tokens per analysis');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.revenue.result) {
                html += renderRevenueResults();
            } else {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Niche input
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Your Niche / Content Area</label>';
                html += '<input type="text" id="revenue-niche" class="input-field" placeholder="e.g., tech tutorials, fitness coaching, personal finance..." value="' + utils.escapeHtml(state.revenue.niche) + '">';
                html += '</div>';

                // Audience size
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Your Audience Size</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var sizes = [
                    { id: 'starter', name: 'Starter', desc: '0-1K subs', icon: 'üå±' },
                    { id: 'small', name: 'Small', desc: '1K-10K subs', icon: 'üìà' },
                    { id: 'medium', name: 'Medium', desc: '10K-100K subs', icon: 'üöÄ' },
                    { id: 'large', name: 'Large', desc: '100K+ subs', icon: '‚≠ê' }
                ];
                sizes.forEach(function(size) {
                    var selected = state.revenue.audienceSize === size.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setRevenueSize(\'' + size.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + size.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + size.name + '</div>';
                    html += '<div class="text-gray-500 text-xs">' + size.desc + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Current monetization methods
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Current Revenue Streams (select all that apply)</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                var methods = [
                    { id: 'adsense', name: 'AdSense', icon: 'üì∫' },
                    { id: 'sponsors', name: 'Sponsors', icon: 'ü§ù' },
                    { id: 'affiliates', name: 'Affiliates', icon: 'üîó' },
                    { id: 'merch', name: 'Merchandise', icon: 'üëï' },
                    { id: 'memberships', name: 'Memberships', icon: '‚≠ê' },
                    { id: 'courses', name: 'Courses', icon: 'üìö' }
                ];
                methods.forEach(function(method) {
                    var selected = state.revenue.currentMethods.indexOf(method.id) > -1 ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.toggleRevenueMethod(\'' + method.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + method.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + method.name + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.analyzeRevenue()" class="btn-primary w-full">';
                html += '<span class="mr-2">üí∞</span> Maximize My Revenue';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderRevenueResults() {
            var html = '';
            var result = state.revenue.result;

            // Success header with potential earnings
            html += '<div class="bg-gradient-to-r from-green-500/20 to-yellow-500/20 border border-green-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">üí∞ Revenue Opportunities Unlocked!</h3>';
            if (result.potentialMonthly) {
                html += '<p class="text-green-400 font-bold text-lg">Potential: $' + result.potentialMonthly + '/month</p>';
            }
            html += '</div>';
            html += '<button onclick="app.resetRevenue()" class="btn-secondary">New Analysis</button>';
            html += '</div>';
            html += '</div>';

            // Revenue opportunities
            if (result.opportunities && result.opportunities.length > 0) {
                html += '<div class="space-y-4">';
                result.opportunities.forEach(function(opp, index) {
                    var priorityColor = opp.priority === 'high' ? 'bg-green-500/20 text-green-400' : opp.priority === 'medium' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-gray-500/20 text-gray-400';

                    html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 hover:border-green-500/50 transition-all">';

                    html += '<div class="flex items-start justify-between mb-3">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<span class="text-3xl">' + (opp.icon || 'üíµ') + '</span>';
                    html += '<div>';
                    html += '<h4 class="text-lg font-bold text-white">' + utils.escapeHtml(opp.name) + '</h4>';
                    html += '<div class="flex items-center gap-2 mt-1">';
                    html += '<span class="px-2 py-0.5 rounded text-xs font-medium ' + priorityColor + '">' + (opp.priority || 'medium').toUpperCase() + ' PRIORITY</span>';
                    if (opp.estimatedRevenue) {
                        html += '<span class="text-green-400 font-bold">$' + opp.estimatedRevenue + '/mo</span>';
                    }
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';

                    html += '<p class="text-gray-400 mb-3">' + utils.escapeHtml(opp.description) + '</p>';

                    // Action steps
                    if (opp.steps && opp.steps.length > 0) {
                        html += '<div class="mb-3">';
                        html += '<p class="text-sm font-medium text-gray-300 mb-2">üìã Action Steps:</p>';
                        html += '<ol class="list-decimal list-inside space-y-1">';
                        opp.steps.forEach(function(step) {
                            html += '<li class="text-gray-400 text-sm">' + utils.escapeHtml(step) + '</li>';
                        });
                        html += '</ol>';
                        html += '</div>';
                    }

                    // Tools/Resources
                    if (opp.tools && opp.tools.length > 0) {
                        html += '<div class="flex flex-wrap gap-2">';
                        opp.tools.forEach(function(tool) {
                            html += '<span class="px-2 py-1 bg-gray-700/50 rounded text-xs text-gray-300">üîß ' + utils.escapeHtml(tool) + '</span>';
                        });
                        html += '</div>';
                    }

                    html += '</div>';
                });
                html += '</div>';
            }

            // Pricing guide
            if (result.pricingGuide) {
                html += '<div class="bg-green-500/10 border border-green-500/30 rounded-xl p-5 mt-6">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üíµ Pricing Guide</h4>';
                html += '<div class="text-gray-300 whitespace-pre-line">' + utils.escapeHtml(result.pricingGuide) + '</div>';
                html += '</div>';
            }

            // Sponsor pitch template
            if (result.sponsorPitch) {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-xl p-5 mt-4">';
                html += '<div class="flex items-center justify-between mb-3">';
                html += '<h4 class="text-lg font-bold text-white">üìß Sponsor Pitch Template</h4>';
                html += '<button onclick="utils.copyToClipboard(\'' + utils.escapeHtml(result.sponsorPitch).replace(/'/g, "\\'").replace(/\n/g, "\\n") + '\', this)" class="text-green-400 hover:text-green-300 text-sm">Copy Template</button>';
                html += '</div>';
                html += '<p class="text-gray-400 text-sm whitespace-pre-line">' + utils.escapeHtml(result.sponsorPitch) + '</p>';
                html += '</div>';
            }

            return html;
        }

        // ==========================================
        // AI VIDEO COACH RENDERER
        // ==========================================
        function renderAICoach() {
            var html = '';

            // Header
            html += renderToolHeader('AI Video Coach', 'üß†', 'ai-coach', '10 tokens per session');

            // Main content
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';

            if (state.coach.result) {
                html += renderCoachResults();
            } else {
                html += '<div class="bg-gray-800/30 border border-gray-700 rounded-2xl p-6">';

                // Video URL or transcript
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Video URL or Title</label>';
                html += '<input type="text" id="coach-video" class="input-field" placeholder="https://youtube.com/watch?v=... or paste your video title" value="' + utils.escapeHtml(state.coach.videoUrl) + '">';
                html += '</div>';

                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">Video Transcript / Script (Optional)</label>';
                html += '<textarea id="coach-transcript" class="input-field h-24" placeholder="Paste your video transcript or script for deeper analysis...">' + utils.escapeHtml(state.coach.transcript) + '</textarea>';
                html += '</div>';

                // Challenge/Question
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-2">What challenge do you need help with?</label>';
                html += '<textarea id="coach-challenge" class="input-field h-20" placeholder="e.g., My retention drops at 2 minutes, I\'m not getting clicks despite good thumbnails, How can I improve my hooks...">' + utils.escapeHtml(state.coach.challenge) + '</textarea>';
                html += '</div>';

                // Focus area
                html += '<div class="mb-6">';
                html += '<label class="block text-white font-semibold mb-3">Focus Area</label>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';
                var areas = [
                    { id: 'general', name: 'General Review', icon: 'üìã' },
                    { id: 'retention', name: 'Retention', icon: 'üìà' },
                    { id: 'hooks', name: 'Hooks & Intros', icon: 'üé£' },
                    { id: 'ctr', name: 'CTR & Titles', icon: 'üñ±Ô∏è' },
                    { id: 'engagement', name: 'Engagement', icon: 'üí¨' },
                    { id: 'growth', name: 'Growth Strategy', icon: 'üöÄ' },
                    { id: 'monetization', name: 'Monetization', icon: 'üí∞' },
                    { id: 'scripting', name: 'Scripting', icon: 'üìù' }
                ];
                areas.forEach(function(area) {
                    var selected = state.coach.focusArea === area.id ? 'selected' : '';
                    html += '<div class="option-card ' + selected + '" onclick="app.setCoachFocus(\'' + area.id + '\')">';
                    html += '<div class="text-2xl mb-1">' + area.icon + '</div>';
                    html += '<div class="font-medium text-white text-sm">' + area.name + '</div>';
                    html += '</div>';
                });
                html += '</div></div>';

                // Generate button
                html += '<button onclick="app.getCoaching()" class="btn-primary w-full">';
                html += '<span class="mr-2">üß†</span> Get Expert Coaching';
                html += '</button>';

                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderCoachResults() {
            var html = '';
            var result = state.coach.result;

            // Success header
            html += '<div class="bg-gradient-to-r from-rose-500/20 to-orange-500/20 border border-rose-500/30 rounded-2xl p-6 mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div>';
            html += '<h3 class="text-xl font-bold text-white mb-1">üß† Your Coaching Session</h3>';
            html += '<p class="text-gray-400">Focus: ' + utils.escapeHtml(state.coach.focusArea) + '</p>';
            html += '</div>';
            html += '<button onclick="app.resetCoach()" class="btn-secondary">New Session</button>';
            html += '</div>';
            html += '</div>';

            // Overall assessment
            if (result.assessment) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üìä Overall Assessment</h4>';
                html += '<p class="text-gray-300">' + utils.escapeHtml(result.assessment) + '</p>';
                if (result.score) {
                    html += '<div class="mt-4 flex items-center gap-4">';
                    html += '<div class="text-3xl font-bold text-rose-400">' + result.score + '/10</div>';
                    html += '<div class="flex-1">';
                    html += '<div class="w-full bg-gray-700 rounded-full h-3">';
                    html += '<div class="bg-gradient-to-r from-rose-500 to-orange-500 h-3 rounded-full" style="width: ' + (result.score * 10) + '%"></div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }
                html += '</div>';
            }

            // Strengths
            if (result.strengths && result.strengths.length > 0) {
                html += '<div class="bg-green-500/10 border border-green-500/30 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">‚úÖ What You\'re Doing Well</h4>';
                html += '<ul class="space-y-2">';
                result.strengths.forEach(function(strength) {
                    html += '<li class="flex items-start gap-2 text-gray-300">';
                    html += '<span class="text-green-400">‚úì</span>';
                    html += '<span>' + utils.escapeHtml(strength) + '</span>';
                    html += '</li>';
                });
                html += '</ul>';
                html += '</div>';
            }

            // Areas to improve
            if (result.improvements && result.improvements.length > 0) {
                html += '<div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üéØ Priority Improvements</h4>';
                html += '<div class="space-y-3">';
                result.improvements.forEach(function(imp, index) {
                    html += '<div class="flex items-start gap-3">';
                    html += '<span class="w-6 h-6 flex-shrink-0 rounded-full bg-yellow-500/30 text-yellow-400 flex items-center justify-center text-sm font-bold">' + (index + 1) + '</span>';
                    html += '<div>';
                    html += '<p class="text-white font-medium">' + utils.escapeHtml(imp.title || imp) + '</p>';
                    if (imp.action) {
                        html += '<p class="text-gray-400 text-sm mt-1">' + utils.escapeHtml(imp.action) + '</p>';
                    }
                    html += '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }

            // Action plan
            if (result.actionPlan && result.actionPlan.length > 0) {
                html += '<div class="bg-gray-800/50 border border-gray-700 rounded-xl p-5 mb-4">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üìã Your Action Plan</h4>';
                html += '<div class="space-y-2">';
                result.actionPlan.forEach(function(action, index) {
                    html += '<div class="flex items-center gap-3 p-2 bg-gray-900/50 rounded-lg">';
                    html += '<span class="w-6 h-6 flex-shrink-0 rounded bg-rose-500/30 text-rose-400 flex items-center justify-center text-xs font-bold">' + (index + 1) + '</span>';
                    html += '<span class="text-gray-300">' + utils.escapeHtml(action) + '</span>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }

            // Pro tips
            if (result.proTips && result.proTips.length > 0) {
                html += '<div class="bg-rose-500/10 border border-rose-500/30 rounded-xl p-5">';
                html += '<h4 class="text-lg font-bold text-white mb-3">üíé Pro Tips</h4>';
                html += '<ul class="space-y-2">';
                result.proTips.forEach(function(tip) {
                    html += '<li class="flex items-start gap-2 text-gray-300">';
                    html += '<span class="text-rose-400">üí°</span>';
                    html += '<span>' + utils.escapeHtml(tip) + '</span>';
                    html += '</li>';
                });
                html += '</ul>';
                html += '</div>';
            }

            return html;
        }

        function renderHistory() {
            var html = '';

            // Header
            html += '<div class="hero-section relative z-10">';
            html += '<div class="max-w-6xl mx-auto">';
            html += '<div class="flex items-center justify-between mb-6">';
            html += '<a href="javascript:void(0)" onclick="app.navigateTo(\'hub\')" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">';
            html += '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>';
            html += '<span>Back to Tools</span>';
            html += '</a>';
            html += '</div>';
            html += '<h1 class="text-3xl font-bold text-white mb-2">üìú History</h1>';
            html += '</div></div>';

            // History tabs
            html += '<div class="max-w-4xl mx-auto px-4 py-6">';
            html += '<div class="tab-container flex-wrap">';
            var historyTypes = [
                { id: 'script', name: 'Scripts', icon: 'üé¨' },
                { id: 'hooks', name: 'Hooks', icon: 'üé£' },
                { id: 'multiplier', name: 'Content', icon: 'üîÑ' },
                { id: 'thumbnail', name: 'Thumbnails', icon: 'üìä' },
                { id: 'trends', name: 'Trends', icon: 'üéØ' },
                { id: 'gaps', name: 'Gaps', icon: 'üó∫Ô∏è' },
                { id: 'audience', name: 'Audience', icon: 'üß¨' },
                { id: 'collab', name: 'Collabs', icon: 'ü§ù' },
                { id: 'revenue', name: 'Revenue', icon: 'üí∞' },
                { id: 'coach', name: 'Coaching', icon: 'üß†' }
            ];
            historyTypes.forEach(function(type) {
                var active = state.historyType === type.id ? 'active' : '';
                html += '<button class="tab-btn ' + active + '" onclick="app.setHistoryType(\'' + type.id + '\')">' + type.icon + ' ' + type.name + '</button>';
            });
            html += '</div>';

            // History content
            html += '<div class="history-panel">';
            var historyData = [];
            switch (state.historyType) {
                case 'script': historyData = state.script.history; break;
                case 'hooks': historyData = state.hooks.history; break;
                case 'multiplier': historyData = state.multiplier.history; break;
                case 'thumbnail': historyData = state.thumbnailArena.history; break;
                case 'trends': historyData = state.trends.history; break;
                case 'gaps': historyData = state.gaps.history; break;
                case 'audience': historyData = state.audience.history; break;
                case 'collab': historyData = state.collab.history; break;
                case 'revenue': historyData = state.revenue.history; break;
                case 'coach': historyData = state.coach.history; break;
            }

            if (historyData.length === 0) {
                html += '<div class="p-8 text-center">';
                html += '<div class="text-4xl mb-2">üì≠</div>';
                html += '<p class="text-gray-400">No history yet</p>';
                html += '</div>';
            } else {
                historyData.forEach(function(item) {
                    html += '<div class="history-item">';
                    html += '<div class="flex items-center justify-between">';
                    html += '<div>';
                    html += '<p class="text-white font-medium">' + utils.escapeHtml(item.title || item.topic || 'Untitled') + '</p>';
                    html += '<p class="text-gray-500 text-sm">' + utils.formatDate(item.createdAt) + '</p>';
                    html += '</div>';
                    html += '<button class="text-indigo-400 hover:text-indigo-300 text-sm">View ‚Üí</button>';
                    html += '</div>';
                    html += '</div>';
                });
            }
            html += '</div>';

            html += '</div>';

            return html;
        }

        function renderToolHeader(title, icon, colorClass, cost) {
            var html = '';
            html += '<div class="hero-section relative z-10">';
            html += '<div class="max-w-6xl mx-auto">';
            html += '<div class="flex items-center justify-between mb-4">';
            html += '<a href="javascript:void(0)" onclick="app.navigateTo(\'hub\')" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">';
            html += '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>';
            html += '<span>Back to Tools</span>';
            html += '</a>';
            html += '<div class="token-display">';
            html += '<span class="text-2xl">ü™ô</span>';
            html += '<span class="font-bold text-white">' + state.tokens.balance + '</span>';
            html += '</div>';
            html += '</div>';
            html += '<div class="flex items-center gap-4">';
            html += '<div class="text-5xl">' + icon + '</div>';
            html += '<div>';
            html += '<h1 class="text-3xl font-bold text-white">' + title + '</h1>';
            html += '<p class="text-gray-400">' + cost + '</p>';
            html += '</div>';
            html += '</div>';
            html += '</div></div>';
            return html;
        }

        /* ==========================================
           4.6 APPLICATION METHODS
           ========================================== */

        const app = {
            navigateTo: function(view) {
                state.currentView = view;
                render();
                window.scrollTo(0, 0);
            },

            // Toggle category for mobile collapsible sections
            toggleCategory: function(categoryId) {
                var section = document.querySelector('[data-category="' + categoryId + '"]');
                if (section) {
                    section.classList.toggle('expanded');
                }
            },

            // Token loading
            loadTokens: function() {
                if (!auth.currentUser) return;

                functions.httpsCallable('getCreativeTokens')({})
                    .then(function(result) {
                        state.tokens = {
                            balance: result.data.balance || 0,
                            plan: result.data.plan || 'free',
                            rollover: result.data.rollover || 0
                        };
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error loading tokens:', error);
                    });
            },

            // Script Studio methods
            setScriptTone: function(tone) {
                state.script.tone = tone;
                render();
            },

            setScriptLength: function(length) {
                state.script.length = length;
                render();
            },

            generateScript: function() {
                var topic = document.getElementById('script-topic').value.trim();
                if (!topic) {
                    utils.showToast('Please enter a video topic', 'error');
                    return;
                }

                state.script.topic = topic;
                state.script.includeHook = document.getElementById('include-hook').checked;
                state.script.includeCTA = document.getElementById('include-cta').checked;
                state.loading = true;
                render();

                functions.httpsCallable('generateScript')({
                    topic: topic,
                    tone: state.script.tone,
                    length: state.script.length,
                    includeHook: state.script.includeHook,
                    includeCTA: state.script.includeCTA
                })
                .then(function(result) {
                    state.loading = false;
                    state.script.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Script generated successfully!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to generate script', 'error');
                    render();
                });
            },

            clearScriptResult: function() {
                state.script.result = null;
                state.script.topic = '';
                render();
            },

            copyFullScript: function() {
                var result = state.script.result;
                var fullScript = '';
                if (result.hook) fullScript += '=== HOOK ===\n' + result.hook + '\n\n';
                if (result.intro) fullScript += '=== INTRODUCTION ===\n' + result.intro + '\n\n';
                if (result.mainContent) fullScript += '=== MAIN CONTENT ===\n' + result.mainContent + '\n\n';
                if (result.cta) fullScript += '=== CALL TO ACTION ===\n' + result.cta;

                navigator.clipboard.writeText(fullScript).then(function() {
                    utils.showToast('Full script copied!', 'success');
                });
            },

            // Hook Lab methods
            setHookStyle: function(style) {
                state.hooks.style = style;
                render();
            },

            setHookCount: function(count) {
                state.hooks.count = count;
                render();
            },

            generateHooks: function() {
                var topic = document.getElementById('hook-topic').value.trim();
                if (!topic) {
                    utils.showToast('Please enter a video topic', 'error');
                    return;
                }

                state.hooks.topic = topic;
                state.loading = true;
                render();

                functions.httpsCallable('generateHooks')({
                    topic: topic,
                    style: state.hooks.style,
                    count: state.hooks.count
                })
                .then(function(result) {
                    state.loading = false;
                    state.hooks.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Hooks generated successfully!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to generate hooks', 'error');
                    render();
                });
            },

            clearHookResult: function() {
                state.hooks.result = null;
                state.hooks.topic = '';
                render();
            },

            // Content Multiplier methods
            toggleMultiplierFormat: function(format) {
                var index = state.multiplier.formats.indexOf(format);
                if (index > -1) {
                    state.multiplier.formats.splice(index, 1);
                } else {
                    state.multiplier.formats.push(format);
                }
                render();
            },

            multiplyContent: function() {
                var transcript = document.getElementById('multiplier-transcript').value.trim();
                if (!transcript) {
                    utils.showToast('Please enter a transcript', 'error');
                    return;
                }

                if (state.multiplier.formats.length === 0) {
                    utils.showToast('Please select at least one output format', 'error');
                    return;
                }

                state.multiplier.transcript = transcript;
                state.loading = true;
                render();

                functions.httpsCallable('multiplyContent')({
                    transcript: transcript,
                    formats: state.multiplier.formats
                })
                .then(function(result) {
                    state.loading = false;
                    state.multiplier.result = result.data.content;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Content multiplied successfully!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to multiply content', 'error');
                    render();
                });
            },

            clearMultiplierResult: function() {
                state.multiplier.result = null;
                state.multiplier.transcript = '';
                render();
            },

            showMultiplierTab: function(tab) {
                // Hide all tabs
                var tabs = document.querySelectorAll('[id^="multiplier-tab-"]');
                tabs.forEach(function(t) { t.style.display = 'none'; });

                // Show selected tab
                var selectedTab = document.getElementById('multiplier-tab-' + tab);
                if (selectedTab) selectedTab.style.display = 'block';

                // Update tab buttons
                var buttons = document.querySelectorAll('.tab-btn');
                buttons.forEach(function(btn) {
                    btn.classList.remove('active');
                    if (btn.textContent.toLowerCase().includes(tab)) {
                        btn.classList.add('active');
                    }
                });
            },

            // Thumbnail Arena methods
            handleThumbnailUpload: function(slot, event) {
                var file = event.target.files[0];
                if (!file) return;

                var reader = new FileReader();
                reader.onload = function(e) {
                    var index = slot === 'a' ? 0 : 1;
                    state.thumbnailArena.thumbnails[index] = {
                        file: file,
                        preview: e.target.result,
                        base64: e.target.result.split(',')[1]
                    };
                    render();
                };
                reader.readAsDataURL(file);
            },

            analyzeThumbnails: function() {
                if (state.thumbnailArena.thumbnails.length < 2) {
                    utils.showToast('Please upload at least 2 thumbnails', 'error');
                    return;
                }

                state.loading = true;
                render();

                functions.httpsCallable('analyzeThumbnails')({
                    thumbnailA: {
                        base64: state.thumbnailArena.thumbnails[0].base64,
                        mimeType: state.thumbnailArena.thumbnails[0].file.type
                    },
                    thumbnailB: {
                        base64: state.thumbnailArena.thumbnails[1].base64,
                        mimeType: state.thumbnailArena.thumbnails[1].file.type
                    }
                })
                .then(function(result) {
                    state.loading = false;
                    state.thumbnailArena.analysisResult = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Analysis complete!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to analyze thumbnails', 'error');
                    render();
                });
            },

            clearThumbnailResult: function() {
                state.thumbnailArena.analysisResult = null;
                state.thumbnailArena.thumbnails = [];
                render();
            },

            // Trend Hijacker methods
            setTrendRegion: function(region) {
                state.trends.region = region;
                render();
            },

            setTrendTimeframe: function(timeframe) {
                state.trends.timeframe = timeframe;
                render();
            },

            generateTrends: function() {
                var niche = document.getElementById('trend-niche').value.trim();
                if (!niche) {
                    utils.showToast('Please enter your niche or topic area', 'error');
                    return;
                }

                state.trends.niche = niche;
                state.loading = true;
                render();

                functions.httpsCallable('generateTrendReport')({
                    niche: niche,
                    region: state.trends.region,
                    timeframe: state.trends.timeframe
                })
                .then(function(result) {
                    state.loading = false;
                    state.trends.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Trending topics found!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to find trends', 'error');
                    render();
                });
            },

            resetTrends: function() {
                state.trends.result = null;
                state.trends.niche = '';
                render();
            },

            // Content Gap Finder methods
            setGapDepth: function(depth) {
                state.gaps.depth = depth;
                render();
            },

            findGaps: function() {
                var niche = document.getElementById('gap-niche').value.trim();
                if (!niche) {
                    utils.showToast('Please enter your niche or topic area', 'error');
                    return;
                }

                var competitors = document.getElementById('gap-competitors').value.trim();

                state.gaps.niche = niche;
                state.gaps.competitors = competitors;
                state.loading = true;
                render();

                functions.httpsCallable('findContentGaps')({
                    niche: niche,
                    competitors: competitors,
                    depth: state.gaps.depth
                })
                .then(function(result) {
                    state.loading = false;
                    state.gaps.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Content gaps discovered!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to find content gaps', 'error');
                    render();
                });
            },

            resetGaps: function() {
                state.gaps.result = null;
                state.gaps.niche = '';
                state.gaps.competitors = '';
                render();
            },

            // Audience DNA Analyzer methods
            setAudienceDepth: function(depth) {
                state.audience.depth = depth;
                render();
            },

            analyzeAudience: function() {
                var niche = document.getElementById('audience-niche').value.trim();
                if (!niche) {
                    utils.showToast('Please enter your niche or content area', 'error');
                    return;
                }

                var channelUrl = document.getElementById('audience-channel').value.trim();

                state.audience.niche = niche;
                state.audience.channelUrl = channelUrl;
                state.loading = true;
                render();

                functions.httpsCallable('analyzeAudienceDNA')({
                    niche: niche,
                    channelUrl: channelUrl,
                    depth: state.audience.depth
                })
                .then(function(result) {
                    state.loading = false;
                    state.audience.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Audience analysis complete!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to analyze audience', 'error');
                    render();
                });
            },

            resetAudience: function() {
                state.audience.result = null;
                state.audience.niche = '';
                state.audience.channelUrl = '';
                render();
            },

            // Collab Matchmaker methods
            setCollabSize: function(size) {
                state.collab.channelSize = size;
                render();
            },

            setCollabStyle: function(style) {
                state.collab.contentStyle = style;
                render();
            },

            findCollabs: function() {
                var niche = document.getElementById('collab-niche').value.trim();
                if (!niche) {
                    utils.showToast('Please enter your niche or content area', 'error');
                    return;
                }

                state.collab.niche = niche;
                state.loading = true;
                render();

                functions.httpsCallable('findCollabPartners')({
                    niche: niche,
                    channelSize: state.collab.channelSize,
                    contentStyle: state.collab.contentStyle
                })
                .then(function(result) {
                    state.loading = false;
                    state.collab.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Collaboration partners found!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to find partners', 'error');
                    render();
                });
            },

            resetCollab: function() {
                state.collab.result = null;
                state.collab.niche = '';
                render();
            },

            // Revenue Maximizer methods
            setRevenueSize: function(size) {
                state.revenue.audienceSize = size;
                render();
            },

            toggleRevenueMethod: function(method) {
                var index = state.revenue.currentMethods.indexOf(method);
                if (index > -1) {
                    state.revenue.currentMethods.splice(index, 1);
                } else {
                    state.revenue.currentMethods.push(method);
                }
                render();
            },

            analyzeRevenue: function() {
                var niche = document.getElementById('revenue-niche').value.trim();
                if (!niche) {
                    utils.showToast('Please enter your niche or content area', 'error');
                    return;
                }

                state.revenue.niche = niche;
                state.loading = true;
                render();

                functions.httpsCallable('analyzeRevenue')({
                    niche: niche,
                    audienceSize: state.revenue.audienceSize,
                    currentMethods: state.revenue.currentMethods
                })
                .then(function(result) {
                    state.loading = false;
                    state.revenue.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Revenue opportunities found!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to analyze revenue', 'error');
                    render();
                });
            },

            resetRevenue: function() {
                state.revenue.result = null;
                state.revenue.niche = '';
                state.revenue.currentMethods = [];
                render();
            },

            // AI Video Coach methods
            setCoachFocus: function(focus) {
                state.coach.focusArea = focus;
                render();
            },

            getCoaching: function() {
                var videoUrl = document.getElementById('coach-video').value.trim();
                var transcript = document.getElementById('coach-transcript').value.trim();
                var challenge = document.getElementById('coach-challenge').value.trim();

                if (!challenge && !transcript && !videoUrl) {
                    utils.showToast('Please provide some context for coaching', 'error');
                    return;
                }

                state.coach.videoUrl = videoUrl;
                state.coach.transcript = transcript;
                state.coach.challenge = challenge;
                state.loading = true;
                render();

                functions.httpsCallable('getVideoCoaching')({
                    videoUrl: videoUrl,
                    transcript: transcript,
                    challenge: challenge,
                    focusArea: state.coach.focusArea
                })
                .then(function(result) {
                    state.loading = false;
                    state.coach.result = result.data;
                    state.tokens.balance = result.data.remainingBalance || state.tokens.balance;
                    utils.showToast('Coaching session complete!', 'success');
                    render();
                })
                .catch(function(error) {
                    state.loading = false;
                    utils.showToast(error.message || 'Failed to get coaching', 'error');
                    render();
                });
            },

            resetCoach: function() {
                state.coach.result = null;
                state.coach.videoUrl = '';
                state.coach.transcript = '';
                state.coach.challenge = '';
                render();
            },

            // History methods
            setHistoryType: function(type) {
                state.historyType = type;
                render();
            },

            loadHistory: function(type) {
                if (!auth.currentUser) return;

                var collectionName = '';
                switch (type) {
                    case 'script': collectionName = 'scriptHistory'; break;
                    case 'hooks': collectionName = 'hookHistory'; break;
                    case 'multiplier': collectionName = 'contentMultiplierHistory'; break;
                    case 'thumbnail': collectionName = 'thumbnailTestHistory'; break;
                    case 'trends': collectionName = 'trendHistory'; break;
                    case 'gaps': collectionName = 'contentGapHistory'; break;
                    case 'audience': collectionName = 'audienceHistory'; break;
                    case 'collab': collectionName = 'collabHistory'; break;
                    case 'revenue': collectionName = 'revenueHistory'; break;
                    case 'coach': collectionName = 'coachHistory'; break;
                }

                db.collection(collectionName)
                    .where('userId', '==', auth.currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get()
                    .then(function(snapshot) {
                        var history = [];
                        snapshot.forEach(function(doc) {
                            history.push({ id: doc.id, ...doc.data() });
                        });

                        switch (type) {
                            case 'script': state.script.history = history; break;
                            case 'hooks': state.hooks.history = history; break;
                            case 'multiplier': state.multiplier.history = history; break;
                            case 'thumbnail': state.thumbnailArena.history = history; break;
                            case 'trends': state.trends.history = history; break;
                            case 'gaps': state.gaps.history = history; break;
                            case 'audience': state.audience.history = history; break;
                            case 'collab': state.collab.history = history; break;
                            case 'revenue': state.revenue.history = history; break;
                            case 'coach': state.coach.history = history; break;
                        }
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error loading history:', error);
                    });
            }
        };

        // Make app and utils available globally
        window.app = app;
        window.utils = utils;

        /* ==========================================
           4.7 EVENT LISTENERS
           ========================================== */

        function attachEventListeners() {
            // Add any dynamic event listeners here
        }

        /* ==========================================
           4.8 INITIALIZATION
           ========================================== */

        auth.onAuthStateChanged(function(user) {
            if (user) {
                state.user = user;
                state.currentView = 'hub';
                app.loadTokens();
                render();
            } else {
                state.user = null;
                state.currentView = 'login';
                render();
            }
        });

        // Initial render
        render();

    })();
    </script>
</body>
</html>
