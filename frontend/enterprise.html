<!-- ================================================================
     YOUTUBE VIDEO OPTIMIZER - ENTERPRISE SUITE
     ================================================================

     Structure:
     - SECTION 1: External Dependencies (CDN)
     - SECTION 2: Styles (CSS)
     - SECTION 3: HTML Container
     - SECTION 4: Scripts (JavaScript)

     Tools: Bulk Video Optimizer, Placement Finder, Viral Score Predictor,
            Monetization Analyzer, Script Writer Pro

     Access: PRO & Enterprise plans only

     Main Dashboard URL: https://ytseo.siteuo.com/video-optimizer

     Last Updated: 2024
     ================================================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Enterprise Suite - YouTube Video Optimizer</title>

    <!-- PWA Manifest & Theme (Inline - no external file needed) -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"YouTube Video Optimizer","short_name":"YT Optimizer","description":"AI-powered YouTube video optimization and campaign analysis platform","start_url":"/main-dashboard.html","display":"standalone","background_color":"#0f172a","theme_color":"#7c3aed","orientation":"portrait-primary","icons":[{"src":"https://ytseo.siteuo.com/icon-192.png","sizes":"192x192","type":"image/png","purpose":"any maskable"},{"src":"https://ytseo.siteuo.com/icon-512.png","sizes":"512x512","type":"image/png","purpose":"any maskable"}],"categories":["productivity","business","utilities"],"lang":"en","dir":"ltr"}'>
    <meta name="theme-color" content="#7c3aed">

    <!-- ============================================
         SECTION 1: EXTERNAL DEPENDENCIES
         ============================================ -->

    <!-- 1.1 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1.2 Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>

    <!-- 1.3 PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- ============================================
         SECTION 2: STYLES
         ============================================ -->
    <style>
        /* ------------------------------------------
           2.1 BASE & RESET
           ------------------------------------------ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app-root {
            width: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        /* ------------------------------------------
           2.2 ANIMATIONS
           ------------------------------------------ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }

        /* ------------------------------------------
           2.3 PREMIUM GOLD STYLING
           ------------------------------------------ */
        .gold-gradient {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 50%, #f5af19 100%);
        }

        .gold-text {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gold-border {
            border: 2px solid transparent;
            background: linear-gradient(#1a1a2e, #1a1a2e) padding-box,
                        linear-gradient(135deg, #ffd700, #ff8c00, #ffd700) border-box;
        }

        .premium-card {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 140, 0, 0.05) 100%);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .premium-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 140, 0, 0.1) 100%);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        /* ------------------------------------------
           2.4 NAVIGATION TABS
           ------------------------------------------ */
        .tool-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
        }

        .tool-tab {
            flex: 1;
            min-width: 140px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tool-tab:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        .tool-tab.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 140, 0, 0.15) 100%);
            border-color: #ffd700;
            color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .tool-tab-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .tool-tab-name {
            font-size: 0.85rem;
        }

        /* ------------------------------------------
           2.5 BUTTONS
           ------------------------------------------ */
        .btn-primary {
            padding: 0.875rem 1.75rem;
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #1a1a2e;
            font-weight: 700;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            padding: 0.875rem 1.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* History tab buttons */
        .tab-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .tab-btn.active {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        /* History item hover effect */
        .history-item:hover {
            transform: translateY(-2px);
        }

        /* ------------------------------------------
           2.6 FORM INPUTS
           ------------------------------------------ */
        .input-field {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea.input-field {
            resize: vertical;
            min-height: 120px;
        }

        /* ------------------------------------------
           2.7 LOCKED OVERLAY
           ------------------------------------------ */
        .locked-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .locked-card {
            background: linear-gradient(145deg, #1e1e3f 0%, #0f0f23 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 1.5rem;
            padding: 3rem;
            max-width: 500px;
            text-align: center;
        }

        .locked-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Upgrade Modal Popup */
        .upgrade-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .upgrade-modal {
            background: linear-gradient(145deg, #1e1e3f 0%, #0f0f23 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.1);
        }

        .upgrade-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 2rem;
            height: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* ------------------------------------------
           2.8 RESULTS & CARDS
           ------------------------------------------ */
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .score-high {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .score-medium {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .score-low {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ------------------------------------------
           2.9 PROGRESS BAR
           ------------------------------------------ */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700 0%, #ff8c00 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* ------------------------------------------
           2.9b PDF DOWNLOAD BUTTON
           ------------------------------------------ */
        .btn-pdf {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            border: none;
            border-radius: 0.625rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-pdf:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }

        .btn-pdf:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ------------------------------------------
           2.10 LOADING STATES
           ------------------------------------------ */
        .loading-emoji {
            display: inline-block;
            font-size: 2rem;
            animation: float 1.5s ease-in-out infinite;
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 0.5rem;
        }

        /* ------------------------------------------
           2.11 TABLES
           ------------------------------------------ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 1rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: white;
        }

        .data-table tr:hover td {
            background: rgba(255, 215, 0, 0.05);
        }

        /* ------------------------------------------
           2.11b GLOBAL HEADER (Fixed Top-Right)
           ------------------------------------------ */
        .global-header { position: fixed; top: 0; right: 1.5rem; padding: 1rem 0; z-index: 1000; display: flex; align-items: center; gap: 0.75rem; pointer-events: none; }
        .global-header > * { pointer-events: auto; }
        .global-header-content { display: flex; align-items: center; gap: 0.75rem; }
        .plan-badge { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 9999px; font-size: 0.8rem; font-weight: 600; color: #ffd700; backdrop-filter: blur(10px); }
        .notification-bell { position: relative; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1); border-radius: 50%; transition: all 0.2s ease; }
        .notification-bell:hover { background: rgba(255, 255, 255, 0.2); }
        .token-display { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 20px; cursor: pointer; transition: all 0.2s ease; }
        .token-display:hover { background: linear-gradient(135deg, rgba(251, 191, 36, 0.3) 0%, rgba(245, 158, 11, 0.3) 100%); border-color: rgba(251, 191, 36, 0.5); transform: scale(1.02); }
        .token-icon { font-size: 1.1rem; }
        .token-amount { font-size: 0.9rem; font-weight: 700; color: #fbbf24; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); }
        .notification-badge { position: absolute; top: -4px; right: -4px; min-width: 18px; height: 18px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; font-size: 10px; font-weight: 700; border-radius: 9px; display: flex; align-items: center; justify-content: center; padding: 0 5px; }
        .notification-dropdown { position: absolute; top: 100%; right: 0; width: 360px; max-height: 480px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4); overflow: hidden; z-index: 1001; margin-top: 8px; }
        .notification-tabs { display: flex; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(0, 0, 0, 0.2); }
        .notification-tab { flex: 1; padding: 0.875rem 1rem; font-size: 0.85rem; font-weight: 600; color: rgba(255, 255, 255, 0.5); background: transparent; border: none; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; position: relative; }
        .notification-tab:hover { color: rgba(255, 255, 255, 0.8); }
        .notification-tab.active { color: white; background: rgba(255, 255, 255, 0.1); }
        .notification-tab.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #ffd700, #ff8c00); }
        .notification-tab-badge { min-width: 18px; height: 18px; padding: 0 5px; font-size: 10px; font-weight: 700; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border-radius: 9px; display: flex; align-items: center; justify-content: center; }
        .notification-list { max-height: 320px; overflow-y: auto; }
        .notification-item { padding: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.05); cursor: pointer; transition: background 0.2s; }
        .notification-item:hover { background: rgba(255, 255, 255, 0.05); }
        .notification-empty { padding: 2.5rem 1.5rem; text-align: center; color: rgba(255, 255, 255, 0.5); }
        .notification-overlay { position: fixed; inset: 0; z-index: 999; }
        .user-menu-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 9999px; color: white; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .user-menu-btn:hover { background: rgba(255, 255, 255, 0.15); }

        /* Global header mobile responsive */
        @media (max-width: 768px) {
            .global-header { right: 1rem; }
            .global-header-content { gap: 0.5rem; }
            .plan-badge span:last-child { display: none; }
            .notification-dropdown { width: 300px; right: 0; }
        }

        /* ------------------------------------------
           2.12 TOAST NOTIFICATIONS
           ------------------------------------------ */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            z-index: 200;
            animation: fadeIn 0.3s ease;
        }

        .toast-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* ------------------------------------------
           2.13 RESPONSIVE - MOBILE SCROLLABLE GRID
           ------------------------------------------ */

        /* Container for scrollable tool tabs - Desktop (no constraints) */
        .tool-tabs-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .tool-tabs-fade {
            display: none;
        }

        /* Mobile: Scrollable 2-column grid */
        @media (max-width: 768px) {
            .tool-tabs-container {
                position: relative;
                margin-bottom: 1rem;
            }

            .tool-tabs {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
                padding: 0.75rem;
                padding-bottom: 1rem;

                /* Scrollable container */
                max-height: 280px;
                overflow-y: auto;
                overflow-x: hidden;
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;

                /* Modern scrollbar styling */
                scrollbar-width: thin;
                scrollbar-color: rgba(255, 215, 0, 0.3) transparent;
            }

            /* Webkit scrollbar styling */
            .tool-tabs::-webkit-scrollbar {
                width: 4px;
            }

            .tool-tabs::-webkit-scrollbar-track {
                background: transparent;
            }

            .tool-tabs::-webkit-scrollbar-thumb {
                background: rgba(255, 215, 0, 0.3);
                border-radius: 4px;
            }

            .tool-tabs::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 215, 0, 0.5);
            }

            /* Fade gradient at bottom to indicate more content */
            .tool-tabs-fade {
                display: block;
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 40px;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
                pointer-events: none;
                border-radius: 0 0 1rem 1rem;
                z-index: 5;
            }

            .tool-tab {
                min-width: unset;
                padding: 0.75rem 0.5rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 0.25rem;
            }

            .tool-tab-icon {
                font-size: 1.5rem;
                margin: 0;
            }

            .tool-tab-name {
                font-size: 0.7rem;
                line-height: 1.2;
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100%;
            }
        }

        /* Extra small screens - even more compact */
        @media (max-width: 380px) {
            .tool-tabs {
                max-height: 240px;
                gap: 0.35rem;
                padding: 0.5rem;
                padding-bottom: 0.75rem;
            }

            .tool-tab {
                padding: 0.6rem 0.4rem;
            }

            .tool-tab-icon {
                font-size: 1.3rem;
            }

            .tool-tab-name {
                font-size: 0.65rem;
            }

            .tool-tabs-fade {
                height: 30px;
            }
        }

        /* ------------------------------------------
           2.14 VIRAL TIPS ACCORDION
           ------------------------------------------ */
        .tip-accordion {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .tip-header {
            padding: 1rem 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .tip-header:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .tip-content {
            padding: 0 1.25rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.7;
        }

        /* ------------------------------------------
           2.15 MONETIZATION CARDS
           ------------------------------------------ */
        .earning-card {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
        }

        .earning-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: #22c55e;
        }

        /* ------------------------------------------
           2.16 SCRIPT OUTPUT
           ------------------------------------------ */
        .script-output {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1.5rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            white-space: pre-wrap;
            color: rgba(255, 255, 255, 0.9);
            max-height: 500px;
            overflow-y: auto;
        }

        /* ------------------------------------------
           2.17 SMART DASHBOARD
           ------------------------------------------ */
        .smart-dashboard {
            padding: 1rem 0;
        }

        .dashboard-tool-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .dashboard-tool-card:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .dashboard-tool-card.recommended {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.08) 0%, rgba(255, 165, 0, 0.05) 100%);
            border-color: rgba(255, 215, 0, 0.2);
        }

        .tool-card-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }

        .tool-card-name {
            font-weight: 600;
            color: white;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .tool-card-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            line-height: 1.4;
        }

        /* ------------------------------------------
           2.18 COMMAND PALETTE (SPOTLIGHT)
           ------------------------------------------ */
        .command-palette-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10vh;
        }

        .command-palette {
            width: 100%;
            max-width: 580px;
            margin: 0 1rem;
            background: linear-gradient(180deg, rgba(30, 30, 40, 0.98) 0%, rgba(20, 20, 30, 0.98) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 1.25rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            overflow: hidden;
        }

        .command-palette-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .command-palette-header input {
            font-size: 1.125rem;
        }

        .command-palette-body {
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .command-section {
            margin-bottom: 0.5rem;
        }

        .command-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255, 255, 255, 0.4);
            padding: 0.5rem 0.75rem;
            font-weight: 600;
        }

        .command-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .command-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .command-item.recent {
            border-left: 2px solid rgba(255, 215, 0, 0.4);
        }

        .command-item-icon {
            font-size: 1.5rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
        }

        .command-item-content {
            flex: 1;
            min-width: 0;
        }

        .command-item-name {
            font-weight: 600;
            color: white;
            font-size: 0.95rem;
        }

        .command-item-desc {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .command-item-hint {
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
        }

        .command-palette-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1rem;
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .command-palette-footer kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            font-family: inherit;
            margin-right: 0.25rem;
        }

        /* ------------------------------------------
           2.19 FLOATING SEARCH BUTTON (FAB)
           ------------------------------------------ */
        .floating-search-btn {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 50px;
            padding: 0.875rem 1.25rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(251, 191, 36, 0.5);
        }

        .floating-search-btn .fab-icon {
            font-size: 1.25rem;
        }

        /* Hide text on very small screens */
        @media (max-width: 400px) {
            .floating-search-btn {
                border-radius: 50%;
                padding: 1rem;
            }
            .floating-search-btn .fab-text {
                display: none;
            }
        }

        /* ------------------------------------------
           2.20 SLIDE UP ANIMATION
           ------------------------------------------ */
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .dashboard-tool-card {
                padding: 1rem;
            }
            .tool-card-icon {
                font-size: 2rem;
            }
            .tool-card-name {
                font-size: 0.85rem;
            }
            .command-palette {
                max-width: 100%;
                margin: 0 0.5rem;
                border-radius: 1rem;
            }
            .command-palette-body {
                max-height: 50vh;
            }
        }

        /* PWA Install Button */
        .a2hs-native-button {
            position: fixed; bottom: 20px; right: 20px; z-index: 9999;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white; border: none; padding: 16px 28px; border-radius: 50px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
            display: none; align-items: center; gap: 10px; transition: all 0.3s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .a2hs-native-button.show { display: flex; }
        .a2hs-native-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(124, 58, 237, 0.5); }
        .a2hs-icon { font-size: 20px; }
        @media (max-width: 768px) { .a2hs-native-button { bottom: 15px; right: 15px; left: 15px; justify-content: center; } }
    </style>
</head>
<body>
    <!-- ============================================
         SECTION 3: HTML CONTAINER
         ============================================ -->
    <div id="app-root"></div>

    <!-- ============================================
         SECTION 4: SCRIPTS
         ============================================ -->
    <script>
        /* ==========================================
           4.0 PLATFORM VERSION
           ========================================== */
        const PLATFORM_VERSION = '1.0.1';

        /* ==========================================
           4.1 FIREBASE CONFIGURATION
           ========================================== */
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAGczY5ZEIJdTq25BpQdia3lv2I556wOZo",
            authDomain: "ytseo-6d1b0.firebaseapp.com",
            projectId: "ytseo-6d1b0",
            storageBucket: "ytseo-6d1b0.firebasestorage.app",
            messagingSenderId: "382790048044",
            appId: "1:382790048044:web:cd427679ff72108c1f3489"
        };

        // Initialize Firebase
        firebase.initializeApp(FIREBASE_CONFIG);
        const auth = firebase.auth();
        const functions = firebase.functions();

        /* ==========================================
           4.2 APPLICATION STATE
           ========================================== */
        const state = {
            // Current state
            currentView: 'loading', // loading | locked | tools | history
            activeTool: 'bulk', // bulk | placement | viral | monetization | script

            // User data
            user: null,
            profile: null,
            userPlan: null, // free | lite | pro | enterprise
            hasPremiumAccess: false, // true if pro or enterprise
            showUpgradeModal: false, // show upgrade popup

            // Unified Notifications System
            notifications: [],
            unreadCount: 0,
            userNotifications: null,
            userNotificationsLoading: false,
            showNotifications: false,
            notificationTab: 'reports',

            // Token System
            tokenBalance: 0,
            showTokenModal: false,
            tokenBypassCosts: null,

            // UI state
            loading: false,
            error: null,
            success: null,

            // Loading progress
            loadingProgress: 0,
            loadingStep: 0,
            loadingSteps: [],
            loadingInterval: null,

            // Tool-specific state
            // Bulk Optimizer
            bulkVideos: [],
            bulkResults: null,
            bulkProcessing: false,
            bulkProgress: 0,

            // Placement Finder
            placementResults: null,
            placementLoading: false,
            copySuccess: null,

            // Viral Score Predictor
            viralResults: null,
            viralLoading: false,

            // Monetization Analyzer
            monetizationResults: null,
            monetizationLoading: false,

            // Script Writer
            scriptResults: null,
            scriptLoading: false,
            scriptStyle: 'engaging', // engaging | educational | storytelling | listicle

            // Sponsorship Rate Calculator
            sponsorshipResults: null,
            sponsorshipLoading: false,

            // Revenue Diversification Analyzer
            diversificationResults: null,
            diversificationLoading: false,

            // CPM Booster Strategist
            cpmBoosterResults: null,
            cpmBoosterLoading: false,

            // Audience Monetization Profiler
            audienceProfileResults: null,
            audienceProfileLoading: false,

            // Digital Product Architect
            digitalProductResults: null,
            digitalProductLoading: false,

            // Affiliate Goldmine Finder
            affiliateResults: null,
            affiliateLoading: false,

            // Video-to-Multi-Income Converter
            multiIncomeResults: null,
            multiIncomeLoading: false,

            // Brand Deal Matchmaker
            brandDealResults: null,
            brandDealLoading: false,

            // Licensing & Syndication Scout
            licensingResults: null,
            licensingLoading: false,

            // Revenue Automation Pipeline
            automationResults: null,
            automationLoading: false,

            // History state
            historyTab: 'all', // all | placement | viral | monetization | script | sponsorship | diversification | cpmbooster | audienceprofile | digitalproduct | affiliate | multiincome | branddeal | licensing | automation
            allHistory: null,
            placementHistory: null,
            viralHistory: null,
            monetizationHistory: null,
            scriptHistory: null,
            sponsorshipHistory: null,
            diversificationHistory: null,
            cpmBoosterHistory: null,
            audienceProfileHistory: null,
            digitalProductHistory: null,
            affiliateHistory: null,
            multiIncomeHistory: null,
            brandDealHistory: null,
            licensingHistory: null,
            automationHistory: null,
            historyCounts: null,

            // Smart Dashboard & Command Palette state
            toolViewMode: 'dashboard', // dashboard | grid
            showCommandPalette: false,
            commandSearchQuery: '',
            recentTools: [], // Array of recently used tool keys (max 4)
            recommendedTools: [] // AI-recommended tools based on context
        };

        /* ==========================================
           4.3 UTILITY FUNCTIONS
           ========================================== */
        const utils = {
            escapeHtml: function(text) {
                if (!text) return '';
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            formatNumber: function(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            },

            formatCurrency: function(amount) {
                return '$' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            },

            // Show notification toast
            showNotification: function(message, type) {
                type = type || 'info';
                var existingToast = document.querySelector('.pdf-toast');
                if (existingToast) existingToast.remove();

                var toast = document.createElement('div');
                toast.className = 'pdf-toast';
                toast.style.cssText = 'position:fixed;top:1rem;right:1rem;padding:1rem 1.5rem;border-radius:0.75rem;font-weight:600;z-index:9999;animation:fadeIn 0.3s ease;max-width:350px;';

                if (type === 'success') {
                    toast.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                } else if (type === 'error') {
                    toast.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                } else {
                    toast.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                }
                toast.style.color = 'white';
                toast.textContent = message;

                document.body.appendChild(toast);
                setTimeout(function() {
                    if (toast.parentNode) toast.remove();
                }, 4000);
            }
        };

        /* ==========================================
           4.4 LOADING PROGRESS
           ========================================== */
        function startLoadingProgress() {
            state.loadingProgress = 0;
            state.loadingStep = 0;

            var stepDuration = 15000 / state.loadingSteps.length;
            var progressPerStep = 100 / state.loadingSteps.length;

            state.loadingInterval = setInterval(function() {
                state.loadingProgress += 0.5;

                var newStep = Math.floor(state.loadingProgress / progressPerStep);
                var stepChanged = false;
                if (newStep > state.loadingStep && newStep < state.loadingSteps.length) {
                    state.loadingStep = newStep;
                    stepChanged = true;
                }

                if (state.loadingProgress >= 95) {
                    state.loadingProgress = 95;
                }

                // OPTIMIZATION: Targeted DOM update instead of full render
                // This prevents page shaking by only updating progress elements
                updateProgressDisplay(stepChanged);
            }, 150);
        }

        // Targeted progress update to prevent page shaking
        function updateProgressDisplay(stepChanged) {
            var progressPercent = document.getElementById('progress-percent');
            var progressFill = document.getElementById('progress-fill');

            if (progressPercent) {
                progressPercent.textContent = Math.round(state.loadingProgress) + '%';
            }
            if (progressFill) {
                progressFill.style.width = state.loadingProgress + '%';
            }

            // Only update step indicators if step changed
            if (stepChanged) {
                var stepContainer = document.getElementById('loading-steps');
                if (stepContainer) {
                    var stepHtml = '';
                    for (var i = 0; i < state.loadingSteps.length; i++) {
                        var step = state.loadingSteps[i];
                        var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                        stepHtml += '<div class="flex items-center gap-2 ' + stepClass + '">';
                        stepHtml += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                        stepHtml += '<span class="text-sm">' + step.name + '</span>';
                        stepHtml += '</div>';
                    }
                    stepContainer.innerHTML = stepHtml;
                }
            }
        }

        function stopLoadingProgress() {
            if (state.loadingInterval) {
                clearInterval(state.loadingInterval);
                state.loadingInterval = null;
            }
            state.loadingProgress = 100;
            state.loadingStep = state.loadingSteps.length;
        }

        /* ==========================================
           4.5 APPLICATION CONTROLLER
           ========================================== */
        const app = {
            // Navigation
            goToDashboard: function() {
                window.location.href = 'https://ytseo.siteuo.com/video-optimizer';
            },

            signOut: function() {
                auth.signOut().then(function() {
                    window.location.href = '/video-optimizer';
                });
            },

            // Unified Notifications
            loadUserNotifications: function() {
                state.userNotificationsLoading = true;
                render();
                functions.httpsCallable('userGetNotifications')({ limit: 20 })
                    .then(function(result) {
                        state.userNotifications = {
                            notifications: result.data.notifications || [],
                            unreadCount: result.data.unreadCount || 0
                        };
                        state.userNotificationsLoading = false;
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error loading notifications:', error);
                        state.userNotificationsLoading = false;
                        render();
                    });
            },

            toggleNotifications: function() {
                state.showNotifications = !state.showNotifications;
                if (state.showNotifications && !state.userNotifications) {
                    this.loadUserNotifications();
                }
                render();
            },

            closeNotifications: function() {
                if (state.showNotifications) {
                    state.showNotifications = false;
                    render();
                }
            },

            // Token Modal Functions
            showTokenModal: function() {
                if (!state.tokenBypassCosts) {
                    this.loadTokenBypassCosts();
                }
                state.showTokenModal = true;
                render();
            },

            hideTokenModal: function() {
                state.showTokenModal = false;
                render();
            },

            loadTokenBypassCosts: function() {
                functions.httpsCallable('getTokenBypassInfo')({ tool: 'all' })
                    .then(function(result) {
                        if (result.data) {
                            state.tokenBypassCosts = result.data.costs || {};
                            if (result.data.balance !== undefined) {
                                state.tokenBalance = result.data.balance;
                            }
                            render();
                        }
                    })
                    .catch(function(error) {
                        console.error('Failed to load token bypass costs:', error);
                    });
            },

            loadTokenBalance: function() {
                functions.httpsCallable('getCreativeTokens')({})
                    .then(function(result) {
                        if (result.data && result.data.balance !== undefined) {
                            state.tokenBalance = result.data.balance;
                            render();
                        }
                    })
                    .catch(function(error) {
                        console.error('Failed to load token balance:', error);
                    });
            },

            topUpTokens: function() {
                utils.showToast('Token TopUp coming soon! Contact support for now.', 'info');
            },

            setNotificationTab: function(tab) {
                state.notificationTab = tab;
                if (tab === 'alerts' && !state.userNotifications && !state.userNotificationsLoading) {
                    this.loadUserNotifications();
                }
                render();
            },

            markAllReportNotificationsRead: function() {
                functions.httpsCallable('markNotificationRead')({ markAll: true })
                    .then(function() {
                        state.notifications = [];
                        state.unreadCount = 0;
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error marking reports read:', error);
                    });
            },

            markAllAlertNotificationsRead: function() {
                functions.httpsCallable('userMarkNotificationRead')({ markAllRead: true })
                    .then(function() {
                        if (state.userNotifications) {
                            state.userNotifications.notifications.forEach(function(n) { n.read = true; });
                            state.userNotifications.unreadCount = 0;
                        }
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error marking alerts read:', error);
                    });
            },

            handleAlertNotificationClick: function(notificationId) {
                functions.httpsCallable('userMarkNotificationRead')({ notificationId: notificationId })
                    .then(function() {
                        if (state.userNotifications) {
                            var notif = state.userNotifications.notifications.find(function(n) { return n.id === notificationId; });
                            if (notif && !notif.read) {
                                notif.read = true;
                                state.userNotifications.unreadCount = Math.max(0, state.userNotifications.unreadCount - 1);
                            }
                        }
                        render();
                    })
                    .catch(function(error) {
                        console.error('Error marking alert read:', error);
                    });
            },

            openNotificationReport: function(reportId, notificationId) {
                functions.httpsCallable('markNotificationRead')({ notificationId: notificationId })
                    .then(function() {
                        state.notifications = state.notifications.filter(function(n) { return n.id !== notificationId; });
                        state.unreadCount = Math.max(0, state.unreadCount - 1);
                        state.showNotifications = false;
                        window.location.href = '/video-optimizer?view=report&id=' + reportId;
                    })
                    .catch(function(error) {
                        console.error('Error opening report:', error);
                    });
            },

            setActiveTool: function(tool) {
                state.activeTool = tool;
                state.toolViewMode = 'grid'; // Switch to grid mode when selecting a tool
                state.error = null;
                state.success = null;

                // Track recent tools (max 4, no duplicates)
                if (tool) {
                    var recent = state.recentTools || [];
                    var idx = recent.indexOf(tool);
                    if (idx !== -1) {
                        recent.splice(idx, 1);
                    }
                    recent.unshift(tool);
                    state.recentTools = recent.slice(0, 4);

                    // Save to localStorage for persistence
                    try {
                        localStorage.setItem('enterprise_recent_tools', JSON.stringify(state.recentTools));
                    } catch (e) {}
                }

                render();
            },

            // Smart Dashboard Navigation
            backToToolDashboard: function() {
                state.activeTool = null;
                state.toolViewMode = 'dashboard';
                state.error = null;
                state.success = null;
                render();
            },

            showAllTools: function() {
                state.toolViewMode = 'grid';
                state.activeTool = 'bulk'; // Default to first tool
                render();
            },

            clearRecentTools: function() {
                state.recentTools = [];
                try {
                    localStorage.removeItem('enterprise_recent_tools');
                } catch (e) {}
                render();
            },

            // Command Palette Methods
            openCommandPalette: function() {
                state.showCommandPalette = true;
                state.commandSearchQuery = '';
                render();

                // Focus the search input after render
                setTimeout(function() {
                    var input = document.getElementById('command-search-input');
                    if (input) input.focus();
                }, 50);
            },

            closeCommandPalette: function() {
                state.showCommandPalette = false;
                state.commandSearchQuery = '';
                render();
            },

            updateCommandSearch: function(query) {
                state.commandSearchQuery = query;
                render();

                // Re-focus input after render
                setTimeout(function() {
                    var input = document.getElementById('command-search-input');
                    if (input) {
                        input.focus();
                        input.setSelectionRange(query.length, query.length);
                    }
                }, 10);
            },

            selectTool: function(toolKey) {
                state.showCommandPalette = false;
                state.commandSearchQuery = '';
                this.setActiveTool(toolKey);
            },

            goToTools: function() {
                state.currentView = 'tools';
                state.error = null;
                render();
            },

            // History Navigation
            goToHistory: function(tab) {
                state.currentView = 'history';
                state.error = null;
                state.loading = true;
                state.historyTab = tab || 'all';
                state.allHistory = null;
                state.placementHistory = null;
                state.viralHistory = null;
                state.monetizationHistory = null;
                state.scriptHistory = null;
                state.historyCounts = null;
                render();

                // Fetch history from backend
                functions.httpsCallable('getAllHistory')({ limit: 20 })
                    .then(function(result) {
                        var data = result.data;
                        state.allHistory = data.history.all || [];
                        state.placementHistory = data.history.placements || [];
                        state.viralHistory = data.history.viral || [];
                        state.monetizationHistory = data.history.monetization || [];
                        state.scriptHistory = data.history.scripts || [];
                        state.historyCounts = data.counts || {};
                        state.loading = false;
                        render();
                    })
                    .catch(function(e) {
                        console.error('Failed to load history:', e);
                        state.loading = false;
                        state.error = 'Failed to load history';
                        render();
                    });
            },

            setHistoryTab: function(tab) {
                state.historyTab = tab;
                render();
            },

            // View history item details
            viewHistoryItem: function(id, type) {
                // Find the item from the appropriate history array
                var item = null;
                var allItems = [];

                // Combine all history arrays to search
                if (state.allHistory) allItems = allItems.concat(state.allHistory);
                if (state.placementHistory) allItems = allItems.concat(state.placementHistory);
                if (state.viralHistory) allItems = allItems.concat(state.viralHistory);
                if (state.monetizationHistory) allItems = allItems.concat(state.monetizationHistory);
                if (state.scriptHistory) allItems = allItems.concat(state.scriptHistory);
                if (state.sponsorshipHistory) allItems = allItems.concat(state.sponsorshipHistory);
                if (state.diversificationHistory) allItems = allItems.concat(state.diversificationHistory);
                if (state.cpmBoosterHistory) allItems = allItems.concat(state.cpmBoosterHistory);
                if (state.audienceProfileHistory) allItems = allItems.concat(state.audienceProfileHistory);
                if (state.digitalProductHistory) allItems = allItems.concat(state.digitalProductHistory);
                if (state.affiliateHistory) allItems = allItems.concat(state.affiliateHistory);
                if (state.multiIncomeHistory) allItems = allItems.concat(state.multiIncomeHistory);
                if (state.brandDealHistory) allItems = allItems.concat(state.brandDealHistory);
                if (state.licensingHistory) allItems = allItems.concat(state.licensingHistory);
                if (state.automationHistory) allItems = allItems.concat(state.automationHistory);

                // Find the item by ID
                for (var i = 0; i < allItems.length; i++) {
                    if (allItems[i].id === id) {
                        item = allItems[i];
                        break;
                    }
                }

                if (!item) {
                    state.error = 'Could not find the history item';
                    render();
                    return;
                }

                // Set the results based on type and navigate to the tool
                state.currentView = 'tools';
                state.error = null;

                if (type === 'placement') {
                    // Map history item to placementResults format
                    state.placementResults = {
                        placements: item.placements || [],
                        channelInfo: item.channelInfo || {},
                        analysis: item.analysis || {},
                        totalFound: item.totalFound || (item.placements ? item.placements.length : 0),
                        historyId: item.id
                    };
                    state.activeTool = 'placement';
                } else if (type === 'viral') {
                    // Map history item to viralResults format
                    state.viralResults = {
                        viralScore: item.viralScore || item.score || 0,
                        verdict: item.verdict || item.summary || '',
                        factors: item.factors || item.breakdown || [],
                        title: item.title || '',
                        suggestions: item.suggestions || item.improvements || []
                    };
                    state.activeTool = 'viral';
                } else if (type === 'monetization') {
                    // Map history item to monetizationResults format
                    state.monetizationResults = {
                        channelName: item.channelName || item.channelTitle || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        estimatedRevenue: item.estimatedRevenue || item.monthlyEarnings || 0,
                        yearlyRevenue: item.yearlyRevenue || item.annualEarnings || 0,
                        cpm: item.cpm || item.estimatedCPM || 0,
                        breakdown: item.breakdown || item.revenueBreakdown || [],
                        recommendations: item.recommendations || item.suggestions || []
                    };
                    state.activeTool = 'monetization';
                } else if (type === 'script') {
                    // Map history item to scriptResults format
                    state.scriptResults = {
                        title: item.title || item.topic || 'Script',
                        script: item.script || item.content || '',
                        wordCount: item.wordCount || 0,
                        estimatedDuration: item.estimatedDuration || item.duration || '',
                        style: item.style || 'engaging'
                    };
                    state.activeTool = 'script';
                } else if (type === 'sponsorship') {
                    // Map history item to sponsorshipResults format
                    state.sponsorshipResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        rates: item.rates || {},
                        comparison: item.comparison || {},
                        negotiationTips: item.negotiationTips || []
                    };
                    state.activeTool = 'sponsorship';
                } else if (type === 'diversification') {
                    // Map history item to diversificationResults format
                    state.diversificationResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        diversificationScore: item.diversificationScore || 0,
                        currentSources: item.currentSources || [],
                        missingRevenue: item.missingRevenue || '$0',
                        recommendations: item.recommendations || [],
                        actionPlan: item.actionPlan || []
                    };
                    state.activeTool = 'diversification';
                } else if (type === 'cpmbooster') {
                    // Map history item to cpmBoosterResults format
                    state.cpmBoosterResults = {
                        currentCPM: item.currentCPM || '$0',
                        potentialCPM: item.potentialCPM || '$0',
                        cpmIncrease: item.cpmIncrease || '0%',
                        highCpmKeywords: item.highCpmKeywords || [],
                        topicIdeas: item.topicIdeas || [],
                        optimalLength: item.optimalLength || '',
                        lengthReason: item.lengthReason || '',
                        contentCalendar: item.contentCalendar || []
                    };
                    state.activeTool = 'cpmbooster';
                } else if (type === 'audienceprofile') {
                    // Map history item to audienceProfileResults format
                    state.audienceProfileResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        segments: item.segments || [],
                        productRecommendations: item.productRecommendations || [],
                        contentRecommendations: item.contentRecommendations || [],
                        targetedOffers: item.targetedOffers || []
                    };
                    state.activeTool = 'audienceprofile';
                } else if (type === 'digitalproduct') {
                    // Map history item to digitalProductResults format
                    state.digitalProductResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        productIdeas: item.productIdeas || [],
                        pricingStrategy: item.pricingStrategy || {},
                        launchTimeline: item.launchTimeline || [],
                        expertise: item.expertise || []
                    };
                    state.activeTool = 'digitalproduct';
                } else if (type === 'affiliate') {
                    // Map history item to affiliateResults format
                    state.affiliateResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        affiliatePrograms: item.affiliatePrograms || [],
                        placementScripts: item.placementScripts || [],
                        earningsBreakdown: item.earningsBreakdown || {},
                        placementStrategy: item.placementStrategy || []
                    };
                    state.activeTool = 'affiliate';
                } else if (type === 'multiincome') {
                    // Map history item to multiIncomeResults format
                    state.multiIncomeResults = {
                        videoTitle: item.videoTitle || item.title || 'Video',
                        videoThumbnail: item.videoThumbnail || item.thumbnail || '',
                        channelTitle: item.channelTitle || item.channelName || '',
                        views: item.views || 0,
                        duration: item.duration || 0,
                        contentPieces: item.contentPieces || [],
                        distributionStrategy: item.distributionStrategy || {},
                        revenuePotential: item.revenuePotential || [],
                        actionItems: item.actionItems || [],
                        summary: item.summary || {}
                    };
                    state.activeTool = 'multiincome';
                } else if (type === 'branddeal') {
                    // Map history item to brandDealResults format
                    state.brandDealResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        matchedBrands: item.matchedBrands || [],
                        pitchTemplates: item.pitchTemplates || [],
                        negotiationTips: item.negotiationTips || []
                    };
                    state.activeTool = 'branddeal';
                } else if (type === 'licensing') {
                    // Map history item to licensingResults format
                    state.licensingResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        opportunities: item.opportunities || [],
                        syndicationNetworks: item.syndicationNetworks || [],
                        actionSteps: item.actionSteps || []
                    };
                    state.activeTool = 'licensing';
                } else if (type === 'automation') {
                    // Map history item to automationResults format
                    state.automationResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        automationScore: item.automationScore || 0,
                        revenueSummary: item.revenueSummary || {},
                        workflows: item.workflows || [],
                        toolStack: item.toolStack || [],
                        timeline: item.timeline || []
                    };
                    state.activeTool = 'automation';
                }

                render();
            },

            // ==========================================
            // BULK VIDEO OPTIMIZER
            // ==========================================
            parseBulkInput: function() {
                var input = document.getElementById('bulk-input').value.trim();
                if (!input) {
                    state.error = 'Please enter video URLs or paste CSV data';
                    render();
                    return;
                }

                var videos = [];
                var lines = input.split('\n');

                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i].trim();
                    if (!line) continue;

                    // Check if it's a YouTube URL
                    var videoId = null;
                    if (line.includes('youtube.com/watch')) {
                        var match = line.match(/[?&]v=([^&]+)/);
                        if (match) videoId = match[1];
                    } else if (line.includes('youtu.be/')) {
                        var match = line.match(/youtu\.be\/([^?&]+)/);
                        if (match) videoId = match[1];
                    }

                    if (videoId) {
                        videos.push({
                            id: videoId,
                            url: 'https://youtube.com/watch?v=' + videoId,
                            status: 'pending'
                        });
                    }
                }

                if (videos.length === 0) {
                    state.error = 'No valid YouTube URLs found. Please check your input.';
                    render();
                    return;
                }

                state.bulkVideos = videos;
                state.error = null;
                render();
            },

            clearBulkVideos: function() {
                state.bulkVideos = [];
                state.bulkResults = null;
                state.bulkProgress = 0;
                render();
            },

            runBulkOptimization: function() {
                if (!requirePremiumAccess()) return;
                if (state.bulkVideos.length === 0) return;

                state.bulkProcessing = true;
                state.bulkProgress = 0;
                state.bulkResults = [];
                render();

                var total = state.bulkVideos.length;
                var processed = 0;

                // Process videos sequentially
                function processNext(index) {
                    if (index >= state.bulkVideos.length) {
                        state.bulkProcessing = false;
                        state.success = 'Bulk optimization complete! Processed ' + total + ' videos.';
                        render();
                        return;
                    }

                    var video = state.bulkVideos[index];
                    video.status = 'processing';
                    render();

                    functions.httpsCallable('optimizeVideo')({ videoUrl: video.url })
                        .then(function(result) {
                            video.status = 'complete';
                            video.result = result.data;
                            state.bulkResults.push({
                                videoId: video.id,
                                url: video.url,
                                titles: result.data.titles || [],
                                seoScore: result.data.seoScore || 0
                            });
                            processed++;
                            state.bulkProgress = (processed / total) * 100;
                            render();
                            processNext(index + 1);
                        })
                        .catch(function(e) {
                            video.status = 'error';
                            video.error = e.message;
                            processed++;
                            state.bulkProgress = (processed / total) * 100;
                            render();
                            processNext(index + 1);
                        });
                }

                processNext(0);
            },

            // ==========================================
            // PLACEMENT FINDER
            // ==========================================
            findPlacements: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('placement-channel-url').value.trim();

                if (!channelUrl) {
                    state.error = 'Please enter your YouTube channel URL';
                    render();
                    return;
                }

                state.placementLoading = true;
                state.loading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Analyzing your channel', icon: 'ðŸ“º' },
                    { name: 'Understanding your content', icon: 'ðŸ”' },
                    { name: 'Identifying your niche', icon: 'ðŸŽ¯' },
                    { name: 'Searching similar channels', icon: 'ðŸ”Ž' },
                    { name: 'Scoring relevance', icon: 'ðŸ“Š' },
                    { name: 'Compiling results', icon: 'âœ¨' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('findPlacements')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.placementResults = result.data;
                        state.placementLoading = false;
                        state.loading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.placementLoading = false;
                        state.loading = false;
                        state.error = 'Failed to find placements: ' + e.message;
                        render();
                    });
            },

            findMorePlacements: function() {
                if (!state.placementResults || !state.placementResults.historyId) return;

                state.placementLoading = true;
                render();

                functions.httpsCallable('findMorePlacements')({ historyId: state.placementResults.historyId })
                    .then(function(result) {
                        state.placementResults.placements = result.data.placements;
                        state.placementResults.totalFound = result.data.totalFound;
                        state.placementLoading = false;
                        if (result.data.added === 0) {
                            state.error = 'No more channels found matching your criteria.';
                        }
                        render();
                    })
                    .catch(function(e) {
                        state.placementLoading = false;
                        state.error = 'Failed to find more: ' + e.message;
                        render();
                    });
            },

            copyAllPlacements: function() {
                if (!state.placementResults || !state.placementResults.placements) return;

                var urls = state.placementResults.placements.map(function(p) {
                    return p.channelUrl;
                }).join('\n');

                navigator.clipboard.writeText(urls).then(function() {
                    state.copySuccess = 'Copied ' + state.placementResults.placements.length + ' channel URLs!';
                    render();
                    setTimeout(function() {
                        state.copySuccess = null;
                        render();
                    }, 3000);
                }).catch(function(err) {
                    state.error = 'Failed to copy: ' + err.message;
                    render();
                });
            },

            copySinglePlacement: function(url) {
                navigator.clipboard.writeText(url).then(function() {
                    state.copySuccess = 'Channel URL copied!';
                    render();
                    setTimeout(function() {
                        state.copySuccess = null;
                        render();
                    }, 2000);
                }).catch(function(err) {
                    state.error = 'Failed to copy: ' + err.message;
                    render();
                });
            },

            resetPlacements: function() {
                state.placementResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // VIRAL SCORE PREDICTOR
            // ==========================================
            predictViralScore: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var title = document.getElementById('viral-title').value.trim();
                var description = document.getElementById('viral-description').value.trim();
                var tags = document.getElementById('viral-tags').value.trim();

                if (!title) {
                    state.error = 'Please enter a video title';
                    render();
                    return;
                }

                state.viralLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Analyzing title appeal', icon: 'ðŸ“' },
                    { name: 'Checking trending patterns', icon: 'ðŸ“ˆ' },
                    { name: 'Evaluating engagement potential', icon: 'ðŸ’¬' },
                    { name: 'Calculating viral score', icon: 'ðŸ”¥' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('predictViralScore')({
                    title: title,
                    description: description,
                    tags: tags
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.viralResults = result.data;
                        state.viralLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.viralLoading = false;
                        state.error = 'Failed to predict viral score: ' + e.message;
                        render();
                    });
            },

            resetViralPredictor: function() {
                state.viralResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // MONETIZATION ANALYZER
            // ==========================================
            analyzeMonetization: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('monetization-channel').value.trim();

                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.monetizationLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'ðŸ“º' },
                    { name: 'Analyzing view patterns', icon: 'ðŸ‘ï¸' },
                    { name: 'Calculating CPM estimates', icon: 'ðŸ’°' },
                    { name: 'Generating revenue report', icon: 'ðŸ“Š' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeMonetization')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.monetizationResults = result.data;
                        state.monetizationLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.monetizationLoading = false;
                        state.error = 'Failed to analyze monetization: ' + e.message;
                        render();
                    });
            },

            resetMonetization: function() {
                state.monetizationResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // SCRIPT WRITER PRO
            // ==========================================
            setScriptStyle: function(style) {
                state.scriptStyle = style;
                render();
            },

            generateScript: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var topic = document.getElementById('script-topic').value.trim();
                var duration = document.getElementById('script-duration').value;
                var keywords = document.getElementById('script-keywords').value.trim();

                if (!topic) {
                    state.error = 'Please enter a video topic';
                    render();
                    return;
                }

                state.scriptLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Researching topic', icon: 'ðŸ”' },
                    { name: 'Structuring content', icon: 'ðŸ“‹' },
                    { name: 'Writing hook', icon: 'ðŸŽ£' },
                    { name: 'Generating script', icon: 'âœï¸' },
                    { name: 'Adding engagement points', icon: 'ðŸ’¡' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('generateScript')({
                    topic: topic,
                    duration: duration,
                    style: state.scriptStyle,
                    keywords: keywords
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.scriptResults = result.data;
                        state.scriptLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.scriptLoading = false;
                        state.error = 'Failed to generate script: ' + e.message;
                        render();
                    });
            },

            copyScript: function() {
                if (!state.scriptResults || !state.scriptResults.script) return;

                navigator.clipboard.writeText(state.scriptResults.script).then(function() {
                    state.success = 'Script copied to clipboard!';
                    render();
                    setTimeout(function() {
                        state.success = null;
                        render();
                    }, 3000);
                });
            },

            resetScript: function() {
                state.scriptResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // SPONSORSHIP RATE CALCULATOR
            // ==========================================
            calculateSponsorship: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('sponsorship-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.sponsorshipLoading = true;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'ðŸ“º' },
                    { name: 'Analyzing engagement', icon: 'ðŸ“Š' },
                    { name: 'Determining niche CPM', icon: 'ðŸ’°' },
                    { name: 'Calculating rates', icon: 'ðŸ’Ž' },
                    { name: 'Industry comparison', icon: 'ðŸ“ˆ' },
                    { name: 'Generating tips', icon: 'ðŸŽ¯' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('calculateSponsorshipRates')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.sponsorshipResults = result.data;
                        state.sponsorshipLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.sponsorshipLoading = false;
                        state.error = 'Error calculating rates: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetSponsorship: function() {
                state.sponsorshipResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // REVENUE DIVERSIFICATION ANALYZER
            // ==========================================
            analyzeDiversification: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('diversification-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                // Gather current revenue sources
                var currentSources = [];
                if (document.getElementById('rev-adsense') && document.getElementById('rev-adsense').checked) currentSources.push('adsense');
                if (document.getElementById('rev-sponsors') && document.getElementById('rev-sponsors').checked) currentSources.push('sponsors');
                if (document.getElementById('rev-merch') && document.getElementById('rev-merch').checked) currentSources.push('merch');
                if (document.getElementById('rev-courses') && document.getElementById('rev-courses').checked) currentSources.push('courses');
                if (document.getElementById('rev-affiliate') && document.getElementById('rev-affiliate').checked) currentSources.push('affiliate');
                if (document.getElementById('rev-memberships') && document.getElementById('rev-memberships').checked) currentSources.push('memberships');

                state.diversificationLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing channel', icon: 'ðŸ“º' },
                    { name: 'Auditing revenue', icon: 'ðŸ’°' },
                    { name: 'Identifying gaps', icon: 'ðŸ”' },
                    { name: 'Calculating potential', icon: 'ðŸ“Š' },
                    { name: 'Building action plan', icon: 'ðŸ“‹' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeRevenueDiversification')({
                    channelUrl: channelUrl,
                    currentSources: currentSources
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.diversificationResults = result.data;
                        state.diversificationLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.diversificationLoading = false;
                        state.error = 'Error analyzing diversification: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetDiversification: function() {
                state.diversificationResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // CPM BOOSTER STRATEGIST
            // ==========================================
            analyzeCpmBooster: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('cpmbooster-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.cpmBoosterLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing niche', icon: 'ðŸ“º' },
                    { name: 'Checking CPM trends', icon: 'ðŸ“ˆ' },
                    { name: 'Finding high-CPM keywords', icon: 'ðŸ”‘' },
                    { name: 'Generating video ideas', icon: 'ðŸŽ¬' },
                    { name: 'Building calendar', icon: 'ðŸ“…' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeCpmBooster')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.cpmBoosterResults = result.data;
                        state.cpmBoosterLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.cpmBoosterLoading = false;
                        state.error = 'Error analyzing CPM: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetCpmBooster: function() {
                state.cpmBoosterResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // AUDIENCE MONETIZATION PROFILER
            // ==========================================
            analyzeAudienceProfile: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('audienceprofile-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.audienceProfileLoading = true;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'ðŸ“º' },
                    { name: 'Analyzing demographics', icon: 'ðŸ‘¥' },
                    { name: 'Profiling segments', icon: 'ðŸ“Š' },
                    { name: 'Finding products', icon: 'ðŸ›ï¸' },
                    { name: 'Creating offers', icon: 'ðŸ’¡' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeAudienceProfile')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.audienceProfileResults = result.data;
                        state.audienceProfileLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.audienceProfileLoading = false;
                        state.error = 'Error profiling audience: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetAudienceProfile: function() {
                state.audienceProfileResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // DIGITAL PRODUCT ARCHITECT
            // ==========================================
            analyzeDigitalProduct: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('digitalproduct-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.digitalProductLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing content', icon: 'ðŸ“º' },
                    { name: 'Identifying expertise', icon: 'ðŸŽ“' },
                    { name: 'Finding product gaps', icon: 'ðŸ”' },
                    { name: 'Generating product ideas', icon: 'ðŸ’¡' },
                    { name: 'Building launch plan', icon: 'ðŸš€' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeDigitalProduct')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.digitalProductResults = result.data;
                        state.digitalProductLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.digitalProductLoading = false;
                        state.error = 'Error analyzing products: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetDigitalProduct: function() {
                state.digitalProductResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // AFFILIATE GOLDMINE FINDER
            // ==========================================
            analyzeAffiliate: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('affiliate-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.affiliateLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing niche', icon: 'ðŸŽ¯' },
                    { name: 'Scanning affiliate networks', icon: 'ðŸŒ' },
                    { name: 'Finding programs', icon: 'ðŸ”' },
                    { name: 'Matching products', icon: 'ðŸ“¦' },
                    { name: 'Generating scripts', icon: 'ðŸ“' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeAffiliate')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.affiliateResults = result.data;
                        state.affiliateLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.affiliateLoading = false;
                        state.error = 'Error finding affiliates: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetAffiliate: function() {
                state.affiliateResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // VIDEO-TO-MULTI-INCOME CONVERTER
            // ==========================================
            analyzeMultiIncome: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var videoUrl = document.getElementById('multiincome-video-url').value.trim();
                if (!videoUrl) {
                    state.error = 'Please enter a YouTube video URL';
                    render();
                    return;
                }

                state.multiIncomeLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing video content', icon: 'ðŸŽ¬' },
                    { name: 'Extracting key points', icon: 'ðŸ“‹' },
                    { name: 'Finding platforms', icon: 'ðŸŒ' },
                    { name: 'Creating content pieces', icon: 'âœ‚ï¸' },
                    { name: 'Building strategy', icon: 'ðŸ“Š' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeMultiIncome')({ videoUrl: videoUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.multiIncomeResults = result.data;
                        state.multiIncomeLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.multiIncomeLoading = false;
                        state.error = 'Error analyzing income streams: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetMultiIncome: function() {
                state.multiIncomeResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // BRAND DEAL MATCHMAKER
            // ==========================================
            analyzeBrandDeal: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('branddeal-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.brandDealLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing channel', icon: 'ðŸ“º' },
                    { name: 'Identifying niche', icon: 'ðŸŽ¯' },
                    { name: 'Matching brands', icon: 'ðŸ¤' },
                    { name: 'Creating pitches', icon: 'ðŸ“' },
                    { name: 'Building strategy', icon: 'ðŸ’¡' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeBrandDeal')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.brandDealResults = result.data;
                        state.brandDealLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.brandDealLoading = false;
                        state.error = 'Error finding brand deals: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetBrandDeal: function() {
                state.brandDealResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // LICENSING & SYNDICATION SCOUT
            // ==========================================
            analyzeLicensing: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('licensing-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.licensingLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing content', icon: 'ðŸ“º' },
                    { name: 'Scanning platforms', icon: 'ðŸŒ' },
                    { name: 'Finding opportunities', icon: 'ðŸ”' },
                    { name: 'Evaluating networks', icon: 'ðŸ“¡' },
                    { name: 'Creating action plan', icon: 'ðŸ“‹' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeLicensing')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.licensingResults = result.data;
                        state.licensingLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.licensingLoading = false;
                        state.error = 'Error scouting licensing: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetLicensing: function() {
                state.licensingResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // REVENUE AUTOMATION PIPELINE
            // ==========================================
            analyzeAutomation: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('automation-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.automationLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing channel', icon: 'ðŸ“º' },
                    { name: 'Mapping revenue streams', icon: 'ðŸ’°' },
                    { name: 'Finding automations', icon: 'ðŸ”„' },
                    { name: 'Building tool stack', icon: 'ðŸ› ï¸' },
                    { name: 'Creating timeline', icon: 'ðŸ“…' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeAutomation')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.automationResults = result.data;
                        state.automationLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.automationLoading = false;
                        state.error = 'Error building automation: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetAutomation: function() {
                state.automationResults = null;
                state.error = null;
                render();
            },

            // PDF Download functionality (optimized for smaller file sizes)
            downloadPDF: function(toolType) {
                var element = document.getElementById('pdf-content-' + toolType);
                if (!element) {
                    console.error('PDF content element not found: pdf-content-' + toolType);
                    utils.showNotification('Could not find content to export. Make sure you have generated results first.', 'error');
                    return;
                }

                // Check if libraries are loaded
                if (typeof html2canvas === 'undefined') {
                    console.error('html2canvas library not loaded');
                    utils.showNotification('PDF library not loaded. Please refresh the page.', 'error');
                    return;
                }

                // Check jsPDF - handle different global names
                var jsPDFClass = null;
                if (typeof jspdf !== 'undefined' && jspdf.jsPDF) {
                    jsPDFClass = jspdf.jsPDF;
                } else if (typeof jsPDF !== 'undefined') {
                    jsPDFClass = jsPDF;
                } else if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
                    jsPDFClass = window.jspdf.jsPDF;
                }

                if (!jsPDFClass) {
                    console.error('jsPDF library not loaded');
                    utils.showNotification('PDF library not loaded. Please refresh the page.', 'error');
                    return;
                }

                // Show loading state
                utils.showNotification('Generating PDF... This may take a moment.', 'info');

                // Tool names mapping
                var toolNames = {
                    bulk: 'Bulk Optimizer',
                    placement: 'Placement Finder',
                    viral: 'Viral Score Predictor',
                    monetization: 'Monetization Analyzer',
                    script: 'Script Writer Pro'
                };

                var toolName = toolNames[toolType] || 'Enterprise Report';

                // Use html2canvas with optimized settings for smaller file size
                html2canvas(element, {
                    backgroundColor: '#0f0f1a',
                    scale: 1.5, // Reduced from 2 for smaller file size while maintaining good quality
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    foreignObjectRendering: false,
                    imageTimeout: 15000,
                    removeContainer: true
                }).then(function(canvas) {
                    try {
                        var pdf = new jsPDFClass({
                            orientation: 'portrait',
                            unit: 'mm',
                            format: 'a4',
                            compress: true // Enable compression
                        });

                        // Page dimensions
                        var pageWidth = pdf.internal.pageSize.getWidth();
                        var pageHeight = pdf.internal.pageSize.getHeight();
                        var margin = 10;
                        var contentWidth = pageWidth - (margin * 2);
                        var headerHeight = 35;
                        var footerHeight = 15;
                        var usableHeight = pageHeight - headerHeight - footerHeight;

                        // Calculate image dimensions to fit page width
                        var imgWidth = contentWidth;
                        var imgHeight = (canvas.height * imgWidth) / canvas.width;

                        // Calculate how many pages we need
                        var totalPages = Math.ceil(imgHeight / usableHeight);

                        // Calculate the portion of the canvas for each page
                        var canvasPageHeight = canvas.height / totalPages;

                        for (var page = 0; page < totalPages; page++) {
                            if (page > 0) {
                                pdf.addPage();
                            }

                            // Add header with gold enterprise styling on each page
                            pdf.setFillColor(15, 15, 26);
                            pdf.rect(0, 0, pageWidth, headerHeight, 'F');

                            // Gold gradient line
                            pdf.setDrawColor(255, 215, 0);
                            pdf.setLineWidth(0.5);
                            pdf.line(margin, 32, pageWidth - margin, 32);

                            pdf.setFontSize(16);
                            pdf.setTextColor(255, 215, 0);
                            pdf.text(toolName + ' Report', margin, 14);

                            pdf.setFontSize(9);
                            pdf.setTextColor(156, 163, 175);
                            pdf.text('Generated on ' + new Date().toLocaleDateString(), margin, 21);
                            pdf.text('Enterprise Suite - YouTube Video Optimizer', margin, 27);

                            if (totalPages > 1) {
                                pdf.setFontSize(8);
                                pdf.text('Page ' + (page + 1) + ' of ' + totalPages, pageWidth - margin - 20, 27);
                            }

                            // Create a temporary canvas for this page's portion
                            var pageCanvas = document.createElement('canvas');
                            pageCanvas.width = canvas.width;
                            pageCanvas.height = Math.min(canvasPageHeight, canvas.height - (page * canvasPageHeight));

                            var ctx = pageCanvas.getContext('2d');
                            // Draw the portion of the original canvas for this page
                            ctx.drawImage(
                                canvas,
                                0, page * canvasPageHeight, // Source x, y
                                canvas.width, pageCanvas.height, // Source width, height
                                0, 0, // Destination x, y
                                pageCanvas.width, pageCanvas.height // Destination width, height
                            );

                            // Convert to JPEG with quality setting (much smaller than PNG)
                            var pageImgData = pageCanvas.toDataURL('image/jpeg', 0.85);

                            // Calculate the height for this page's content
                            var pageImgHeight = (pageCanvas.height * imgWidth) / pageCanvas.width;

                            // Add this page's image portion
                            pdf.addImage(pageImgData, 'JPEG', margin, headerHeight + 2, imgWidth, pageImgHeight);

                            // Add footer
                            pdf.setFontSize(7);
                            pdf.setTextColor(107, 114, 128);
                            pdf.text('Powered by YouTube Video Optimizer Enterprise Suite - ytseo.siteuo.com', margin, pageHeight - 8);
                        }

                        // Download the PDF
                        var filename = 'enterprise-' + toolType + '-report-' + new Date().toISOString().slice(0, 10) + '.pdf';
                        pdf.save(filename);

                        utils.showNotification('PDF downloaded successfully!', 'success');
                    } catch (pdfError) {
                        console.error('PDF creation error:', pdfError);
                        utils.showNotification('Failed to create PDF: ' + pdfError.message, 'error');
                    }
                }).catch(function(error) {
                    console.error('html2canvas error:', error);
                    utils.showNotification('Failed to capture content: ' + error.message, 'error');
                });
            }
        };

        /* ==========================================
           4.6 RENDER FUNCTIONS
           ========================================== */

        // Global Header render function (Enterprise Gold Theme)
        function renderGlobalHeader() {
            if (!state.user) return '';

            var html = '';
            if (state.showNotifications) {
                html += '<div class="notification-overlay" onclick="app.closeNotifications()"></div>';
            }

            var reportUnread = state.unreadCount || 0;
            var alertUnread = (state.userNotifications && state.userNotifications.unreadCount) || 0;
            var totalUnread = reportUnread + alertUnread;
            var planName = (state.userPlan || 'free').charAt(0).toUpperCase() + (state.userPlan || 'free').slice(1);

            html += '<div class="global-header">';
            html += '<div class="global-header-content">';
            html += '<div class="token-display" onclick="event.stopPropagation(); app.showTokenModal()"><span class="token-icon">ðŸª™</span><span class="token-amount">' + (state.tokenBalance || 0) + '</span></div>';
            html += '<div class="plan-badge"><span>ðŸ‘‘</span><span>' + planName + '</span></div>';
            html += '<div class="notification-bell" onclick="event.stopPropagation(); app.toggleNotifications()">';
            html += '<span style="font-size:1.25rem;">ðŸ””</span>';
            // Always render badge element for real-time updates (hidden when count is 0)
            html += '<span class="notification-badge" style="' + (totalUnread > 0 ? '' : 'display:none') + '">' + (totalUnread > 99 ? '99+' : totalUnread) + '</span>';
            if (state.showNotifications) {
                html += '<div class="notification-dropdown" onclick="event.stopPropagation()">';
                html += '<div class="notification-tabs">';
                html += '<button onclick="app.setNotificationTab(\'reports\')" class="notification-tab ' + (state.notificationTab === 'reports' ? 'active' : '') + '"><span>ðŸ“Š</span> Reports' + (reportUnread > 0 ? '<span class="notification-tab-badge">' + reportUnread + '</span>' : '') + '</button>';
                html += '<button onclick="app.setNotificationTab(\'alerts\')" class="notification-tab ' + (state.notificationTab === 'alerts' ? 'active' : '') + '"><span>ðŸ””</span> Alerts' + (alertUnread > 0 ? '<span class="notification-tab-badge">' + alertUnread + '</span>' : '') + '</button>';
                html += '</div>';
                html += '<div class="notification-list">';
                if (state.notificationTab === 'reports') {
                    if (state.notifications.length > 0) {
                        state.notifications.forEach(function(n) {
                            html += '<div class="notification-item" onclick="app.openNotificationReport(\'' + n.reportId + '\', \'' + n.id + '\')"><div style="display:flex;gap:0.75rem;"><span style="font-size:1.5rem;">ðŸ“Š</span><div><div style="font-weight:600;color:white;font-size:0.875rem;">' + (n.title || 'New Report') + '</div><div style="font-size:0.75rem;color:rgba(255,255,255,0.6);">' + (n.message || '') + '</div></div></div></div>';
                        });
                    } else {
                        html += '<div class="notification-empty"><div style="font-size:2.5rem;opacity:0.5;">ðŸ“Š</div><p style="color:rgba(255,255,255,0.6);font-size:0.875rem;">No campaign reports</p></div>';
                    }
                } else {
                    var alerts = (state.userNotifications && state.userNotifications.notifications) || [];
                    if (state.userNotificationsLoading) {
                        html += '<div class="notification-empty"><div class="loading-spinner" style="width:24px;height:24px;margin:0 auto 0.5rem;"></div><p style="color:rgba(255,255,255,0.6);">Loading...</p></div>';
                    } else if (alerts.length > 0) {
                        alerts.forEach(function(n) {
                            var icon = n.type === 'request_approved' ? 'ðŸŽ‰' : n.type === 'request_denied' ? 'âŒ' : 'ðŸ“¢';
                            html += '<div class="notification-item" style="' + (n.read ? '' : 'background:rgba(255,215,0,0.1);') + '" onclick="app.handleAlertNotificationClick(\'' + n.id + '\')"><div style="display:flex;gap:0.75rem;"><span style="font-size:1.5rem;">' + icon + '</span><div><div style="font-weight:600;color:white;font-size:0.875rem;">' + (n.title || 'Alert') + '</div><div style="font-size:0.75rem;color:rgba(255,255,255,0.6);">' + (n.message || '') + '</div></div></div></div>';
                        });
                    } else {
                        html += '<div class="notification-empty"><div style="font-size:2.5rem;opacity:0.5;">âœ¨</div><p style="color:rgba(255,255,255,0.6);font-size:0.875rem;">No alerts</p></div>';
                    }
                }
                html += '</div></div>';
            }
            html += '</div>';
            html += '<button onclick="app.signOut()" class="user-menu-btn">Sign Out</button>';
            html += '</div></div>';
            return html;
        }

        // Main render dispatcher
        function render() {
            var root = document.getElementById('app-root');
            var html = '';

            if (state.currentView === 'loading') {
                html = renderLoading();
            } else if (state.currentView === 'history') {
                html = renderHistory() + renderUpgradeModal() + renderTokenModal() + renderCommandPalette() + renderGlobalHeader();
            } else {
                // Always show tools, add upgrade modal, token modal, command palette, FAB, and global header
                html = renderTools() + renderUpgradeModal() + renderTokenModal() + renderCommandPalette() + renderFloatingSearchButton() + renderGlobalHeader();
            }

            root.innerHTML = html;
        }

        // Loading view
        function renderLoading() {
            var html = '<div class="min-h-screen flex items-center justify-center">';
            html += '<div class="text-center">';
            html += '<div class="loading-emoji mb-4">ðŸ‘‘</div>';
            html += '<p class="text-white text-xl">Loading Enterprise Suite...</p>';
            html += '</div></div>';
            return html;
        }

        // Upgrade modal popup for non-premium users
        function renderUpgradeModal() {
            if (!state.showUpgradeModal) return '';

            var html = '<div class="upgrade-modal-overlay" onclick="closeUpgradeModal()">';
            html += '<div class="upgrade-modal fade-in" onclick="event.stopPropagation()">';
            html += '<button class="upgrade-modal-close" onclick="closeUpgradeModal()">Ã—</button>';
            html += '<div class="locked-icon">ðŸ”’</div>';
            html += '<h2 class="text-2xl font-bold gold-text mb-3">Premium Feature</h2>';
            html += '<p class="text-white/70 text-base mb-5">This feature is available for <strong class="text-yellow-400">PRO</strong> and <strong class="text-yellow-400">Enterprise</strong> subscribers.</p>';
            html += '<div class="space-y-2 mb-6 text-left text-sm">';
            html += '<div class="flex items-center gap-2 text-white/60"><span>âœ¨</span> Unlimited access to all tools</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>ðŸš€</span> Bulk processing capabilities</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>ðŸ“Š</span> Advanced analytics & reports</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>ðŸ’¬</span> Priority support</div>';
            html += '</div>';
            html += '<button onclick="app.goToDashboard()" class="btn-primary w-full mb-3">Upgrade to PRO</button>';
            html += '<button onclick="closeUpgradeModal()" class="btn-secondary w-full">Maybe Later</button>';
            html += '</div></div>';
            return html;
        }

        // Token Info Modal
        function renderTokenModal() {
            if (!state.showTokenModal) return '';
            var tokenCosts = state.tokenBypassCosts || {};
            var toolLabels = {
                warpOptimizer: 'WARP Optimizer', competitorAnalysis: 'Competitor Analysis',
                trendPredictor: 'Trend Predictor', thumbnailGenerator: 'Thumbnail Generator',
                channelAudit: 'Channel Audit', scriptGenerator: 'Script Generator',
                titleGenerator: 'Title Generator', placementFinder: 'Placement Finder'
            };
            var html = '<div class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="app.hideTokenModal()">';
            html += '<div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl max-w-lg w-full p-6 relative border border-white/10" onclick="event.stopPropagation()">';
            html += '<button onclick="app.hideTokenModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl transition-colors">&times;</button>';
            html += '<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-amber-400 to-yellow-600 rounded-2xl flex items-center justify-center text-4xl mx-auto mb-4 shadow-lg shadow-amber-500/30">ðŸª™</div>';
            html += '<h3 class="text-2xl font-bold text-white">Your Token Balance</h3>';
            html += '<div class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-500 mt-2">' + (state.tokenBalance || 0) + '</div>';
            html += '<p class="text-gray-400 mt-1">Creative Tokens Available</p></div>';
            if (state.userPlan) {
                html += '<div class="bg-white/5 rounded-xl p-4 mb-4 border border-white/10"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><span class="text-2xl">ðŸ“Š</span><div><p class="text-white font-semibold">Current Plan</p><p class="text-amber-400 font-bold capitalize">' + state.userPlan + '</p></div></div><a href="pricing.html" class="text-sm text-purple-400 hover:text-purple-300">Upgrade â†’</a></div></div>';
            }
            html += '<div class="bg-white/5 rounded-xl p-4 mb-4 border border-white/10"><h4 class="text-white font-semibold mb-3 flex items-center gap-2"><span>ðŸ’¡</span> Quota Bypass Costs</h4>';
            html += '<p class="text-gray-400 text-sm mb-3">When you run out of free uses, tokens can skip the wait time:</p><div class="grid grid-cols-2 gap-2">';
            Object.keys(toolLabels).forEach(function(toolKey) {
                var cost = tokenCosts[toolKey] || '?';
                html += '<div class="flex items-center justify-between bg-white/5 rounded-lg px-3 py-2"><span class="text-gray-300 text-xs">' + toolLabels[toolKey] + '</span><span class="text-amber-400 font-bold text-sm">' + cost + ' ðŸª™</span></div>';
            });
            html += '</div></div>';
            html += '<button onclick="app.topUpTokens()" class="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:from-amber-600 hover:to-orange-600 transition-all shadow-lg shadow-amber-500/30 flex items-center justify-center gap-2"><span class="text-xl">ðŸ’³</span> TopUp Tokens</button>';
            html += '<p class="text-center text-gray-500 text-xs mt-3">Contact support for custom token packages</p></div></div>';
            return html;
        }

        // All tools data for Smart Dashboard and Command Palette
        function getAllToolsData() {
            return [
                { key: 'bulk', icon: 'ðŸŽ¯', name: 'Bulk Optimizer', desc: 'Optimize multiple videos at once', category: 'optimization' },
                { key: 'placement', icon: 'ðŸŽ¬', name: 'Placement Finder', desc: 'Find perfect video placements', category: 'optimization' },
                { key: 'viral', icon: 'ðŸ”®', name: 'Viral Predictor', desc: 'Predict viral potential', category: 'analytics' },
                { key: 'monetization', icon: 'ðŸ’°', name: 'Monetization', desc: 'Analyze monetization potential', category: 'monetization' },
                { key: 'script', icon: 'ðŸ“', name: 'Script Writer', desc: 'AI-powered script creation', category: 'content' },
                { key: 'sponsorship', icon: 'ðŸ’Ž', name: 'Sponsorship Rates', desc: 'Calculate sponsor pricing', category: 'monetization' },
                { key: 'diversification', icon: 'ðŸ“Š', name: 'Revenue Diversify', desc: 'Find new revenue streams', category: 'monetization' },
                { key: 'cpmbooster', icon: 'ðŸ’°', name: 'CPM Booster', desc: 'Strategies to boost CPM', category: 'monetization' },
                { key: 'audienceprofile', icon: 'ðŸ“±', name: 'Audience Profile', desc: 'Deep audience insights', category: 'analytics' },
                { key: 'digitalproduct', icon: 'ðŸ›’', name: 'Product Architect', desc: 'Design digital products', category: 'monetization' },
                { key: 'affiliate', icon: 'ðŸ“ˆ', name: 'Affiliate Finder', desc: 'Find affiliate opportunities', category: 'monetization' },
                { key: 'multiincome', icon: 'ðŸŽ¬', name: 'Multi-Income', desc: 'Convert videos to income', category: 'monetization' },
                { key: 'branddeal', icon: 'ðŸ¤', name: 'Brand Deals', desc: 'Match with brand partners', category: 'monetization' },
                { key: 'licensing', icon: 'ðŸ“œ', name: 'Licensing Scout', desc: 'Find licensing opportunities', category: 'monetization' },
                { key: 'automation', icon: 'âš™ï¸', name: 'Revenue Auto', desc: 'Automate revenue pipelines', category: 'monetization' }
            ];
        }

        // Get recommended tools based on recent usage
        function getRecommendedTools() {
            var allTools = getAllToolsData();
            var recent = state.recentTools || [];

            // Simple recommendation: tools not recently used, prioritizing monetization
            var recommended = allTools.filter(function(tool) {
                return recent.indexOf(tool.key) === -1;
            });

            // Prioritize monetization tools
            recommended.sort(function(a, b) {
                if (a.category === 'monetization' && b.category !== 'monetization') return -1;
                if (b.category === 'monetization' && a.category !== 'monetization') return 1;
                return 0;
            });

            return recommended.slice(0, 4);
        }

        // Smart Dashboard View
        function renderSmartDashboard() {
            var html = '';
            var recentTools = state.recentTools || [];
            var allTools = getAllToolsData();
            var recommendedTools = getRecommendedTools();

            // Get recent tool objects
            var recentToolObjects = recentTools.map(function(key) {
                return allTools.find(function(t) { return t.key === key; });
            }).filter(Boolean).slice(0, 4);

            html += '<div class="smart-dashboard fade-in">';

            // Quick Search Bar
            html += '<div class="mb-8">';
            html += '<div class="relative">';
            html += '<input type="text" id="dashboard-search" placeholder="ðŸ” Search tools... (or press âŒ˜K)" ';
            html += 'class="w-full px-5 py-4 bg-white/10 border border-white/20 rounded-2xl text-white placeholder-white/50 text-lg focus:outline-none focus:border-yellow-400/50 focus:ring-2 focus:ring-yellow-400/20" ';
            html += 'onfocus="app.openCommandPalette()" readonly>';
            html += '</div>';
            html += '</div>';

            // Recent Tools Section
            if (recentToolObjects.length > 0) {
                html += '<div class="mb-8">';
                html += '<div class="flex items-center justify-between mb-4">';
                html += '<h3 class="text-lg font-semibold text-white flex items-center gap-2"><span>ðŸ•</span> Recent Tools</h3>';
                html += '<button onclick="app.clearRecentTools()" class="text-white/40 hover:text-white/60 text-sm">Clear</button>';
                html += '</div>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';

                for (var i = 0; i < recentToolObjects.length; i++) {
                    var tool = recentToolObjects[i];
                    html += '<div class="dashboard-tool-card" onclick="app.setActiveTool(\'' + tool.key + '\')">';
                    html += '<div class="tool-card-icon">' + tool.icon + '</div>';
                    html += '<div class="tool-card-name">' + tool.name + '</div>';
                    html += '</div>';
                }

                html += '</div>';
                html += '</div>';
            }

            // Recommended Tools Section
            html += '<div class="mb-8">';
            html += '<h3 class="text-lg font-semibold text-white flex items-center gap-2 mb-4"><span>âœ¨</span> Recommended for You</h3>';
            html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';

            for (var i = 0; i < recommendedTools.length; i++) {
                var tool = recommendedTools[i];
                html += '<div class="dashboard-tool-card recommended" onclick="app.setActiveTool(\'' + tool.key + '\')">';
                html += '<div class="tool-card-icon">' + tool.icon + '</div>';
                html += '<div class="tool-card-name">' + tool.name + '</div>';
                html += '<div class="tool-card-desc">' + tool.desc + '</div>';
                html += '</div>';
            }

            html += '</div>';
            html += '</div>';

            // Browse All Tools Button
            html += '<div class="text-center">';
            html += '<button onclick="app.showAllTools()" class="btn-primary px-8 py-4 text-lg">';
            html += 'ðŸ” Browse All 15 Tools';
            html += '</button>';
            html += '</div>';

            html += '</div>';

            return html;
        }

        // Command Palette (Spotlight Search) Overlay
        function renderCommandPalette() {
            if (!state.showCommandPalette) return '';

            var allTools = getAllToolsData();
            var query = (state.commandSearchQuery || '').toLowerCase();
            var recentTools = state.recentTools || [];

            // Filter tools based on search
            var filteredTools = allTools.filter(function(tool) {
                if (!query) return true;
                return tool.name.toLowerCase().indexOf(query) !== -1 ||
                       tool.desc.toLowerCase().indexOf(query) !== -1 ||
                       tool.key.toLowerCase().indexOf(query) !== -1;
            });

            // Get recent tool objects
            var recentToolObjects = recentTools.map(function(key) {
                return allTools.find(function(t) { return t.key === key; });
            }).filter(Boolean).slice(0, 3);

            var html = '';
            html += '<div class="command-palette-overlay" onclick="app.closeCommandPalette()">';
            html += '<div class="command-palette slide-up" onclick="event.stopPropagation()">';

            // Search Input
            html += '<div class="command-palette-header">';
            html += '<div class="relative">';
            html += '<span class="absolute left-4 top-1/2 -translate-y-1/2 text-xl">ðŸ”</span>';
            html += '<input type="text" id="command-search-input" placeholder="Search tools..." ';
            html += 'value="' + utils.escapeHtml(state.commandSearchQuery || '') + '" ';
            html += 'class="w-full pl-12 pr-12 py-4 bg-transparent border-none text-white text-lg placeholder-white/50 focus:outline-none" ';
            html += 'oninput="app.updateCommandSearch(this.value)" autofocus>';
            html += '<button onclick="app.closeCommandPalette()" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/40 hover:text-white text-sm bg-white/10 px-2 py-1 rounded">ESC</button>';
            html += '</div>';
            html += '</div>';

            html += '<div class="command-palette-body">';

            // Recent section (only show if no search query)
            if (!query && recentToolObjects.length > 0) {
                html += '<div class="command-section">';
                html += '<div class="command-section-title">Recent</div>';
                for (var i = 0; i < recentToolObjects.length; i++) {
                    var tool = recentToolObjects[i];
                    html += '<div class="command-item" onclick="app.selectTool(\'' + tool.key + '\')">';
                    html += '<span class="command-item-icon">' + tool.icon + '</span>';
                    html += '<div class="command-item-content">';
                    html += '<div class="command-item-name">' + tool.name + '</div>';
                    html += '<div class="command-item-desc">' + tool.desc + '</div>';
                    html += '</div>';
                    html += '<span class="command-item-hint">â†µ</span>';
                    html += '</div>';
                }
                html += '</div>';
            }

            // All/Filtered tools section
            html += '<div class="command-section">';
            html += '<div class="command-section-title">' + (query ? 'Results' : 'All Tools') + '</div>';

            if (filteredTools.length === 0) {
                html += '<div class="text-center py-8 text-white/50">No tools found for "' + utils.escapeHtml(query) + '"</div>';
            } else {
                for (var i = 0; i < filteredTools.length; i++) {
                    var tool = filteredTools[i];
                    var isRecent = recentTools.indexOf(tool.key) !== -1;
                    html += '<div class="command-item' + (isRecent ? ' recent' : '') + '" onclick="app.selectTool(\'' + tool.key + '\')">';
                    html += '<span class="command-item-icon">' + tool.icon + '</span>';
                    html += '<div class="command-item-content">';
                    html += '<div class="command-item-name">' + tool.name + '</div>';
                    html += '<div class="command-item-desc">' + tool.desc + '</div>';
                    html += '</div>';
                    html += '<span class="command-item-hint">â†µ</span>';
                    html += '</div>';
                }
            }

            html += '</div>';
            html += '</div>';

            // Footer with keyboard hints
            html += '<div class="command-palette-footer">';
            html += '<span><kbd>â†‘â†“</kbd> Navigate</span>';
            html += '<span><kbd>â†µ</kbd> Select</span>';
            html += '<span><kbd>ESC</kbd> Close</span>';
            html += '</div>';

            html += '</div>';
            html += '</div>';

            return html;
        }

        // Floating Action Button for Command Palette
        function renderFloatingSearchButton() {
            if (state.showCommandPalette) return '';
            if (state.currentView !== 'tools') return '';

            var html = '';
            html += '<button class="floating-search-btn" onclick="app.openCommandPalette()" title="Search Tools (âŒ˜K)">';
            html += '<span class="fab-icon">ðŸ”</span>';
            html += '<span class="fab-text">Search</span>';
            html += '</button>';
            return html;
        }

        // Main tools view
        function renderTools() {
            var html = '';

            // Toast notifications
            if (state.success) {
                html += '<div class="toast toast-success">âœ… ' + utils.escapeHtml(state.success) + '</div>';
            }
            if (state.copySuccess) {
                html += '<div class="toast toast-success">ðŸ“‹ ' + utils.escapeHtml(state.copySuccess) + '</div>';
            }

            html += '<div class="min-h-screen py-8 px-4">';
            html += '<div class="max-w-6xl mx-auto">';

            // Header
            html += '<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 fade-in">';
            html += '<div class="flex items-center gap-4">';
            html += '<div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center text-4xl shadow-xl animate-glow">ðŸ‘‘</div>';
            html += '<div>';
            html += '<h1 class="text-3xl md:text-4xl font-bold gold-text">Enterprise Suite</h1>';
            html += '<p class="text-white/60">Premium tools for power users <span style="opacity:0.5;">v' + PLATFORM_VERSION + '</span></p>';
            html += '</div>';
            html += '</div>';
            html += '<div class="flex gap-3">';
            html += '<button onclick="app.goToHistory()" class="btn-secondary">ðŸ“œ View History</button>';
            html += '<button onclick="app.goToDashboard()" class="btn-secondary">â† Back to Dashboard</button>';
            html += '</div>';
            html += '</div>';

            // Check if we should show Smart Dashboard or Grid view
            var showDashboard = state.toolViewMode === 'dashboard' && !state.activeTool;

            if (showDashboard) {
                // Smart Dashboard Mode
                html += renderSmartDashboard();
                html += '</div></div>';
                return html;
            }

            // Grid Mode - Show tool tabs and content
            // Back to Dashboard button (when viewing a specific tool)
            html += '<div class="mb-4 fade-in">';
            html += '<button onclick="app.backToToolDashboard()" class="text-white/60 hover:text-white flex items-center gap-2 transition-colors">';
            html += '<span>â†</span> Back to Tool Dashboard';
            html += '</button>';
            html += '</div>';

            // Tool tabs with scrollable container
            html += '<div class="tool-tabs-container fade-in">';
            html += '<div class="tool-tabs">';

            var tools = [
                { key: 'bulk', icon: 'ðŸŽ¯', name: 'Bulk Optimizer' },
                { key: 'placement', icon: 'ðŸŽ¬', name: 'Placement Finder' },
                { key: 'viral', icon: 'ðŸ”®', name: 'Viral Predictor' },
                { key: 'monetization', icon: 'ðŸ’°', name: 'Monetization' },
                { key: 'script', icon: 'ðŸ“', name: 'Script Writer' },
                { key: 'sponsorship', icon: 'ðŸ’Ž', name: 'Sponsorship Rates' },
                { key: 'diversification', icon: 'ðŸ“Š', name: 'Revenue Diversify' },
                { key: 'cpmbooster', icon: 'ðŸ’°', name: 'CPM Booster' },
                { key: 'audienceprofile', icon: 'ðŸ“±', name: 'Audience Profile' },
                { key: 'digitalproduct', icon: 'ðŸ›’', name: 'Product Architect' },
                { key: 'affiliate', icon: 'ðŸ“ˆ', name: 'Affiliate Finder' },
                { key: 'multiincome', icon: 'ðŸŽ¬', name: 'Multi-Income' },
                { key: 'branddeal', icon: 'ðŸ¤', name: 'Brand Deals' },
                { key: 'licensing', icon: 'ðŸ“œ', name: 'Licensing Scout' },
                { key: 'automation', icon: 'âš™ï¸', name: 'Revenue Auto' }
            ];

            for (var i = 0; i < tools.length; i++) {
                var tool = tools[i];
                var isActive = state.activeTool === tool.key;
                html += '<div class="tool-tab' + (isActive ? ' active' : '') + '" onclick="app.setActiveTool(\'' + tool.key + '\')">';
                html += '<div class="tool-tab-icon">' + tool.icon + '</div>';
                html += '<div class="tool-tab-name">' + tool.name + '</div>';
                html += '</div>';
            }

            html += '</div>';
            html += '<div class="tool-tabs-fade"></div>';
            html += '</div>';

            // Error message
            if (state.error) {
                html += '<div class="mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 fade-in">';
                html += 'âš ï¸ ' + utils.escapeHtml(state.error);
                html += '</div>';
            }

            // Tool content
            html += '<div class="premium-card rounded-2xl p-6 lg:p-8 fade-in">';

            if (state.activeTool === 'bulk') {
                html += renderBulkOptimizer();
            } else if (state.activeTool === 'placement') {
                html += renderPlacementFinder();
            } else if (state.activeTool === 'viral') {
                html += renderViralPredictor();
            } else if (state.activeTool === 'monetization') {
                html += renderMonetization();
            } else if (state.activeTool === 'script') {
                html += renderScriptWriter();
            } else if (state.activeTool === 'sponsorship') {
                html += renderSponsorshipCalculator();
            } else if (state.activeTool === 'diversification') {
                html += renderRevenueDiversification();
            } else if (state.activeTool === 'cpmbooster') {
                html += renderCpmBooster();
            } else if (state.activeTool === 'audienceprofile') {
                html += renderAudienceProfile();
            } else if (state.activeTool === 'digitalproduct') {
                html += renderDigitalProductArchitect();
            } else if (state.activeTool === 'affiliate') {
                html += renderAffiliateFinder();
            } else if (state.activeTool === 'multiincome') {
                html += renderMultiIncomeConverter();
            } else if (state.activeTool === 'branddeal') {
                html += renderBrandDealMatchmaker();
            } else if (state.activeTool === 'licensing') {
                html += renderLicensingScout();
            } else if (state.activeTool === 'automation') {
                html += renderRevenueAutomation();
            }

            html += '</div>';

            html += '</div></div>';
            return html;
        }

        // ==========================================
        // TOOL RENDERERS
        // ==========================================

        // Bulk Video Optimizer
        function renderBulkOptimizer() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-2xl">ðŸŽ¯</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Bulk Video Optimizer</h2>';
            html += '<p class="text-white/60">Optimize multiple videos at once</p>';
            html += '</div>';
            html += '</div>';

            if (state.bulkProcessing) {
                // Processing view
                html += '<div class="mb-6">';
                html += '<div class="flex justify-between items-center mb-2">';
                html += '<span class="text-white font-medium">Processing videos...</span>';
                html += '<span class="text-yellow-400 font-bold">' + Math.round(state.bulkProgress) + '%</span>';
                html += '</div>';
                html += '<div class="progress-container">';
                html += '<div class="progress-fill" style="width:' + state.bulkProgress + '%"></div>';
                html += '</div>';
                html += '</div>';

                // Video status list
                html += '<div class="space-y-3">';
                for (var i = 0; i < state.bulkVideos.length; i++) {
                    var video = state.bulkVideos[i];
                    var statusIcon = video.status === 'complete' ? 'âœ…' : video.status === 'processing' ? 'â³' : video.status === 'error' ? 'âŒ' : 'â¸ï¸';
                    var statusColor = video.status === 'complete' ? 'text-green-400' : video.status === 'processing' ? 'text-yellow-400' : video.status === 'error' ? 'text-red-400' : 'text-white/40';

                    html += '<div class="result-card flex items-center justify-between">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<span class="text-xl ' + (video.status === 'processing' ? 'animate-spin' : '') + '">' + statusIcon + '</span>';
                    html += '<span class="text-white/80 font-mono text-sm">' + utils.escapeHtml(video.id) + '</span>';
                    html += '</div>';
                    html += '<span class="' + statusColor + ' text-sm capitalize">' + video.status + '</span>';
                    html += '</div>';
                }
                html += '</div>';

            } else if (state.bulkResults && state.bulkResults.length > 0) {
                // Results view
                html += '<div class="flex justify-between items-center mb-6">';
                html += '<h3 class="text-xl font-bold text-white">Optimization Results</h3>';
                html += '<div class="flex gap-2">';
                html += '<button onclick="app.downloadPDF(\'bulk\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '<button onclick="app.clearBulkVideos()" class="btn-secondary text-sm">Start New Batch</button>';
                html += '</div>';
                html += '</div>';

                html += '<div id="pdf-content-bulk" class="space-y-4">';
                for (var i = 0; i < state.bulkResults.length; i++) {
                    var result = state.bulkResults[i];
                    html += '<div class="result-card">';
                    html += '<div class="flex justify-between items-start mb-3">';
                    html += '<span class="font-mono text-white/60 text-sm">' + utils.escapeHtml(result.videoId) + '</span>';
                    var scoreClass = result.seoScore >= 80 ? 'score-high' : result.seoScore >= 50 ? 'score-medium' : 'score-low';
                    html += '<span class="score-badge ' + scoreClass + '">SEO: ' + result.seoScore + '</span>';
                    html += '</div>';
                    if (result.titles && result.titles.length > 0) {
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(result.titles[0]) + '</p>';
                    }
                    html += '</div>';
                }
                html += '</div>';

            } else if (state.bulkVideos.length > 0) {
                // Preview parsed videos
                html += '<div class="mb-6">';
                html += '<div class="flex justify-between items-center mb-4">';
                html += '<h3 class="text-lg font-bold text-white">' + state.bulkVideos.length + ' Videos Ready</h3>';
                html += '<button onclick="app.clearBulkVideos()" class="text-white/60 hover:text-white text-sm">Clear All</button>';
                html += '</div>';

                html += '<div class="space-y-2 max-h-60 overflow-y-auto mb-6">';
                for (var i = 0; i < state.bulkVideos.length; i++) {
                    html += '<div class="flex items-center gap-2 text-white/70 text-sm">';
                    html += '<span class="text-green-400">âœ“</span>';
                    html += '<span class="font-mono">' + utils.escapeHtml(state.bulkVideos[i].id) + '</span>';
                    html += '</div>';
                }
                html += '</div>';

                html += '<button onclick="app.runBulkOptimization()" class="btn-primary w-full">';
                html += 'ðŸš€ Optimize All ' + state.bulkVideos.length + ' Videos';
                html += '</button>';
                html += '</div>';

            } else {
                // Input form
                html += '<form onsubmit="event.preventDefault(); app.parseBulkInput();">';
                html += '<div class="mb-6">';
                html += '<label class="block text-white/80 font-medium mb-2">Paste Video URLs (one per line) or CSV Data</label>';
                html += '<textarea id="bulk-input" class="input-field" rows="8" placeholder="https://youtube.com/watch?v=VIDEO_ID_1&#10;https://youtube.com/watch?v=VIDEO_ID_2&#10;https://youtu.be/VIDEO_ID_3&#10;..."></textarea>';
                html += '</div>';

                html += '<button type="submit" class="btn-primary w-full">';
                html += 'ðŸ“‹ Parse & Preview Videos';
                html += '</button>';
                html += '</form>';

                // Tips
                html += '<div class="mt-6 p-4 bg-white/5 rounded-xl">';
                html += '<h4 class="text-white/80 font-medium mb-2">ðŸ’¡ Tips</h4>';
                html += '<ul class="text-white/60 text-sm space-y-1">';
                html += '<li>â€¢ Paste YouTube URLs (one per line)</li>';
                html += '<li>â€¢ Supports youtube.com/watch and youtu.be links</li>';
                html += '<li>â€¢ Maximum 50 videos per batch</li>';
                html += '<li>â€¢ CSV export available after optimization</li>';
                html += '</ul>';
                html += '</div>';
            }

            return html;
        }

        // Placement Finder
        function renderPlacementFinder() {
            var html = '';
            var results = state.placementResults;

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center text-2xl">ðŸŽ¬</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Placement Finder</h2>';
            html += '<p class="text-white/60">Find YouTube channels for Google Ads placements</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.loading && !results) {
                html += '<div class="text-center py-8">';
                html += '<div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-6">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="loading-emoji">ðŸŽ¬</div>';
                html += '<div class="text-left">';
                html += '<h3 class="text-xl font-bold text-white">Finding Placement Channels</h3>';
                html += '<p class="text-white/60">Analyzing your channel and finding matches...</p>';
                html += '</div>';
                html += '</div>';
                html += '<span id="progress-percent" class="text-2xl font-bold text-yellow-400">' + Math.round(state.loadingProgress) + '%</span>';
                html += '</div>';
                html += '<div class="progress-container mb-6">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';

                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (results && results.placements) {
                var placements = results.placements;
                var channelInfo = results.channelInfo || {};
                var analysis = results.analysis || {};

                // Action buttons
                html += '<div class="flex flex-wrap gap-3 mb-6">';
                html += '<button onclick="app.copyAllPlacements()" class="btn-primary flex items-center gap-2">';
                html += 'ðŸ“‹ Copy All ' + placements.length + ' Channels';
                html += '</button>';
                html += '<button onclick="app.downloadPDF(\'placement\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                if (placements.length < 50) {
                    html += '<button onclick="app.findMorePlacements()" class="btn-secondary flex items-center gap-2" ' + (state.placementLoading ? 'disabled' : '') + '>';
                    html += state.placementLoading ? '<span class="animate-spin">â³</span> Finding...' : 'ðŸ”„ Find 10 More';
                    html += '</button>';
                }
                html += '<button onclick="app.resetPlacements()" class="btn-secondary">ðŸ” New Search</button>';
                html += '</div>';

                // PDF Content wrapper
                html += '<div id="pdf-content-placement">';

                // Channel info card
                html += '<div class="result-card mb-6">';
                html += '<div class="flex flex-wrap items-center gap-4">';
                if (channelInfo.thumbnail) {
                    html += '<img src="' + utils.escapeHtml(channelInfo.thumbnail) + '" class="w-14 h-14 rounded-full object-cover" />';
                }
                html += '<div class="flex-1 min-w-[200px]">';
                html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(channelInfo.name || 'Your Channel') + '</p>';
                html += '<p class="text-white/60">' + utils.escapeHtml(analysis.niche || '') + '</p>';
                html += '</div>';
                html += '<div class="score-badge score-high">âœ“ ' + placements.length + ' Channels Found</div>';
                html += '</div>';
                html += '</div>';

                // Results table
                html += '<div class="overflow-x-auto">';
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>#</th>';
                html += '<th>Channel</th>';
                html += '<th class="hidden md:table-cell">Subscribers</th>';
                html += '<th class="hidden lg:table-cell">Score</th>';
                html += '<th class="text-right">Actions</th>';
                html += '</tr></thead>';
                html += '<tbody>';

                for (var i = 0; i < placements.length; i++) {
                    var p = placements[i];
                    html += '<tr>';
                    html += '<td class="text-white/40">' + (i + 1) + '</td>';
                    html += '<td>';
                    html += '<div class="flex items-center gap-3">';
                    if (p.thumbnail) {
                        html += '<img src="' + utils.escapeHtml(p.thumbnail) + '" class="w-10 h-10 rounded-full object-cover" />';
                    } else {
                        html += '<div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">ðŸ“º</div>';
                    }
                    html += '<div>';
                    html += '<p class="font-medium">' + utils.escapeHtml(p.channelName) + '</p>';
                    if (p.handle) {
                        html += '<p class="text-sm text-white/50">' + utils.escapeHtml(p.handle) + '</p>';
                    }
                    html += '</div>';
                    html += '</div>';
                    html += '</td>';
                    html += '<td class="hidden md:table-cell">' + utils.escapeHtml(p.subscribersFormatted) + '</td>';
                    html += '<td class="hidden lg:table-cell">';
                    var scoreClass = p.relevanceScore >= 80 ? 'score-high' : p.relevanceScore >= 60 ? 'score-medium' : 'score-low';
                    html += '<span class="score-badge ' + scoreClass + '">' + p.relevanceScore + '%</span>';
                    html += '</td>';
                    html += '<td class="text-right">';
                    html += '<div class="flex justify-end gap-2">';
                    html += '<a href="' + utils.escapeHtml(p.channelUrl) + '" target="_blank" class="p-2 text-white/50 hover:text-white rounded-lg transition-colors">ðŸ”—</a>';
                    html += '<button onclick="app.copySinglePlacement(\'' + utils.escapeHtml(p.channelUrl) + '\')" class="p-2 text-white/50 hover:text-green-400 rounded-lg transition-colors">ðŸ“‹</button>';
                    html += '</div>';
                    html += '</td>';
                    html += '</tr>';
                }

                html += '</tbody></table>';
                html += '</div>';
                html += '</div>'; // Close pdf-content-placement

                return html;
            }

            // Input form
            html += '<form onsubmit="app.findPlacements(event)">';
            html += '<div class="max-w-xl mx-auto">';

            html += '<div class="text-center mb-6">';
            html += '<p class="text-white/70 text-lg">Enter your YouTube channel link and we\'ll find successful channels whose audience may like your content.</p>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Your YouTube Channel URL</label>';
            html += '<input type="text" id="placement-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-sm text-white/50 mt-2">Supports: youtube.com/@handle, youtube.com/channel/..., youtube.com/c/...</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ” Find Placement Channels';
            html += '</button>';

            html += '</div></form>';

            // Tips
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl max-w-xl mx-auto">';
            html += '<h4 class="text-white/80 font-semibold mb-3">ðŸ’¡ What is Placement Targeting?</h4>';
            html += '<ul class="text-white/60 text-sm space-y-2">';
            html += '<li>â€¢ <strong class="text-white/80">Google Ads Placements</strong> let you show ads on specific YouTube channels</li>';
            html += '<li>â€¢ Find channels with audiences similar to your content</li>';
            html += '<li>â€¢ Copy channel URLs directly into your Google Ads campaign</li>';
            html += '<li>â€¢ Target viewers who are already interested in your niche</li>';
            html += '</ul>';
            html += '</div>';

            return html;
        }

        // Viral Score Predictor
        function renderViralPredictor() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center text-2xl">ðŸ”®</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Viral Score Predictor</h2>';
            html += '<p class="text-white/60">Predict your video\'s viral potential</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.viralLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ”®</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing viral potential...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.viralResults) {
                var results = state.viralResults;
                var score = results.viralScore || 0;
                var scoreClass = score >= 80 ? 'score-high' : score >= 50 ? 'score-medium' : 'score-low';

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'viral\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-viral">';

                html += '<div class="text-center mb-8">';
                html += '<div class="inline-block p-8 rounded-full bg-gradient-to-br from-pink-500/20 to-rose-600/20 border-2 border-pink-500/30 mb-4">';
                html += '<div class="text-6xl font-bold ' + (score >= 80 ? 'text-green-400' : score >= 50 ? 'text-yellow-400' : 'text-red-400') + '">' + score + '</div>';
                html += '<div class="text-white/60 text-sm">Viral Score</div>';
                html += '</div>';
                html += '<p class="text-xl text-white">' + utils.escapeHtml(results.verdict || 'Analysis complete') + '</p>';
                html += '</div>';

                // Factors
                if (results.factors && results.factors.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“Š Score Breakdown</h3>';
                    html += '<div class="space-y-3 mb-8">';
                    for (var i = 0; i < results.factors.length; i++) {
                        var factor = results.factors[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-center mb-2">';
                        html += '<span class="text-white font-medium">' + utils.escapeHtml(factor.name) + '</span>';
                        html += '<span class="font-bold ' + (factor.score >= 80 ? 'text-green-400' : factor.score >= 50 ? 'text-yellow-400' : 'text-red-400') + '">' + factor.score + '/100</span>';
                        html += '</div>';
                        html += '<div class="progress-container h-2">';
                        html += '<div class="progress-fill" style="width:' + factor.score + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Tips
                if (results.tips && results.tips.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’¡ Improvement Tips</h3>';
                    html += '<div class="space-y-2">';
                    for (var i = 0; i < results.tips.length; i++) {
                        html += '<div class="tip-accordion">';
                        html += '<div class="tip-header">';
                        html += '<span class="text-white">' + utils.escapeHtml(results.tips[i].title || results.tips[i]) + '</span>';
                        html += '</div>';
                        if (results.tips[i].detail) {
                            html += '<div class="tip-content">' + utils.escapeHtml(results.tips[i].detail) + '</div>';
                        }
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content-viral

                html += '<button onclick="app.resetViralPredictor()" class="btn-secondary w-full mt-6">ðŸ”® Analyze Another Video</button>';

                return html;
            }

            // Input form
            html += '<form onsubmit="app.predictViralScore(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Video Title *</label>';
            html += '<input type="text" id="viral-title" class="input-field" placeholder="Enter your video title..." required />';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Description (optional)</label>';
            html += '<textarea id="viral-description" class="input-field" rows="4" placeholder="Enter your video description..."></textarea>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Tags (optional)</label>';
            html += '<input type="text" id="viral-tags" class="input-field" placeholder="tag1, tag2, tag3..." />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ”® Predict Viral Score';
            html += '</button>';

            html += '</form>';

            // Viral tips section
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl">';
            html += '<h4 class="text-white/80 font-semibold mb-4">ðŸ”¥ What Makes Videos Go Viral?</h4>';
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">';
            html += '<div class="flex items-start gap-2"><span>ðŸŽ£</span><span class="text-white/60"><strong class="text-white/80">Strong Hook:</strong> First 3 seconds must grab attention</span></div>';
            html += '<div class="flex items-start gap-2"><span>ðŸ˜²</span><span class="text-white/60"><strong class="text-white/80">Emotional Trigger:</strong> Content that evokes strong emotions</span></div>';
            html += '<div class="flex items-start gap-2"><span>ðŸ“ˆ</span><span class="text-white/60"><strong class="text-white/80">Trending Topics:</strong> Relevance to current trends</span></div>';
            html += '<div class="flex items-start gap-2"><span>ðŸŽ¯</span><span class="text-white/60"><strong class="text-white/80">Clear Value:</strong> Viewers know what they\'ll learn</span></div>';
            html += '</div>';
            html += '</div>';

            return html;
        }

        // Monetization Analyzer
        function renderMonetization() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-2xl">ðŸ’°</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Monetization Analyzer</h2>';
            html += '<p class="text-white/60">Estimate channel earnings and optimize revenue</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.monetizationLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ’°</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing monetization data...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.monetizationResults) {
                var results = state.monetizationResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'monetization\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-monetization">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Earnings cards
                html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Monthly Estimate</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.monthlyEarnings || 0) + '</div>';
                html += '</div>';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Yearly Estimate</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.yearlyEarnings || 0) + '</div>';
                html += '</div>';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Estimated CPM</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.estimatedCPM || 0) + '</div>';
                html += '</div>';

                html += '</div>';

                // Breakdown
                if (results.breakdown) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“Š Revenue Breakdown</h3>';
                    html += '<div class="space-y-3 mb-6">';

                    var sources = ['adRevenue', 'sponsorships', 'memberships', 'merchandise'];
                    var sourceNames = { adRevenue: 'Ad Revenue', sponsorships: 'Sponsorships', memberships: 'Memberships', merchandise: 'Merchandise' };
                    var sourceIcons = { adRevenue: 'ðŸ“º', sponsorships: 'ðŸ¤', memberships: 'â­', merchandise: 'ðŸ›ï¸' };

                    for (var i = 0; i < sources.length; i++) {
                        var source = sources[i];
                        var amount = results.breakdown[source] || 0;
                        var percent = results.monthlyEarnings > 0 ? (amount / results.monthlyEarnings) * 100 : 0;

                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-center mb-2">';
                        html += '<span class="text-white flex items-center gap-2"><span>' + sourceIcons[source] + '</span> ' + sourceNames[source] + '</span>';
                        html += '<span class="text-green-400 font-bold">' + utils.formatCurrency(amount) + '</span>';
                        html += '</div>';
                        html += '<div class="progress-container h-2">';
                        html += '<div class="progress-fill" style="width:' + percent + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                    }

                    html += '</div>';
                }

                // Recommendations
                if (results.recommendations && results.recommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’¡ Revenue Optimization Tips</h3>';
                    html += '<div class="space-y-2">';
                    for (var i = 0; i < results.recommendations.length; i++) {
                        html += '<div class="result-card flex items-start gap-3">';
                        html += '<span class="text-yellow-400">ðŸ’¡</span>';
                        html += '<span class="text-white/80">' + utils.escapeHtml(results.recommendations[i]) + '</span>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content-monetization

                html += '<button onclick="app.resetMonetization()" class="btn-secondary w-full mt-6">ðŸ’° Analyze Another Channel</button>';

                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeMonetization(event)">';
            html += '<div class="max-w-xl mx-auto">';

            html += '<div class="text-center mb-6">';
            html += '<p class="text-white/70 text-lg">Enter any YouTube channel to estimate their potential earnings and get monetization insights.</p>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL</label>';
            html += '<input type="text" id="monetization-channel" class="input-field" placeholder="https://youtube.com/@channel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ’° Analyze Monetization';
            html += '</button>';

            html += '</div></form>';

            // Info box
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl max-w-xl mx-auto">';
            html += '<h4 class="text-white/80 font-semibold mb-3">ðŸ“Š How We Calculate Earnings</h4>';
            html += '<ul class="text-white/60 text-sm space-y-2">';
            html += '<li>â€¢ Based on public view counts and industry CPM rates</li>';
            html += '<li>â€¢ Accounts for niche-specific CPM variations</li>';
            html += '<li>â€¢ Includes potential sponsorship and membership revenue</li>';
            html += '<li>â€¢ Estimates are approximations and may vary</li>';
            html += '</ul>';
            html += '</div>';

            return html;
        }

        // Script Writer Pro
        function renderScriptWriter() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center text-2xl">ðŸ“</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Script Writer Pro</h2>';
            html += '<p class="text-white/60">AI-powered video scripts that engage</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.scriptLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">âœï¸</div>';
                html += '<p class="text-white text-lg mb-4">Writing your script...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.scriptResults) {
                var results = state.scriptResults;

                html += '<div class="flex justify-between items-center mb-4">';
                html += '<h3 class="text-lg font-bold text-white">ðŸ“œ Your Script</h3>';
                html += '<div class="flex gap-2">';
                html += '<button onclick="app.downloadPDF(\'script\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '<button onclick="app.copyScript()" class="btn-primary text-sm">ðŸ“‹ Copy Script</button>';
                html += '<button onclick="app.resetScript()" class="btn-secondary text-sm">âœï¸ New Script</button>';
                html += '</div>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-script">';

                // Script metadata
                if (results.title) {
                    html += '<div class="result-card mb-4">';
                    html += '<p class="text-white/60 text-sm mb-1">Suggested Title</p>';
                    html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(results.title) + '</p>';
                    html += '</div>';
                }

                // Duration info
                html += '<div class="flex gap-4 mb-4">';
                if (results.wordCount) {
                    html += '<div class="result-card flex-1 text-center">';
                    html += '<p class="text-2xl font-bold text-white">' + results.wordCount + '</p>';
                    html += '<p class="text-white/60 text-sm">Words</p>';
                    html += '</div>';
                }
                if (results.estimatedDuration) {
                    html += '<div class="result-card flex-1 text-center">';
                    html += '<p class="text-2xl font-bold text-white">' + results.estimatedDuration + '</p>';
                    html += '<p class="text-white/60 text-sm">Minutes</p>';
                    html += '</div>';
                }
                html += '</div>';

                // Script output
                html += '<div class="script-output">' + utils.escapeHtml(results.script || '') + '</div>';

                html += '</div>'; // Close pdf-content-script

                return html;
            }

            // Input form
            html += '<form onsubmit="app.generateScript(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Video Topic *</label>';
            html += '<input type="text" id="script-topic" class="input-field" placeholder="e.g., How to grow on YouTube in 2024" required />';
            html += '</div>';

            // Style selection
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-3">Script Style</label>';
            html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';

            var styles = [
                { key: 'engaging', icon: 'ðŸŽ¯', name: 'Engaging' },
                { key: 'educational', icon: 'ðŸ“š', name: 'Educational' },
                { key: 'storytelling', icon: 'ðŸ“–', name: 'Storytelling' },
                { key: 'listicle', icon: 'ðŸ“‹', name: 'Listicle' }
            ];

            for (var i = 0; i < styles.length; i++) {
                var style = styles[i];
                var isActive = state.scriptStyle === style.key;
                html += '<div onclick="app.setScriptStyle(\'' + style.key + '\')" class="tool-tab text-sm' + (isActive ? ' active' : '') + '">';
                html += '<div class="text-xl mb-1">' + style.icon + '</div>';
                html += '<div>' + style.name + '</div>';
                html += '</div>';
            }

            html += '</div>';
            html += '</div>';

            // Duration
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Target Duration</label>';
            html += '<select id="script-duration" class="input-field">';
            html += '<option value="short">Short (3-5 minutes)</option>';
            html += '<option value="medium" selected>Medium (8-12 minutes)</option>';
            html += '<option value="long">Long (15-20 minutes)</option>';
            html += '</select>';
            html += '</div>';

            // Keywords
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Keywords to Include (optional)</label>';
            html += '<input type="text" id="script-keywords" class="input-field" placeholder="keyword1, keyword2, keyword3..." />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ“ Generate Script';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // SPONSORSHIP RATE CALCULATOR
        // ==========================================
        function renderSponsorshipCalculator() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center text-2xl">ðŸ’Ž</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Sponsorship Rate Calculator</h2>';
            html += '<p class="text-white/60">Calculate your true market value for brand deals</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.sponsorshipLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ’Ž</div>';
                html += '<p class="text-white text-lg mb-4">Calculating your sponsorship rates...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.sponsorshipResults) {
                var results = state.sponsorshipResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'sponsorship\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-sponsorship">';

                // Channel info card
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers â€¢ ' + utils.escapeHtml(results.niche || 'General') + '</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Rate cards
                html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’° Your Sponsorship Rates</h3>';
                html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">';

                // Dedicated Video Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-green-400 mb-2">' + utils.escapeHtml(results.rates.dedicatedVideo || '$0') + '</div>';
                html += '<p class="text-white font-medium">Dedicated Video</p>';
                html += '<p class="text-white/60 text-sm">Full video about brand</p>';
                html += '</div>';

                // Integration Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-blue-400 mb-2">' + utils.escapeHtml(results.rates.integration || '$0') + '</div>';
                html += '<p class="text-white font-medium">Integration</p>';
                html += '<p class="text-white/60 text-sm">60-90 sec mention</p>';
                html += '</div>';

                // Shoutout Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-purple-400 mb-2">' + utils.escapeHtml(results.rates.shoutout || '$0') + '</div>';
                html += '<p class="text-white font-medium">Shoutout</p>';
                html += '<p class="text-white/60 text-sm">15-30 sec mention</p>';
                html += '</div>';
                html += '</div>';

                // Industry comparison
                html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“Š Industry Comparison</h3>';
                html += '<div class="result-card mb-6">';
                html += '<div class="space-y-4">';
                if (results.comparison) {
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Your Rate</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.rates.integration) + '</span>';
                    html += '</div>';
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Industry Average</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.comparison.average) + '</span>';
                    html += '</div>';
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Top Creators (' + utils.escapeHtml(results.niche) + ')</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.comparison.top) + '</span>';
                    html += '</div>';
                    html += '<div class="mt-4 p-3 rounded-lg ' + (results.comparison.position === 'above' ? 'bg-green-500/20' : results.comparison.position === 'below' ? 'bg-yellow-500/20' : 'bg-blue-500/20') + '">';
                    html += '<p class="text-white text-sm">' + utils.escapeHtml(results.comparison.insight) + '</p>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';

                // Negotiation tips
                if (results.negotiationTips && results.negotiationTips.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¯ Negotiation Strategies</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.negotiationTips.length; i++) {
                        var tip = results.negotiationTips[i];
                        html += '<div class="result-card">';
                        html += '<h4 class="text-white font-medium mb-1">' + utils.escapeHtml(tip.title) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(tip.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetSponsorship()" class="btn-secondary w-full mt-6">Calculate for Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.calculateSponsorship(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="sponsorship-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">We\'ll analyze your channel metrics and niche to calculate rates</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ’Ž Calculate My Rates';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // REVENUE DIVERSIFICATION ANALYZER
        // ==========================================
        function renderRevenueDiversification() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center text-2xl">ðŸ“Š</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Revenue Diversification Analyzer</h2>';
            html += '<p class="text-white/60">Identify untapped income streams for your channel</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.diversificationLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ“Š</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing your revenue opportunities...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.diversificationResults) {
                var results = state.diversificationResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'diversification\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-diversification">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div class="flex-1">';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '<div class="text-right">';
                html += '<div class="text-2xl font-bold text-yellow-400">' + (results.diversificationScore || 0) + '%</div>';
                html += '<p class="text-white/60 text-sm">Diversification Score</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Current revenue sources
                html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’° Current Revenue Sources</h3>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">';
                if (results.currentSources) {
                    for (var i = 0; i < results.currentSources.length; i++) {
                        var source = results.currentSources[i];
                        html += '<div class="result-card text-center">';
                        html += '<div class="text-2xl mb-2">' + source.icon + '</div>';
                        html += '<p class="text-white font-medium text-sm">' + utils.escapeHtml(source.name) + '</p>';
                        html += '<p class="text-white/60 text-xs">' + (source.active ? 'âœ… Active' : 'âŒ Not Active') + '</p>';
                        if (source.estimated) {
                            html += '<p class="text-green-400 text-sm font-bold mt-1">' + utils.escapeHtml(source.estimated) + '/mo</p>';
                        }
                        html += '</div>';
                    }
                }
                html += '</div>';

                // Missing revenue gap
                html += '<div class="result-card mb-6 bg-gradient-to-r from-red-500/20 to-orange-500/20 border-red-500/30">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="text-4xl">âš ï¸</div>';
                html += '<div>';
                html += '<h4 class="text-xl font-bold text-white">Missing Revenue Potential</h4>';
                html += '<p class="text-white/80">You\'re leaving approximately <span class="text-yellow-400 font-bold">' + utils.escapeHtml(results.missingRevenue || '$0') + '</span> on the table each month</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Recommended revenue streams
                if (results.recommendations && results.recommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸš€ Recommended Revenue Streams</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.recommendations.length; i++) {
                        var rec = results.recommendations[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-4">';
                        html += '<div class="text-3xl">' + rec.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(rec.name) + '</h4>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(rec.potential) + '/mo</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(rec.description) + '</p>';
                        html += '<div class="flex gap-2">';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300">Effort: ' + utils.escapeHtml(rec.effort) + '</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300">ROI: ' + utils.escapeHtml(rec.roi) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Action plan
                if (results.actionPlan && results.actionPlan.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“‹ Prioritized Action Plan</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.actionPlan.length; i++) {
                        var action = results.actionPlan[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold">' + (i + 1) + '</div>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(action.task) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(action.impact) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetDiversification()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeDiversification(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="diversification-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Current Revenue Sources (select all that apply)</label>';
            html += '<div class="grid grid-cols-2 gap-3">';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-adsense" class="rounded" /> <span class="text-white/80">AdSense</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-sponsors" class="rounded" /> <span class="text-white/80">Sponsorships</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-merch" class="rounded" /> <span class="text-white/80">Merchandise</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-courses" class="rounded" /> <span class="text-white/80">Courses</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-affiliate" class="rounded" /> <span class="text-white/80">Affiliates</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-memberships" class="rounded" /> <span class="text-white/80">Memberships</span>';
            html += '</label>';
            html += '</div>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ“Š Analyze Revenue Gaps';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // CPM BOOSTER STRATEGIST
        // ==========================================
        function renderCpmBooster() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-2xl">ðŸ’°</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">CPM Booster Strategist</h2>';
            html += '<p class="text-white/60">Optimize content for higher-paying advertisers</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.cpmBoosterLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ’°</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing CPM optimization strategies...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.cpmBoosterResults) {
                var results = state.cpmBoosterResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'cpmbooster\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-cpmbooster">';

                // Current vs potential CPM
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';
                html += '<div class="result-card text-center">';
                html += '<p class="text-white/60 text-sm mb-2">Current Estimated CPM</p>';
                html += '<div class="text-4xl font-bold text-white">' + utils.escapeHtml(results.currentCPM || '$0') + '</div>';
                html += '<p class="text-white/60 text-sm">per 1,000 views</p>';
                html += '</div>';
                html += '<div class="result-card text-center bg-gradient-to-br from-green-500/20 to-emerald-500/20">';
                html += '<p class="text-white/60 text-sm mb-2">Potential CPM</p>';
                html += '<div class="text-4xl font-bold text-green-400">' + utils.escapeHtml(results.potentialCPM || '$0') + '</div>';
                html += '<p class="text-green-400 text-sm">+' + utils.escapeHtml(results.cpmIncrease || '0%') + ' increase possible</p>';
                html += '</div>';
                html += '</div>';

                // High CPM keywords
                if (results.highCpmKeywords && results.highCpmKeywords.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ”‘ High-CPM Keywords for Your Niche</h3>';
                    html += '<div class="result-card mb-6">';
                    html += '<div class="flex flex-wrap gap-2">';
                    for (var i = 0; i < results.highCpmKeywords.length; i++) {
                        var kw = results.highCpmKeywords[i];
                        html += '<span class="px-3 py-2 rounded-lg bg-green-500/20 text-green-300 text-sm">';
                        html += utils.escapeHtml(kw.keyword) + ' <span class="text-green-400 font-bold">$' + kw.cpm + '</span>';
                        html += '</span>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Video topic ideas
                if (results.topicIdeas && results.topicIdeas.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¬ High-CPM Video Ideas</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.topicIdeas.length; i++) {
                        var topic = results.topicIdeas[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-medium">' + utils.escapeHtml(topic.title) + '</h4>';
                        html += '<span class="text-green-400 font-bold text-sm">$' + topic.estimatedCpm + ' CPM</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(topic.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Optimal video length
                html += '<h3 class="text-lg font-bold text-white mb-4">â±ï¸ Optimal Video Length</h3>';
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="text-4xl">ðŸŽ¯</div>';
                html += '<div>';
                html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(results.optimalLength || '8-12 minutes') + '</p>';
                html += '<p class="text-white/60">' + utils.escapeHtml(results.lengthReason || 'Optimal for mid-roll ads placement') + '</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Content calendar (Q4, peak times)
                if (results.contentCalendar && results.contentCalendar.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“… Revenue Peak Calendar</h3>';
                    html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">';
                    for (var i = 0; i < results.contentCalendar.length; i++) {
                        var period = results.contentCalendar[i];
                        html += '<div class="result-card text-center">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(period.period) + '</p>';
                        html += '<p class="text-' + (period.cpmMultiplier > 1.5 ? 'green' : period.cpmMultiplier > 1 ? 'yellow' : 'white') + '-400 font-bold">' + period.cpmMultiplier + 'x CPM</p>';
                        html += '<p class="text-white/60 text-xs">' + utils.escapeHtml(period.tip) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetCpmBooster()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeCpmBooster(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="cpmbooster-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ’° Find CPM Opportunities';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // AUDIENCE MONETIZATION PROFILER
        // ==========================================
        function renderAudienceProfile() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center text-2xl">ðŸ“±</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Audience Monetization Profiler</h2>';
            html += '<p class="text-white/60">Deep analysis of your audience\'s spending behavior</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.audienceProfileLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ“±</div>';
                html += '<p class="text-white text-lg mb-4">Profiling your audience...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.audienceProfileResults) {
                var results = state.audienceProfileResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'audienceprofile\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-audienceprofile">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Audience segments
                if (results.segments && results.segments.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ‘¥ Audience Segments by Value</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.segments.length; i++) {
                        var seg = results.segments[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-center gap-4 mb-3">';
                        html += '<div class="text-3xl">' + seg.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-center">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(seg.name) + '</h4>';
                        html += '<span class="text-white/60">' + seg.percentage + '% of audience</span>';
                        html += '</div>';
                        html += '<div class="w-full bg-white/10 rounded-full h-2 mt-2">';
                        html += '<div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full h-2" style="width:' + seg.percentage + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="text-right">';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(seg.value) + '</span>';
                        html += '<p class="text-white/60 text-xs">lifetime value</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(seg.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Product recommendations
                if (results.productRecommendations && results.productRecommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ›ï¸ Products Your Audience Will Buy</h3>';
                    html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';
                    for (var i = 0; i < results.productRecommendations.length; i++) {
                        var prod = results.productRecommendations[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-3">';
                        html += '<div class="text-2xl">' + prod.icon + '</div>';
                        html += '<div>';
                        html += '<h4 class="text-white font-medium">' + utils.escapeHtml(prod.name) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(prod.reason) + '</p>';
                        html += '<p class="text-green-400 text-sm font-bold mt-1">Conversion potential: ' + prod.conversionRate + '%</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Content recommendations
                if (results.contentRecommendations && results.contentRecommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¯ Content to Attract Higher-Value Viewers</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.contentRecommendations.length; i++) {
                        var rec = results.contentRecommendations[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">' + (i + 1) + '</div>';
                        html += '<div>';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(rec.title) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(rec.impact) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Targeted offers
                if (results.targetedOffers && results.targetedOffers.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’¡ Targeted Offer Ideas</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.targetedOffers.length; i++) {
                        var offer = results.targetedOffers[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(offer.name) + '</h4>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-purple-500/20 text-purple-300">For: ' + utils.escapeHtml(offer.segment) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(offer.description) + '</p>';
                        html += '<p class="text-green-400 text-sm">Expected revenue: ' + utils.escapeHtml(offer.expectedRevenue) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetAudienceProfile()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeAudienceProfile(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="audienceprofile-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ“± Profile My Audience';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // DIGITAL PRODUCT ARCHITECT
        // ==========================================
        function renderDigitalProductArchitect() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-2xl">ðŸ›’</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Digital Product Architect</h2>';
            html += '<p class="text-white/60">Design and price digital products for your audience</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.digitalProductLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ›’</div>';
                html += '<p class="text-white text-lg mb-4">Designing your digital products...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.digitalProductResults) {
                var results = state.digitalProductResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'digitalproduct\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-digitalproduct">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers â€¢ ' + utils.escapeHtml(results.niche || 'General') + '</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Product ideas
                if (results.productIdeas && results.productIdeas.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¯ Recommended Digital Products</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.productIdeas.length; i++) {
                        var product = results.productIdeas[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-4">';
                        html += '<div class="text-3xl">' + product.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(product.name) + '</h4>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(product.price) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-3">' + utils.escapeHtml(product.description) + '</p>';
                        if (product.outline && product.outline.length > 0) {
                            html += '<div class="bg-white/5 rounded-lg p-3">';
                            html += '<p class="text-white/80 text-sm font-medium mb-2">Product Outline:</p>';
                            html += '<ul class="text-white/60 text-sm space-y-1">';
                            for (var j = 0; j < product.outline.length; j++) {
                                html += '<li>â€¢ ' + utils.escapeHtml(product.outline[j]) + '</li>';
                            }
                            html += '</ul>';
                            html += '</div>';
                        }
                        html += '<div class="flex gap-2 mt-3">';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300">Est. Sales: ' + utils.escapeHtml(product.estimatedSales) + '/mo</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300">Profit: ' + utils.escapeHtml(product.profitMargin) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Pricing strategy
                if (results.pricingStrategy) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’° Pricing Strategy</h3>';
                    html += '<div class="result-card mb-6">';
                    html += '<p class="text-white/80 mb-4">' + utils.escapeHtml(results.pricingStrategy.rationale) + '</p>';
                    html += '<div class="grid grid-cols-3 gap-4">';
                    html += '<div class="text-center">';
                    html += '<p class="text-white/60 text-sm">Budget Tier</p>';
                    html += '<p class="text-white font-bold">' + utils.escapeHtml(results.pricingStrategy.budget) + '</p>';
                    html += '</div>';
                    html += '<div class="text-center">';
                    html += '<p class="text-white/60 text-sm">Standard Tier</p>';
                    html += '<p class="text-white font-bold">' + utils.escapeHtml(results.pricingStrategy.standard) + '</p>';
                    html += '</div>';
                    html += '<div class="text-center">';
                    html += '<p class="text-white/60 text-sm">Premium Tier</p>';
                    html += '<p class="text-white font-bold">' + utils.escapeHtml(results.pricingStrategy.premium) + '</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }

                // Launch timeline
                if (results.launchTimeline && results.launchTimeline.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“… Launch Strategy Timeline</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.launchTimeline.length; i++) {
                        var phase = results.launchTimeline[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm">' + phase.week + '</div>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(phase.task) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(phase.details) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetDigitalProduct()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeDigitalProduct(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="digitalproduct-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">We\'ll analyze your content to suggest digital products your audience would buy</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ›’ Design My Products';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // AFFILIATE GOLDMINE FINDER
        // ==========================================
        function renderAffiliateFinder() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl flex items-center justify-center text-2xl">ðŸ“ˆ</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Affiliate Goldmine Finder</h2>';
            html += '<p class="text-white/60">Discover high-paying affiliate opportunities in your niche</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.affiliateLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ“ˆ</div>';
                html += '<p class="text-white text-lg mb-4">Finding affiliate opportunities...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.affiliateResults) {
                var results = state.affiliateResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'affiliate\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-affiliate">';

                // Summary card
                html += '<div class="result-card mb-6 bg-gradient-to-r from-yellow-500/20 to-orange-500/20">';
                html += '<div class="flex items-center justify-between">';
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">Potential Monthly Earnings</h3>';
                html += '<p class="text-white/60">From affiliate marketing</p>';
                html += '</div>';
                html += '<div class="text-3xl font-bold text-yellow-400">' + utils.escapeHtml(results.potentialEarnings || '$0') + '</div>';
                html += '</div>';
                html += '</div>';

                // Affiliate programs
                if (results.affiliatePrograms && results.affiliatePrograms.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’° Top Affiliate Programs for You</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.affiliatePrograms.length; i++) {
                        var program = results.affiliatePrograms[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-4">';
                        html += '<div class="text-3xl">' + program.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(program.name) + '</h4>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(program.commission) + ' commission</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(program.description) + '</p>';
                        html += '<div class="flex flex-wrap gap-2">';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300">Cookie: ' + utils.escapeHtml(program.cookieDuration) + '</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300">Avg. Payout: ' + utils.escapeHtml(program.avgPayout) + '</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-purple-500/20 text-purple-300">Fit Score: ' + program.fitScore + '/10</span>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Product placement scripts
                if (results.placementScripts && results.placementScripts.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“ Natural Placement Scripts</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.placementScripts.length; i++) {
                        var script = results.placementScripts[i];
                        html += '<div class="result-card">';
                        html += '<h4 class="text-white font-medium mb-2">' + utils.escapeHtml(script.product) + '</h4>';
                        html += '<p class="text-white/80 text-sm italic bg-white/5 rounded-lg p-3">"' + utils.escapeHtml(script.script) + '"</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Earnings calculator
                if (results.earningsBreakdown) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“Š Earnings Breakdown (per 1,000 views)</h3>';
                    html += '<div class="result-card mb-6">';
                    html += '<div class="space-y-3">';
                    if (results.earningsBreakdown.products) {
                        for (var i = 0; i < results.earningsBreakdown.products.length; i++) {
                            var prod = results.earningsBreakdown.products[i];
                            html += '<div class="flex justify-between items-center">';
                            html += '<span class="text-white/80">' + utils.escapeHtml(prod.name) + '</span>';
                            html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(prod.earnings) + '</span>';
                            html += '</div>';
                        }
                    }
                    html += '<div class="border-t border-white/10 pt-3 mt-3 flex justify-between items-center">';
                    html += '<span class="text-white font-bold">Total per 1K views</span>';
                    html += '<span class="text-yellow-400 font-bold">' + utils.escapeHtml(results.earningsBreakdown.total) + '</span>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetAffiliate()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeAffiliate(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="affiliate-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">We\'ll find affiliate programs that match your content and audience</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ“ˆ Find Affiliate Goldmines';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // VIDEO-TO-MULTI-INCOME CONVERTER
        // ==========================================
        function renderMultiIncomeConverter() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl flex items-center justify-center text-2xl">ðŸŽ¬</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Video-to-Multi-Income Converter</h2>';
            html += '<p class="text-white/60">Turn one video into multiple revenue streams</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.multiIncomeLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸŽ¬</div>';
                html += '<p class="text-white text-lg mb-4">Converting video to multiple income streams...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? 'âœ“' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.multiIncomeResults) {
                var results = state.multiIncomeResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'multiincome\')" class="btn-pdf">ðŸ“¥ Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-multiincome">';

                // Video info
                html += '<div class="result-card mb-6">';
                html += '<h3 class="text-lg font-bold text-white mb-2">' + utils.escapeHtml(results.videoTitle || 'Your Video') + '</h3>';
                html += '<p class="text-white/60 text-sm">Original video analyzed for multi-platform repurposing</p>';
                html += '</div>';

                // Revenue potential summary
                html += '<div class="result-card mb-6 bg-gradient-to-r from-teal-500/20 to-cyan-500/20">';
                html += '<div class="text-center">';
                html += '<p class="text-white/60 text-sm mb-2">Combined Revenue Potential</p>';
                html += '<div class="text-4xl font-bold text-teal-400">' + utils.escapeHtml(results.totalPotential || '$0') + '</div>';
                html += '<p class="text-white/60 text-sm">from ' + (results.contentPieces ? results.contentPieces.length : 0) + ' content pieces</p>';
                html += '</div>';
                html += '</div>';

                // Content pieces
                if (results.contentPieces && results.contentPieces.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸš€ Generated Content Pieces</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.contentPieces.length; i++) {
                        var piece = results.contentPieces[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-4">';
                        html += '<div class="text-3xl">' + piece.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(piece.type) + '</h4>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(piece.revenue) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-3">' + utils.escapeHtml(piece.description) + '</p>';
                        if (piece.content) {
                            html += '<div class="bg-white/5 rounded-lg p-3 mb-3">';
                            html += '<p class="text-white/80 text-sm whitespace-pre-line">' + utils.escapeHtml(piece.content.substring(0, 300)) + (piece.content.length > 300 ? '...' : '') + '</p>';
                            html += '</div>';
                        }
                        html += '<div class="flex gap-2">';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300">Platform: ' + utils.escapeHtml(piece.platform) + '</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-purple-500/20 text-purple-300">Effort: ' + utils.escapeHtml(piece.effort) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Distribution strategy
                if (results.distributionStrategy && results.distributionStrategy.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“… Distribution Timeline</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.distributionStrategy.length; i++) {
                        var dist = results.distributionStrategy[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-12 h-12 rounded-full bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center text-white font-bold text-sm">' + dist.day + '</div>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(dist.action) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(dist.platform) + '</p>';
                        html += '</div>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(dist.expectedReach) + '</span>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetMultiIncome()" class="btn-secondary w-full mt-6">Convert Another Video</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeMultiIncome(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Video URL *</label>';
            html += '<input type="text" id="multiincome-video-url" class="input-field" placeholder="https://youtube.com/watch?v=..." required />';
            html += '<p class="text-white/40 text-sm mt-2">Paste any YouTube video URL to generate multi-platform content</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸŽ¬ Convert to Multi-Income';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // BRAND DEAL MATCHMAKER
        // ==========================================
        function renderBrandDealMatchmaker() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center text-2xl">ðŸ¤</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Brand Deal Matchmaker</h2>';
            html += '<p class="text-white/60">Find perfect brand partnerships for your channel</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.brandDealLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ¤</div>';
                html += '<p class="text-white text-lg mb-4">Finding brand partnerships...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += renderLoadingSteps();
                html += '</div>';
                return html;
            }

            // Results state
            if (state.brandDealResults) {
                var results = state.brandDealResults;

                html += '<div id="pdf-content-branddeal" class="space-y-6">';

                // Channel info header
                html += '<div class="tool-card p-4 flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + results.channelThumbnail + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div class="flex-1">';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Channel') + '</h3>';
                html += '<p class="text-white/60">' + (results.subscribers ? results.subscribers.toLocaleString() : '0') + ' subscribers â€¢ ' + utils.escapeHtml(results.niche || 'General') + '</p>';
                html += '</div>';
                html += '<button onclick="app.downloadPDF(\'branddeal\')" class="btn-secondary px-4 py-2">ðŸ“¥ Export PDF</button>';
                html += '</div>';

                // Matched Brands
                if (results.matchedBrands && results.matchedBrands.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¯ Matched Brand Partners</h3>';
                    html += '<div class="space-y-4">';
                    for (var i = 0; i < results.matchedBrands.length; i++) {
                        var brand = results.matchedBrands[i];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-start justify-between mb-2">';
                        html += '<div class="flex items-center gap-2">';
                        html += '<span class="text-2xl">' + (brand.icon || 'ðŸ¢') + '</span>';
                        html += '<div>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(brand.name) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(brand.industry) + '</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '<span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-medium">' + (brand.matchScore || 0) + '% Match</span>';
                        html += '</div>';
                        html += '<p class="text-white/70 text-sm mb-3">' + utils.escapeHtml(brand.whyMatch) + '</p>';
                        html += '<div class="flex items-center gap-4 text-sm">';
                        html += '<span class="text-yellow-400">ðŸ’° ' + utils.escapeHtml(brand.dealRange) + '</span>';
                        html += '<span class="text-blue-400">ðŸ“§ ' + utils.escapeHtml(brand.contactMethod) + '</span>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Pitch Templates
                if (results.pitchTemplates && results.pitchTemplates.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“ Pitch Templates</h3>';
                    html += '<div class="space-y-4">';
                    for (var j = 0; j < results.pitchTemplates.length; j++) {
                        var pitch = results.pitchTemplates[j];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-center gap-2 mb-2">';
                        html += '<span class="text-xl">' + (pitch.icon || 'ðŸ“„') + '</span>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(pitch.type) + '</h4>';
                        html += '</div>';
                        html += '<p class="text-white/70 text-sm bg-black/20 p-3 rounded font-mono whitespace-pre-wrap">' + utils.escapeHtml(pitch.template) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Negotiation Tips
                if (results.negotiationTips && results.negotiationTips.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’¡ Negotiation Tips</h3>';
                    html += '<div class="grid md:grid-cols-2 gap-4">';
                    for (var k = 0; k < results.negotiationTips.length; k++) {
                        var tip = results.negotiationTips[k];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<h4 class="text-white font-medium mb-2">' + utils.escapeHtml(tip.title) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(tip.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetBrandDeal()" class="btn-secondary w-full mt-6">Find More Brand Deals</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeBrandDeal(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="branddeal-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">Enter your channel URL to find matching brand partners</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ¤ Find Brand Partners';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // LICENSING & SYNDICATION SCOUT
        // ==========================================
        function renderLicensingScout() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl flex items-center justify-center text-2xl">ðŸ“œ</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Licensing & Syndication Scout</h2>';
            html += '<p class="text-white/60">Find licensing opportunities for your content</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.licensingLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">ðŸ“œ</div>';
                html += '<p class="text-white text-lg mb-4">Scouting licensing opportunities...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += renderLoadingSteps();
                html += '</div>';
                return html;
            }

            // Results state
            if (state.licensingResults) {
                var results = state.licensingResults;

                html += '<div id="pdf-content-licensing" class="space-y-6">';

                // Channel/Video info header
                html += '<div class="tool-card p-4 flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + results.channelThumbnail + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div class="flex-1">';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.escapeHtml(results.niche || 'General') + ' content</p>';
                html += '</div>';
                html += '<button onclick="app.downloadPDF(\'licensing\')" class="btn-secondary px-4 py-2">ðŸ“¥ Export PDF</button>';
                html += '</div>';

                // Licensing Opportunities
                if (results.opportunities && results.opportunities.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŽ¯ Licensing Opportunities</h3>';
                    html += '<div class="space-y-4">';
                    for (var i = 0; i < results.opportunities.length; i++) {
                        var opp = results.opportunities[i];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-start justify-between mb-2">';
                        html += '<div class="flex items-center gap-2">';
                        html += '<span class="text-2xl">' + (opp.icon || 'ðŸ“º') + '</span>';
                        html += '<div>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(opp.platform) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(opp.type) + '</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(opp.potentialRevenue) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/70 text-sm mb-3">' + utils.escapeHtml(opp.description) + '</p>';
                        html += '<div class="flex items-center gap-4 text-sm">';
                        html += '<span class="text-blue-400">ðŸ“‹ ' + utils.escapeHtml(opp.requirements) + '</span>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Syndication Networks
                if (results.syndicationNetworks && results.syndicationNetworks.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸŒ Syndication Networks</h3>';
                    html += '<div class="grid md:grid-cols-2 gap-4">';
                    for (var j = 0; j < results.syndicationNetworks.length; j++) {
                        var network = results.syndicationNetworks[j];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-center gap-2 mb-2">';
                        html += '<span class="text-xl">' + (network.icon || 'ðŸ”—') + '</span>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(network.name) + '</h4>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(network.description) + '</p>';
                        html += '<p class="text-yellow-400 text-sm font-medium">' + utils.escapeHtml(network.revenueModel) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Action Steps
                if (results.actionSteps && results.actionSteps.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“‹ Action Steps</h3>';
                    html += '<div class="space-y-3">';
                    for (var k = 0; k < results.actionSteps.length; k++) {
                        var step = results.actionSteps[k];
                        html += '<div class="flex items-start gap-3 bg-white/5 rounded-lg p-3">';
                        html += '<span class="w-8 h-8 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-full flex items-center justify-center text-white font-bold text-sm">' + (k + 1) + '</span>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(step.action) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(step.details) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetLicensing()" class="btn-secondary w-full mt-6">Scout More Opportunities</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeLicensing(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="licensing-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">Enter your channel URL to find licensing and syndication opportunities</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'ðŸ“œ Scout Opportunities';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // REVENUE AUTOMATION PIPELINE
        // ==========================================
        function renderRevenueAutomation() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center text-2xl">âš™ï¸</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Revenue Automation Pipeline</h2>';
            html += '<p class="text-white/60">Build automated revenue systems for your channel</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.automationLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">âš™ï¸</div>';
                html += '<p class="text-white text-lg mb-4">Building your automation pipeline...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += renderLoadingSteps();
                html += '</div>';
                return html;
            }

            // Results state
            if (state.automationResults) {
                var results = state.automationResults;

                html += '<div id="pdf-content-automation" class="space-y-6">';

                // Channel info header
                html += '<div class="tool-card p-4 flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + results.channelThumbnail + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div class="flex-1">';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Channel') + '</h3>';
                html += '<p class="text-white/60">Automation Potential: <span class="text-green-400 font-bold">' + utils.escapeHtml(results.automationScore || '0') + '%</span></p>';
                html += '</div>';
                html += '<button onclick="app.downloadPDF(\'automation\')" class="btn-secondary px-4 py-2">ðŸ“¥ Export PDF</button>';
                html += '</div>';

                // Revenue Summary
                if (results.revenueSummary) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ’° Revenue Automation Summary</h3>';
                    html += '<div class="grid grid-cols-3 gap-4">';
                    html += '<div class="bg-white/5 rounded-lg p-4 text-center">';
                    html += '<p class="text-white/60 text-sm">Current Manual</p>';
                    html += '<p class="text-2xl font-bold text-white">' + utils.escapeHtml(results.revenueSummary.currentManual) + '</p>';
                    html += '</div>';
                    html += '<div class="bg-white/5 rounded-lg p-4 text-center">';
                    html += '<p class="text-white/60 text-sm">After Automation</p>';
                    html += '<p class="text-2xl font-bold text-green-400">' + utils.escapeHtml(results.revenueSummary.afterAutomation) + '</p>';
                    html += '</div>';
                    html += '<div class="bg-white/5 rounded-lg p-4 text-center">';
                    html += '<p class="text-white/60 text-sm">Time Saved</p>';
                    html += '<p class="text-2xl font-bold text-blue-400">' + utils.escapeHtml(results.revenueSummary.timeSaved) + '</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }

                // Automation Workflows
                if (results.workflows && results.workflows.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ”„ Automation Workflows</h3>';
                    html += '<div class="space-y-4">';
                    for (var i = 0; i < results.workflows.length; i++) {
                        var workflow = results.workflows[i];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-start justify-between mb-3">';
                        html += '<div class="flex items-center gap-2">';
                        html += '<span class="text-2xl">' + (workflow.icon || 'âš¡') + '</span>';
                        html += '<div>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(workflow.name) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(workflow.category) + '</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '<span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm">' + utils.escapeHtml(workflow.difficulty) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/70 text-sm mb-3">' + utils.escapeHtml(workflow.description) + '</p>';
                        html += '<div class="flex items-center justify-between text-sm">';
                        html += '<span class="text-green-400">ðŸ’° ' + utils.escapeHtml(workflow.revenueImpact) + '</span>';
                        html += '<span class="text-blue-400">ðŸ› ï¸ ' + utils.escapeHtml(workflow.tools) + '</span>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Tool Stack
                if (results.toolStack && results.toolStack.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ› ï¸ Recommended Tool Stack</h3>';
                    html += '<div class="grid md:grid-cols-2 gap-4">';
                    for (var j = 0; j < results.toolStack.length; j++) {
                        var tool = results.toolStack[j];
                        html += '<div class="bg-white/5 rounded-lg p-4 border border-white/10">';
                        html += '<div class="flex items-center gap-2 mb-2">';
                        html += '<span class="text-xl">' + (tool.icon || 'ðŸ”§') + '</span>';
                        html += '<h4 class="text-white font-semibold">' + utils.escapeHtml(tool.name) + '</h4>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(tool.purpose) + '</p>';
                        html += '<p class="text-yellow-400 text-sm">' + utils.escapeHtml(tool.pricing) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Implementation Timeline
                if (results.timeline && results.timeline.length > 0) {
                    html += '<div class="tool-card p-6">';
                    html += '<h3 class="text-lg font-bold text-white mb-4">ðŸ“… Implementation Timeline</h3>';
                    html += '<div class="space-y-3">';
                    for (var k = 0; k < results.timeline.length; k++) {
                        var phase = results.timeline[k];
                        html += '<div class="flex items-start gap-3 bg-white/5 rounded-lg p-3">';
                        html += '<span class="px-3 py-1 bg-gradient-to-r from-orange-500 to-red-600 rounded text-white font-bold text-sm">' + utils.escapeHtml(phase.week) + '</span>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(phase.focus) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(phase.tasks) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetAutomation()" class="btn-secondary w-full mt-6">Build Another Pipeline</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeAutomation(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="automation-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">Enter your channel URL to build automated revenue pipelines</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'âš™ï¸ Build Automation Pipeline';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // History view
        function renderHistory() {
            var html = '';

            // Toast notifications
            if (state.error) {
                html += '<div class="toast toast-error">âŒ ' + utils.escapeHtml(state.error) + '</div>';
            }

            html += '<div class="min-h-screen py-8 px-4">';
            html += '<div class="max-w-6xl mx-auto">';

            // Header with back button
            html += '<div class="flex items-center gap-4 mb-6">';
            html += '<button onclick="app.goToTools()" class="btn-secondary px-4 py-2">â† Back to Tools</button>';
            html += '<h1 class="text-2xl font-bold text-white">ðŸ“œ History</h1>';
            html += '</div>';

            // History tabs
            html += '<div class="flex flex-wrap gap-2 mb-6">';
            var tabs = [
                { key: 'all', icon: 'ðŸ“‹', name: 'All', count: state.allHistory ? state.allHistory.length : 0 },
                { key: 'placement', icon: 'ðŸ“', name: 'Placement', count: state.historyCounts?.placements || 0 },
                { key: 'viral', icon: 'ðŸ“ˆ', name: 'Viral Score', count: state.historyCounts?.viral || 0 },
                { key: 'monetization', icon: 'ðŸ’°', name: 'Monetization', count: state.historyCounts?.monetization || 0 },
                { key: 'script', icon: 'ðŸ“', name: 'Scripts', count: state.historyCounts?.scripts || 0 }
            ];

            for (var i = 0; i < tabs.length; i++) {
                var tab = tabs[i];
                var isActive = state.historyTab === tab.key;
                html += '<button onclick="app.setHistoryTab(\'' + tab.key + '\')" class="tab-btn' + (isActive ? ' active' : '') + '">';
                html += tab.icon + ' ' + tab.name + ' <span class="text-xs opacity-60">(' + tab.count + ')</span>';
                html += '</button>';
            }
            html += '</div>';

            // Content
            html += '<div class="tool-card p-6">';

            if (state.loading) {
                html += '<div class="text-center py-12">';
                html += '<div class="loading-emoji mb-4">ðŸ“œ</div>';
                html += '<p class="text-white/60">Loading history...</p>';
                html += '</div>';
            } else {
                var historyItems = getHistoryItems();

                if (historyItems.length === 0) {
                    html += '<div class="text-center py-12">';
                    html += '<div class="text-6xl mb-4">ðŸ“­</div>';
                    html += '<p class="text-white/60 text-lg">No history yet</p>';
                    html += '<p class="text-white/40 text-sm mt-2">Your tool results will appear here</p>';
                    html += '</div>';
                } else {
                    html += '<div class="space-y-4">';
                    for (var j = 0; j < historyItems.length; j++) {
                        html += renderHistoryItem(historyItems[j]);
                    }
                    html += '</div>';
                }
            }

            html += '</div>';
            html += '</div>';
            html += '</div>';

            return html;
        }

        // Get history items based on active tab
        function getHistoryItems() {
            switch (state.historyTab) {
                case 'placement':
                    return state.placementHistory || [];
                case 'viral':
                    return state.viralHistory || [];
                case 'monetization':
                    return state.monetizationHistory || [];
                case 'script':
                    return state.scriptHistory || [];
                default:
                    // Filter allHistory to only show enterprise tool types
                    return (state.allHistory || []).filter(function(item) {
                        return ['placement', 'viral', 'monetization', 'script'].indexOf(item.type) !== -1;
                    });
            }
        }

        // Render individual history item
        function renderHistoryItem(item) {
            var html = '<div class="history-item p-4 bg-white/5 rounded-lg border border-white/10 hover:border-white/20 hover:bg-white/8 transition-all cursor-pointer" onclick="app.viewHistoryItem(\'' + item.id + '\', \'' + item.type + '\')">';

            // Header with type badge and date
            html += '<div class="flex items-center justify-between mb-3">';
            html += '<div class="flex items-center gap-2">';

            // Type badge
            var typeInfo = getTypeInfo(item.type);
            html += '<span class="px-2 py-1 text-xs rounded-full ' + typeInfo.bgClass + '">' + typeInfo.icon + ' ' + typeInfo.name + '</span>';

            html += '</div>';
            html += '<span class="text-white/40 text-sm">' + formatDate(item.createdAt) + '</span>';
            html += '</div>';

            // Content based on type
            if (item.type === 'placement') {
                // Fix: Access nested niche from analysis or channelInfo objects
                var niche = (item.analysis && item.analysis.niche) || (item.channelInfo && item.channelInfo.niche) || item.niche || 'Unknown';
                // Fix: Use placements array (or totalFound count) instead of channels
                var channelCount = item.totalFound || (item.placements ? item.placements.length : 0) || (item.channels ? item.channels.length : 0) || 0;
                var channelName = (item.channelInfo && item.channelInfo.name) || item.channelName || '';

                html += '<h3 class="text-white font-medium mb-2">' + (channelName ? utils.escapeHtml(channelName) : 'Niche: ' + utils.escapeHtml(niche)) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + channelCount + ' channels found</p>';
            } else if (item.type === 'viral') {
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(item.title || 'Untitled') + '</h3>';
                html += '<p class="text-white/60 text-sm">Viral Score: ' + (item.viralScore || 0) + '/100</p>';
            } else if (item.type === 'monetization') {
                // Fix: Access nested channel name from channelInfo
                var channelTitle = item.channelTitle || item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel Analysis';
                // Fix: Access earnings data from various possible field names
                var revenue = item.estimatedRevenue || item.monthlyEarnings || (item.earnings && item.earnings.monthly) || 'N/A';
                if (typeof revenue === 'number') revenue = '$' + revenue.toLocaleString();

                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelTitle) + '</h3>';
                html += '<p class="text-white/60 text-sm">Est. Monthly: ' + revenue + '</p>';
            } else if (item.type === 'script') {
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(item.title || item.topic || 'Script') + '</h3>';
                html += '<p class="text-white/60 text-sm">' + (item.wordCount || 0) + ' words â€¢ ' + (item.style || 'engaging') + ' style</p>';
            } else if (item.type === 'sponsorship') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var integrationRate = (item.rates && item.rates.integration) || 'N/A';
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">Integration Rate: ' + utils.escapeHtml(integrationRate) + '</p>';
            } else if (item.type === 'diversification') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var score = item.diversificationScore || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">Diversification Score: ' + score + '%</p>';
            } else if (item.type === 'cpmbooster') {
                var currentCPM = item.currentCPM || '$0';
                var potentialCPM = item.potentialCPM || '$0';
                html += '<h3 class="text-white font-medium mb-2">CPM Analysis</h3>';
                html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(currentCPM) + ' â†’ ' + utils.escapeHtml(potentialCPM) + ' potential</p>';
            } else if (item.type === 'audienceprofile') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var segmentCount = (item.segments && item.segments.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + segmentCount + ' audience segments identified</p>';
            } else if (item.type === 'digitalproduct') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var productCount = (item.productIdeas && item.productIdeas.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + productCount + ' product ideas generated</p>';
            } else if (item.type === 'affiliate') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var programCount = (item.affiliatePrograms && item.affiliatePrograms.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + programCount + ' affiliate programs found</p>';
            } else if (item.type === 'multiincome') {
                var videoTitle = item.videoTitle || item.title || 'Video Analysis';
                var pieceCount = (item.contentPieces && item.contentPieces.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(videoTitle) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + pieceCount + ' content pieces identified</p>';
            } else if (item.type === 'branddeal') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var brandCount = (item.matchedBrands && item.matchedBrands.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + brandCount + ' brand partners matched</p>';
            } else if (item.type === 'licensing') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var oppCount = (item.opportunities && item.opportunities.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + oppCount + ' licensing opportunities found</p>';
            } else if (item.type === 'automation') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var automationScore = item.automationScore || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">Automation potential: ' + automationScore + '%</p>';
            }

            html += '</div>';
            return html;
        }

        // Get type info for badges
        function getTypeInfo(type) {
            var types = {
                'placement': { icon: 'ðŸ“', name: 'Placement', bgClass: 'bg-purple-500/20 text-purple-300' },
                'viral': { icon: 'ðŸ“ˆ', name: 'Viral Score', bgClass: 'bg-orange-500/20 text-orange-300' },
                'monetization': { icon: 'ðŸ’°', name: 'Monetization', bgClass: 'bg-green-500/20 text-green-300' },
                'script': { icon: 'ðŸ“', name: 'Script', bgClass: 'bg-blue-500/20 text-blue-300' },
                'sponsorship': { icon: 'ðŸ’Ž', name: 'Sponsorship', bgClass: 'bg-pink-500/20 text-pink-300' },
                'diversification': { icon: 'ðŸ“Š', name: 'Revenue Diversify', bgClass: 'bg-cyan-500/20 text-cyan-300' },
                'cpmbooster': { icon: 'ðŸ’°', name: 'CPM Booster', bgClass: 'bg-emerald-500/20 text-emerald-300' },
                'audienceprofile': { icon: 'ðŸ“±', name: 'Audience Profile', bgClass: 'bg-red-500/20 text-red-300' },
                'digitalproduct': { icon: 'ðŸ›’', name: 'Product Architect', bgClass: 'bg-violet-500/20 text-violet-300' },
                'affiliate': { icon: 'ðŸ“ˆ', name: 'Affiliate Finder', bgClass: 'bg-amber-500/20 text-amber-300' },
                'multiincome': { icon: 'ðŸŽ¬', name: 'Multi-Income', bgClass: 'bg-indigo-500/20 text-indigo-300' },
                'branddeal': { icon: 'ðŸ¤', name: 'Brand Deals', bgClass: 'bg-pink-500/20 text-pink-300' },
                'licensing': { icon: 'ðŸ“œ', name: 'Licensing', bgClass: 'bg-teal-500/20 text-teal-300' },
                'automation': { icon: 'âš™ï¸', name: 'Automation', bgClass: 'bg-orange-500/20 text-orange-300' }
            };
            return types[type] || { icon: 'ðŸ“‹', name: type, bgClass: 'bg-gray-500/20 text-gray-300' };
        }

        // Format date
        function formatDate(dateStr) {
            if (!dateStr) return 'Unknown date';
            var date = new Date(dateStr);
            var now = new Date();
            var diffMs = now - date;
            var diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return diffDays + ' days ago';

            return date.toLocaleDateString();
        }

        /* ==========================================
           4.7 AUTHENTICATION & INITIALIZATION
           ========================================== */

        // Notification listener reference
        var notificationUnsubscribe = null;

        // Check user access
        function checkAccess() {
            auth.onAuthStateChanged(function(user) {
                if (!user) {
                    // Cleanup notification listener
                    if (notificationUnsubscribe) {
                        notificationUnsubscribe();
                        notificationUnsubscribe = null;
                    }
                    // Not logged in - redirect to dashboard
                    window.location.href = 'https://ytseo.siteuo.com/video-optimizer';
                    return;
                }

                state.user = user;

                // Setup real-time notification listener
                var db = firebase.firestore();
                if (notificationUnsubscribe) notificationUnsubscribe();
                notificationUnsubscribe = db.collection('userNotifications')
                    .where('userId', '==', user.uid)
                    .where('isRead', '==', false)
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .onSnapshot(function(snapshot) {
                        state.notifications = [];
                        state.unreadCount = 0;
                        snapshot.forEach(function(doc) {
                            state.notifications.push({ id: doc.id, ...doc.data() });
                            state.unreadCount++;
                        });
                        render();
                    }, function(error) {
                        console.error('Notification listener error:', error);
                    });

                // Get user profile to check plan
                db.collection('users').doc(user.uid).get()
                    .then(function(doc) {
                        if (doc.exists) {
                            state.profile = doc.data();
                            // Get plan from subscription.plan (correct path in user document)
                            state.userPlan = doc.data().subscription?.plan || doc.data().plan || 'free';

                            // Check if user has premium access (pro or enterprise)
                            state.hasPremiumAccess = (state.userPlan === 'pro' || state.userPlan === 'enterprise');
                        } else {
                            state.hasPremiumAccess = false;
                        }
                        // Load token balance
                        app.loadTokenBalance();
                        // Always show tools view - modal will appear when they try to use features
                        state.currentView = 'tools';
                        render();
                    })
                    .catch(function(e) {
                        console.error('Error fetching profile:', e);
                        state.hasPremiumAccess = false;
                        state.currentView = 'tools';
                        render();
                    });
            });
        }

        // Check if user can use premium features, show modal if not
        function requirePremiumAccess() {
            if (!state.hasPremiumAccess) {
                state.showUpgradeModal = true;
                render();
                return false;
            }
            return true;
        }

        // Close upgrade modal
        function closeUpgradeModal() {
            state.showUpgradeModal = false;
            render();
        }

        // Load recent tools from localStorage
        function loadRecentTools() {
            try {
                var saved = localStorage.getItem('enterprise_recent_tools');
                if (saved) {
                    state.recentTools = JSON.parse(saved);
                }
            } catch (e) {}
        }

        // Set up keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // âŒ˜K or Ctrl+K to open command palette
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    if (state.showCommandPalette) {
                        app.closeCommandPalette();
                    } else {
                        app.openCommandPalette();
                    }
                    return;
                }

                // ESC to close command palette
                if (e.key === 'Escape' && state.showCommandPalette) {
                    e.preventDefault();
                    app.closeCommandPalette();
                    return;
                }

                // Enter to select first matching tool when in command palette
                if (e.key === 'Enter' && state.showCommandPalette) {
                    e.preventDefault();
                    var allTools = getAllToolsData();
                    var query = (state.commandSearchQuery || '').toLowerCase();
                    var filtered = allTools.filter(function(tool) {
                        if (!query) return true;
                        return tool.name.toLowerCase().indexOf(query) !== -1 ||
                               tool.desc.toLowerCase().indexOf(query) !== -1;
                    });
                    if (filtered.length > 0) {
                        app.selectTool(filtered[0].key);
                    }
                    return;
                }
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved recent tools
            loadRecentTools();

            // Set initial state to show dashboard
            state.activeTool = null;
            state.toolViewMode = 'dashboard';

            // Set up keyboard shortcuts
            setupKeyboardShortcuts();

            render();
            checkAccess();
        });
    </script>

    <!-- PWA Install Button -->
    <button class="a2hs-native-button" id="a2hsNativeBtn"><span class="a2hs-icon">ðŸ“±</span><span>Install App</span></button>
    <script>
    // Service Worker Registration (Inline - no external file needed)
    if ('serviceWorker' in navigator) {
        const swCode = `const CACHE_NAME = 'yt-optimizer-v1';
            self.addEventListener('install', (event) => { self.skipWaiting(); });
            self.addEventListener('activate', (event) => { event.waitUntil(caches.keys().then((cacheNames) => Promise.all(cacheNames.map((cache) => { if (cache !== CACHE_NAME) return caches.delete(cache); })))); return self.clients.claim(); });
            self.addEventListener('fetch', (event) => { if (event.request.method !== 'GET' || event.request.url.startsWith('chrome-extension://')) return; event.respondWith(fetch(event.request).then((response) => { const responseClone = response.clone(); caches.open(CACHE_NAME).then((cache) => { cache.put(event.request, responseClone); }); return response; }).catch(() => caches.match(event.request))); });`;
        const blob = new Blob([swCode], { type: 'application/javascript' });
        navigator.serviceWorker.register(URL.createObjectURL(blob), { scope: '/' }).catch(function(err) {
            navigator.serviceWorker.register('/sw.js').catch(function(e) { console.log('SW failed:', e); });
        });
    }
    (function() {
        let deferredPrompt = null; const button = document.getElementById('a2hsNativeBtn');
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) return;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; button.classList.add('show'); });
        button.addEventListener('click', async () => { if (!deferredPrompt) return; try { await deferredPrompt.prompt(); const r = await deferredPrompt.userChoice; if (r.outcome === 'accepted') button.classList.remove('show'); deferredPrompt = null; } catch (e) {} });
        window.addEventListener('appinstalled', () => { button.classList.remove('show'); });
    })();
    </script>
</body>
</html>
