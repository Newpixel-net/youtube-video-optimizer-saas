<!-- ================================================================
     YOUTUBE VIDEO OPTIMIZER - ENTERPRISE SUITE
     ================================================================

     Structure:
     - SECTION 1: External Dependencies (CDN)
     - SECTION 2: Styles (CSS)
     - SECTION 3: HTML Container
     - SECTION 4: Scripts (JavaScript)

     Tools: Bulk Video Optimizer, Placement Finder, Viral Score Predictor,
            Monetization Analyzer, Script Writer Pro

     Access: PRO & Enterprise plans only

     Main Dashboard URL: https://ytseo.siteuo.com/video-optimizer

     Last Updated: 2024
     ================================================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Enterprise Suite - YouTube Video Optimizer</title>

    <!-- ============================================
         SECTION 1: EXTERNAL DEPENDENCIES
         ============================================ -->

    <!-- 1.1 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1.2 Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>

    <!-- 1.3 PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- ============================================
         SECTION 2: STYLES
         ============================================ -->
    <style>
        /* ------------------------------------------
           2.1 BASE & RESET
           ------------------------------------------ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app-root {
            width: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        /* ------------------------------------------
           2.2 ANIMATIONS
           ------------------------------------------ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }

        /* ------------------------------------------
           2.3 PREMIUM GOLD STYLING
           ------------------------------------------ */
        .gold-gradient {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 50%, #f5af19 100%);
        }

        .gold-text {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gold-border {
            border: 2px solid transparent;
            background: linear-gradient(#1a1a2e, #1a1a2e) padding-box,
                        linear-gradient(135deg, #ffd700, #ff8c00, #ffd700) border-box;
        }

        .premium-card {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 140, 0, 0.05) 100%);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .premium-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 140, 0, 0.1) 100%);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        /* ------------------------------------------
           2.4 NAVIGATION TABS
           ------------------------------------------ */
        .tool-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
            margin-bottom: 1.5rem;
        }

        .tool-tab {
            flex: 1;
            min-width: 140px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tool-tab:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        .tool-tab.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 140, 0, 0.15) 100%);
            border-color: #ffd700;
            color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .tool-tab-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .tool-tab-name {
            font-size: 0.85rem;
        }

        /* ------------------------------------------
           2.5 BUTTONS
           ------------------------------------------ */
        .btn-primary {
            padding: 0.875rem 1.75rem;
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #1a1a2e;
            font-weight: 700;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            padding: 0.875rem 1.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* History tab buttons */
        .tab-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .tab-btn.active {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        /* History item hover effect */
        .history-item:hover {
            transform: translateY(-2px);
        }

        /* ------------------------------------------
           2.6 FORM INPUTS
           ------------------------------------------ */
        .input-field {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea.input-field {
            resize: vertical;
            min-height: 120px;
        }

        /* ------------------------------------------
           2.7 LOCKED OVERLAY
           ------------------------------------------ */
        .locked-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .locked-card {
            background: linear-gradient(145deg, #1e1e3f 0%, #0f0f23 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 1.5rem;
            padding: 3rem;
            max-width: 500px;
            text-align: center;
        }

        .locked-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Upgrade Modal Popup */
        .upgrade-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .upgrade-modal {
            background: linear-gradient(145deg, #1e1e3f 0%, #0f0f23 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.1);
        }

        .upgrade-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 2rem;
            height: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* ------------------------------------------
           2.8 RESULTS & CARDS
           ------------------------------------------ */
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .score-high {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .score-medium {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .score-low {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ------------------------------------------
           2.9 PROGRESS BAR
           ------------------------------------------ */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700 0%, #ff8c00 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* ------------------------------------------
           2.9b PDF DOWNLOAD BUTTON
           ------------------------------------------ */
        .btn-pdf {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            border: none;
            border-radius: 0.625rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-pdf:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }

        .btn-pdf:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ------------------------------------------
           2.10 LOADING STATES
           ------------------------------------------ */
        .loading-emoji {
            display: inline-block;
            font-size: 2rem;
            animation: float 1.5s ease-in-out infinite;
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 0.5rem;
        }

        /* ------------------------------------------
           2.11 TABLES
           ------------------------------------------ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 1rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: white;
        }

        .data-table tr:hover td {
            background: rgba(255, 215, 0, 0.05);
        }

        /* ------------------------------------------
           2.12 TOAST NOTIFICATIONS
           ------------------------------------------ */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            z-index: 200;
            animation: fadeIn 0.3s ease;
        }

        .toast-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* ------------------------------------------
           2.13 RESPONSIVE
           ------------------------------------------ */
        @media (max-width: 768px) {
            .tool-tabs {
                flex-direction: column;
            }

            .tool-tab {
                min-width: 100%;
            }

            .tool-tab-icon {
                display: inline;
                margin-right: 0.5rem;
                margin-bottom: 0;
            }

            .tool-tab-name {
                display: inline;
            }
        }

        /* ------------------------------------------
           2.14 VIRAL TIPS ACCORDION
           ------------------------------------------ */
        .tip-accordion {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .tip-header {
            padding: 1rem 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .tip-header:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .tip-content {
            padding: 0 1.25rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.7;
        }

        /* ------------------------------------------
           2.15 MONETIZATION CARDS
           ------------------------------------------ */
        .earning-card {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
        }

        .earning-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: #22c55e;
        }

        /* ------------------------------------------
           2.16 SCRIPT OUTPUT
           ------------------------------------------ */
        .script-output {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1.5rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            white-space: pre-wrap;
            color: rgba(255, 255, 255, 0.9);
            max-height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- ============================================
         SECTION 3: HTML CONTAINER
         ============================================ -->
    <div id="app-root"></div>

    <!-- ============================================
         SECTION 4: SCRIPTS
         ============================================ -->
    <script>
        /* ==========================================
           4.0 PLATFORM VERSION
           ========================================== */
        const PLATFORM_VERSION = '1.0.1';

        /* ==========================================
           4.1 FIREBASE CONFIGURATION
           ========================================== */
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAGczY5ZEIJdTq25BpQdia3lv2I556wOZo",
            authDomain: "ytseo-6d1b0.firebaseapp.com",
            projectId: "ytseo-6d1b0",
            storageBucket: "ytseo-6d1b0.firebasestorage.app",
            messagingSenderId: "382790048044",
            appId: "1:382790048044:web:cd427679ff72108c1f3489"
        };

        // Initialize Firebase
        firebase.initializeApp(FIREBASE_CONFIG);
        const auth = firebase.auth();
        const functions = firebase.functions();

        /* ==========================================
           4.2 APPLICATION STATE
           ========================================== */
        const state = {
            // Current state
            currentView: 'loading', // loading | locked | tools | history
            activeTool: 'bulk', // bulk | placement | viral | monetization | script

            // User data
            user: null,
            profile: null,
            userPlan: null, // free | lite | pro | enterprise
            hasPremiumAccess: false, // true if pro or enterprise
            showUpgradeModal: false, // show upgrade popup

            // UI state
            loading: false,
            error: null,
            success: null,

            // Loading progress
            loadingProgress: 0,
            loadingStep: 0,
            loadingSteps: [],
            loadingInterval: null,

            // Tool-specific state
            // Bulk Optimizer
            bulkVideos: [],
            bulkResults: null,
            bulkProcessing: false,
            bulkProgress: 0,

            // Placement Finder
            placementResults: null,
            placementLoading: false,
            copySuccess: null,

            // Viral Score Predictor
            viralResults: null,
            viralLoading: false,

            // Monetization Analyzer
            monetizationResults: null,
            monetizationLoading: false,

            // Script Writer
            scriptResults: null,
            scriptLoading: false,
            scriptStyle: 'engaging', // engaging | educational | storytelling | listicle

            // Sponsorship Rate Calculator
            sponsorshipResults: null,
            sponsorshipLoading: false,

            // Revenue Diversification Analyzer
            diversificationResults: null,
            diversificationLoading: false,

            // CPM Booster Strategist
            cpmBoosterResults: null,
            cpmBoosterLoading: false,

            // Audience Monetization Profiler
            audienceProfileResults: null,
            audienceProfileLoading: false,

            // History state
            historyTab: 'all', // all | placement | viral | monetization | script | sponsorship | diversification | cpmbooster | audienceprofile
            allHistory: null,
            placementHistory: null,
            viralHistory: null,
            monetizationHistory: null,
            scriptHistory: null,
            sponsorshipHistory: null,
            diversificationHistory: null,
            cpmBoosterHistory: null,
            audienceProfileHistory: null,
            historyCounts: null
        };

        /* ==========================================
           4.3 UTILITY FUNCTIONS
           ========================================== */
        const utils = {
            escapeHtml: function(text) {
                if (!text) return '';
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            formatNumber: function(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            },

            formatCurrency: function(amount) {
                return '$' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            },

            // Show notification toast
            showNotification: function(message, type) {
                type = type || 'info';
                var existingToast = document.querySelector('.pdf-toast');
                if (existingToast) existingToast.remove();

                var toast = document.createElement('div');
                toast.className = 'pdf-toast';
                toast.style.cssText = 'position:fixed;top:1rem;right:1rem;padding:1rem 1.5rem;border-radius:0.75rem;font-weight:600;z-index:9999;animation:fadeIn 0.3s ease;max-width:350px;';

                if (type === 'success') {
                    toast.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                } else if (type === 'error') {
                    toast.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                } else {
                    toast.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                }
                toast.style.color = 'white';
                toast.textContent = message;

                document.body.appendChild(toast);
                setTimeout(function() {
                    if (toast.parentNode) toast.remove();
                }, 4000);
            }
        };

        /* ==========================================
           4.4 LOADING PROGRESS
           ========================================== */
        function startLoadingProgress() {
            state.loadingProgress = 0;
            state.loadingStep = 0;

            var stepDuration = 15000 / state.loadingSteps.length;
            var progressPerStep = 100 / state.loadingSteps.length;

            state.loadingInterval = setInterval(function() {
                state.loadingProgress += 0.5;

                var newStep = Math.floor(state.loadingProgress / progressPerStep);
                var stepChanged = false;
                if (newStep > state.loadingStep && newStep < state.loadingSteps.length) {
                    state.loadingStep = newStep;
                    stepChanged = true;
                }

                if (state.loadingProgress >= 95) {
                    state.loadingProgress = 95;
                }

                // OPTIMIZATION: Targeted DOM update instead of full render
                // This prevents page shaking by only updating progress elements
                updateProgressDisplay(stepChanged);
            }, 150);
        }

        // Targeted progress update to prevent page shaking
        function updateProgressDisplay(stepChanged) {
            var progressPercent = document.getElementById('progress-percent');
            var progressFill = document.getElementById('progress-fill');

            if (progressPercent) {
                progressPercent.textContent = Math.round(state.loadingProgress) + '%';
            }
            if (progressFill) {
                progressFill.style.width = state.loadingProgress + '%';
            }

            // Only update step indicators if step changed
            if (stepChanged) {
                var stepContainer = document.getElementById('loading-steps');
                if (stepContainer) {
                    var stepHtml = '';
                    for (var i = 0; i < state.loadingSteps.length; i++) {
                        var step = state.loadingSteps[i];
                        var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                        stepHtml += '<div class="flex items-center gap-2 ' + stepClass + '">';
                        stepHtml += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                        stepHtml += '<span class="text-sm">' + step.name + '</span>';
                        stepHtml += '</div>';
                    }
                    stepContainer.innerHTML = stepHtml;
                }
            }
        }

        function stopLoadingProgress() {
            if (state.loadingInterval) {
                clearInterval(state.loadingInterval);
                state.loadingInterval = null;
            }
            state.loadingProgress = 100;
            state.loadingStep = state.loadingSteps.length;
        }

        /* ==========================================
           4.5 APPLICATION CONTROLLER
           ========================================== */
        const app = {
            // Navigation
            goToDashboard: function() {
                window.location.href = 'https://ytseo.siteuo.com/video-optimizer';
            },

            setActiveTool: function(tool) {
                state.activeTool = tool;
                state.error = null;
                state.success = null;
                render();
            },

            goToTools: function() {
                state.currentView = 'tools';
                state.error = null;
                render();
            },

            // History Navigation
            goToHistory: function(tab) {
                state.currentView = 'history';
                state.error = null;
                state.loading = true;
                state.historyTab = tab || 'all';
                state.allHistory = null;
                state.placementHistory = null;
                state.viralHistory = null;
                state.monetizationHistory = null;
                state.scriptHistory = null;
                state.historyCounts = null;
                render();

                // Fetch history from backend
                functions.httpsCallable('getAllHistory')({ limit: 20 })
                    .then(function(result) {
                        var data = result.data;
                        state.allHistory = data.history.all || [];
                        state.placementHistory = data.history.placements || [];
                        state.viralHistory = data.history.viral || [];
                        state.monetizationHistory = data.history.monetization || [];
                        state.scriptHistory = data.history.scripts || [];
                        state.historyCounts = data.counts || {};
                        state.loading = false;
                        render();
                    })
                    .catch(function(e) {
                        console.error('Failed to load history:', e);
                        state.loading = false;
                        state.error = 'Failed to load history';
                        render();
                    });
            },

            setHistoryTab: function(tab) {
                state.historyTab = tab;
                render();
            },

            // View history item details
            viewHistoryItem: function(id, type) {
                // Find the item from the appropriate history array
                var item = null;
                var allItems = [];

                // Combine all history arrays to search
                if (state.allHistory) allItems = allItems.concat(state.allHistory);
                if (state.placementHistory) allItems = allItems.concat(state.placementHistory);
                if (state.viralHistory) allItems = allItems.concat(state.viralHistory);
                if (state.monetizationHistory) allItems = allItems.concat(state.monetizationHistory);
                if (state.scriptHistory) allItems = allItems.concat(state.scriptHistory);
                if (state.sponsorshipHistory) allItems = allItems.concat(state.sponsorshipHistory);
                if (state.diversificationHistory) allItems = allItems.concat(state.diversificationHistory);
                if (state.cpmBoosterHistory) allItems = allItems.concat(state.cpmBoosterHistory);
                if (state.audienceProfileHistory) allItems = allItems.concat(state.audienceProfileHistory);

                // Find the item by ID
                for (var i = 0; i < allItems.length; i++) {
                    if (allItems[i].id === id) {
                        item = allItems[i];
                        break;
                    }
                }

                if (!item) {
                    state.error = 'Could not find the history item';
                    render();
                    return;
                }

                // Set the results based on type and navigate to the tool
                state.currentView = 'tools';
                state.error = null;

                if (type === 'placement') {
                    // Map history item to placementResults format
                    state.placementResults = {
                        placements: item.placements || [],
                        channelInfo: item.channelInfo || {},
                        analysis: item.analysis || {},
                        totalFound: item.totalFound || (item.placements ? item.placements.length : 0),
                        historyId: item.id
                    };
                    state.activeTool = 'placement';
                } else if (type === 'viral') {
                    // Map history item to viralResults format
                    state.viralResults = {
                        viralScore: item.viralScore || item.score || 0,
                        verdict: item.verdict || item.summary || '',
                        factors: item.factors || item.breakdown || [],
                        title: item.title || '',
                        suggestions: item.suggestions || item.improvements || []
                    };
                    state.activeTool = 'viral';
                } else if (type === 'monetization') {
                    // Map history item to monetizationResults format
                    state.monetizationResults = {
                        channelName: item.channelName || item.channelTitle || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        estimatedRevenue: item.estimatedRevenue || item.monthlyEarnings || 0,
                        yearlyRevenue: item.yearlyRevenue || item.annualEarnings || 0,
                        cpm: item.cpm || item.estimatedCPM || 0,
                        breakdown: item.breakdown || item.revenueBreakdown || [],
                        recommendations: item.recommendations || item.suggestions || []
                    };
                    state.activeTool = 'monetization';
                } else if (type === 'script') {
                    // Map history item to scriptResults format
                    state.scriptResults = {
                        title: item.title || item.topic || 'Script',
                        script: item.script || item.content || '',
                        wordCount: item.wordCount || 0,
                        estimatedDuration: item.estimatedDuration || item.duration || '',
                        style: item.style || 'engaging'
                    };
                    state.activeTool = 'script';
                } else if (type === 'sponsorship') {
                    // Map history item to sponsorshipResults format
                    state.sponsorshipResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        niche: item.niche || '',
                        rates: item.rates || {},
                        comparison: item.comparison || {},
                        negotiationTips: item.negotiationTips || []
                    };
                    state.activeTool = 'sponsorship';
                } else if (type === 'diversification') {
                    // Map history item to diversificationResults format
                    state.diversificationResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        diversificationScore: item.diversificationScore || 0,
                        currentSources: item.currentSources || [],
                        missingRevenue: item.missingRevenue || '$0',
                        recommendations: item.recommendations || [],
                        actionPlan: item.actionPlan || []
                    };
                    state.activeTool = 'diversification';
                } else if (type === 'cpmbooster') {
                    // Map history item to cpmBoosterResults format
                    state.cpmBoosterResults = {
                        currentCPM: item.currentCPM || '$0',
                        potentialCPM: item.potentialCPM || '$0',
                        cpmIncrease: item.cpmIncrease || '0%',
                        highCpmKeywords: item.highCpmKeywords || [],
                        topicIdeas: item.topicIdeas || [],
                        optimalLength: item.optimalLength || '',
                        lengthReason: item.lengthReason || '',
                        contentCalendar: item.contentCalendar || []
                    };
                    state.activeTool = 'cpmbooster';
                } else if (type === 'audienceprofile') {
                    // Map history item to audienceProfileResults format
                    state.audienceProfileResults = {
                        channelName: item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel',
                        channelThumbnail: item.channelThumbnail || (item.channelInfo && item.channelInfo.thumbnail) || '',
                        subscribers: item.subscribers || (item.channelInfo && item.channelInfo.subscribers) || 0,
                        segments: item.segments || [],
                        productRecommendations: item.productRecommendations || [],
                        contentRecommendations: item.contentRecommendations || [],
                        targetedOffers: item.targetedOffers || []
                    };
                    state.activeTool = 'audienceprofile';
                }

                render();
            },

            // ==========================================
            // BULK VIDEO OPTIMIZER
            // ==========================================
            parseBulkInput: function() {
                var input = document.getElementById('bulk-input').value.trim();
                if (!input) {
                    state.error = 'Please enter video URLs or paste CSV data';
                    render();
                    return;
                }

                var videos = [];
                var lines = input.split('\n');

                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i].trim();
                    if (!line) continue;

                    // Check if it's a YouTube URL
                    var videoId = null;
                    if (line.includes('youtube.com/watch')) {
                        var match = line.match(/[?&]v=([^&]+)/);
                        if (match) videoId = match[1];
                    } else if (line.includes('youtu.be/')) {
                        var match = line.match(/youtu\.be\/([^?&]+)/);
                        if (match) videoId = match[1];
                    }

                    if (videoId) {
                        videos.push({
                            id: videoId,
                            url: 'https://youtube.com/watch?v=' + videoId,
                            status: 'pending'
                        });
                    }
                }

                if (videos.length === 0) {
                    state.error = 'No valid YouTube URLs found. Please check your input.';
                    render();
                    return;
                }

                state.bulkVideos = videos;
                state.error = null;
                render();
            },

            clearBulkVideos: function() {
                state.bulkVideos = [];
                state.bulkResults = null;
                state.bulkProgress = 0;
                render();
            },

            runBulkOptimization: function() {
                if (!requirePremiumAccess()) return;
                if (state.bulkVideos.length === 0) return;

                state.bulkProcessing = true;
                state.bulkProgress = 0;
                state.bulkResults = [];
                render();

                var total = state.bulkVideos.length;
                var processed = 0;

                // Process videos sequentially
                function processNext(index) {
                    if (index >= state.bulkVideos.length) {
                        state.bulkProcessing = false;
                        state.success = 'Bulk optimization complete! Processed ' + total + ' videos.';
                        render();
                        return;
                    }

                    var video = state.bulkVideos[index];
                    video.status = 'processing';
                    render();

                    functions.httpsCallable('optimizeVideo')({ videoUrl: video.url })
                        .then(function(result) {
                            video.status = 'complete';
                            video.result = result.data;
                            state.bulkResults.push({
                                videoId: video.id,
                                url: video.url,
                                titles: result.data.titles || [],
                                seoScore: result.data.seoScore || 0
                            });
                            processed++;
                            state.bulkProgress = (processed / total) * 100;
                            render();
                            processNext(index + 1);
                        })
                        .catch(function(e) {
                            video.status = 'error';
                            video.error = e.message;
                            processed++;
                            state.bulkProgress = (processed / total) * 100;
                            render();
                            processNext(index + 1);
                        });
                }

                processNext(0);
            },

            // ==========================================
            // PLACEMENT FINDER
            // ==========================================
            findPlacements: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('placement-channel-url').value.trim();

                if (!channelUrl) {
                    state.error = 'Please enter your YouTube channel URL';
                    render();
                    return;
                }

                state.placementLoading = true;
                state.loading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Analyzing your channel', icon: 'üì∫' },
                    { name: 'Understanding your content', icon: 'üîç' },
                    { name: 'Identifying your niche', icon: 'üéØ' },
                    { name: 'Searching similar channels', icon: 'üîé' },
                    { name: 'Scoring relevance', icon: 'üìä' },
                    { name: 'Compiling results', icon: '‚ú®' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('findPlacements')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.placementResults = result.data;
                        state.placementLoading = false;
                        state.loading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.placementLoading = false;
                        state.loading = false;
                        state.error = 'Failed to find placements: ' + e.message;
                        render();
                    });
            },

            findMorePlacements: function() {
                if (!state.placementResults || !state.placementResults.historyId) return;

                state.placementLoading = true;
                render();

                functions.httpsCallable('findMorePlacements')({ historyId: state.placementResults.historyId })
                    .then(function(result) {
                        state.placementResults.placements = result.data.placements;
                        state.placementResults.totalFound = result.data.totalFound;
                        state.placementLoading = false;
                        if (result.data.added === 0) {
                            state.error = 'No more channels found matching your criteria.';
                        }
                        render();
                    })
                    .catch(function(e) {
                        state.placementLoading = false;
                        state.error = 'Failed to find more: ' + e.message;
                        render();
                    });
            },

            copyAllPlacements: function() {
                if (!state.placementResults || !state.placementResults.placements) return;

                var urls = state.placementResults.placements.map(function(p) {
                    return p.channelUrl;
                }).join('\n');

                navigator.clipboard.writeText(urls).then(function() {
                    state.copySuccess = 'Copied ' + state.placementResults.placements.length + ' channel URLs!';
                    render();
                    setTimeout(function() {
                        state.copySuccess = null;
                        render();
                    }, 3000);
                }).catch(function(err) {
                    state.error = 'Failed to copy: ' + err.message;
                    render();
                });
            },

            copySinglePlacement: function(url) {
                navigator.clipboard.writeText(url).then(function() {
                    state.copySuccess = 'Channel URL copied!';
                    render();
                    setTimeout(function() {
                        state.copySuccess = null;
                        render();
                    }, 2000);
                }).catch(function(err) {
                    state.error = 'Failed to copy: ' + err.message;
                    render();
                });
            },

            resetPlacements: function() {
                state.placementResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // VIRAL SCORE PREDICTOR
            // ==========================================
            predictViralScore: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var title = document.getElementById('viral-title').value.trim();
                var description = document.getElementById('viral-description').value.trim();
                var tags = document.getElementById('viral-tags').value.trim();

                if (!title) {
                    state.error = 'Please enter a video title';
                    render();
                    return;
                }

                state.viralLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Analyzing title appeal', icon: 'üìù' },
                    { name: 'Checking trending patterns', icon: 'üìà' },
                    { name: 'Evaluating engagement potential', icon: 'üí¨' },
                    { name: 'Calculating viral score', icon: 'üî•' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('predictViralScore')({
                    title: title,
                    description: description,
                    tags: tags
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.viralResults = result.data;
                        state.viralLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.viralLoading = false;
                        state.error = 'Failed to predict viral score: ' + e.message;
                        render();
                    });
            },

            resetViralPredictor: function() {
                state.viralResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // MONETIZATION ANALYZER
            // ==========================================
            analyzeMonetization: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('monetization-channel').value.trim();

                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.monetizationLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'üì∫' },
                    { name: 'Analyzing view patterns', icon: 'üëÅÔ∏è' },
                    { name: 'Calculating CPM estimates', icon: 'üí∞' },
                    { name: 'Generating revenue report', icon: 'üìä' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeMonetization')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.monetizationResults = result.data;
                        state.monetizationLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.monetizationLoading = false;
                        state.error = 'Failed to analyze monetization: ' + e.message;
                        render();
                    });
            },

            resetMonetization: function() {
                state.monetizationResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // SCRIPT WRITER PRO
            // ==========================================
            setScriptStyle: function(style) {
                state.scriptStyle = style;
                render();
            },

            generateScript: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var topic = document.getElementById('script-topic').value.trim();
                var duration = document.getElementById('script-duration').value;
                var keywords = document.getElementById('script-keywords').value.trim();

                if (!topic) {
                    state.error = 'Please enter a video topic';
                    render();
                    return;
                }

                state.scriptLoading = true;
                state.error = null;
                state.loadingSteps = [
                    { name: 'Researching topic', icon: 'üîç' },
                    { name: 'Structuring content', icon: 'üìã' },
                    { name: 'Writing hook', icon: 'üé£' },
                    { name: 'Generating script', icon: '‚úçÔ∏è' },
                    { name: 'Adding engagement points', icon: 'üí°' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('generateScript')({
                    topic: topic,
                    duration: duration,
                    style: state.scriptStyle,
                    keywords: keywords
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.scriptResults = result.data;
                        state.scriptLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.scriptLoading = false;
                        state.error = 'Failed to generate script: ' + e.message;
                        render();
                    });
            },

            copyScript: function() {
                if (!state.scriptResults || !state.scriptResults.script) return;

                navigator.clipboard.writeText(state.scriptResults.script).then(function() {
                    state.success = 'Script copied to clipboard!';
                    render();
                    setTimeout(function() {
                        state.success = null;
                        render();
                    }, 3000);
                });
            },

            resetScript: function() {
                state.scriptResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // SPONSORSHIP RATE CALCULATOR
            // ==========================================
            calculateSponsorship: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('sponsorship-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.sponsorshipLoading = true;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'üì∫' },
                    { name: 'Analyzing engagement', icon: 'üìä' },
                    { name: 'Determining niche CPM', icon: 'üí∞' },
                    { name: 'Calculating rates', icon: 'üíé' },
                    { name: 'Industry comparison', icon: 'üìà' },
                    { name: 'Generating tips', icon: 'üéØ' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('calculateSponsorshipRates')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.sponsorshipResults = result.data;
                        state.sponsorshipLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.sponsorshipLoading = false;
                        state.error = 'Error calculating rates: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetSponsorship: function() {
                state.sponsorshipResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // REVENUE DIVERSIFICATION ANALYZER
            // ==========================================
            analyzeDiversification: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('diversification-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                // Gather current revenue sources
                var currentSources = [];
                if (document.getElementById('rev-adsense') && document.getElementById('rev-adsense').checked) currentSources.push('adsense');
                if (document.getElementById('rev-sponsors') && document.getElementById('rev-sponsors').checked) currentSources.push('sponsors');
                if (document.getElementById('rev-merch') && document.getElementById('rev-merch').checked) currentSources.push('merch');
                if (document.getElementById('rev-courses') && document.getElementById('rev-courses').checked) currentSources.push('courses');
                if (document.getElementById('rev-affiliate') && document.getElementById('rev-affiliate').checked) currentSources.push('affiliate');
                if (document.getElementById('rev-memberships') && document.getElementById('rev-memberships').checked) currentSources.push('memberships');

                state.diversificationLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing channel', icon: 'üì∫' },
                    { name: 'Auditing revenue', icon: 'üí∞' },
                    { name: 'Identifying gaps', icon: 'üîç' },
                    { name: 'Calculating potential', icon: 'üìä' },
                    { name: 'Building action plan', icon: 'üìã' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeRevenueDiversification')({
                    channelUrl: channelUrl,
                    currentSources: currentSources
                })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.diversificationResults = result.data;
                        state.diversificationLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.diversificationLoading = false;
                        state.error = 'Error analyzing diversification: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetDiversification: function() {
                state.diversificationResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // CPM BOOSTER STRATEGIST
            // ==========================================
            analyzeCpmBooster: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('cpmbooster-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.cpmBoosterLoading = true;
                state.loadingSteps = [
                    { name: 'Analyzing niche', icon: 'üì∫' },
                    { name: 'Checking CPM trends', icon: 'üìà' },
                    { name: 'Finding high-CPM keywords', icon: 'üîë' },
                    { name: 'Generating video ideas', icon: 'üé¨' },
                    { name: 'Building calendar', icon: 'üìÖ' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeCpmBooster')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.cpmBoosterResults = result.data;
                        state.cpmBoosterLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.cpmBoosterLoading = false;
                        state.error = 'Error analyzing CPM: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetCpmBooster: function() {
                state.cpmBoosterResults = null;
                state.error = null;
                render();
            },

            // ==========================================
            // AUDIENCE MONETIZATION PROFILER
            // ==========================================
            analyzeAudienceProfile: function(e) {
                e.preventDefault();
                if (!requirePremiumAccess()) return;

                var channelUrl = document.getElementById('audienceprofile-channel-url').value.trim();
                if (!channelUrl) {
                    state.error = 'Please enter a YouTube channel URL';
                    render();
                    return;
                }

                state.audienceProfileLoading = true;
                state.loadingSteps = [
                    { name: 'Fetching channel data', icon: 'üì∫' },
                    { name: 'Analyzing demographics', icon: 'üë•' },
                    { name: 'Profiling segments', icon: 'üìä' },
                    { name: 'Finding products', icon: 'üõçÔ∏è' },
                    { name: 'Creating offers', icon: 'üí°' }
                ];
                startLoadingProgress();
                render();

                functions.httpsCallable('analyzeAudienceProfile')({ channelUrl: channelUrl })
                    .then(function(result) {
                        stopLoadingProgress();
                        state.audienceProfileResults = result.data;
                        state.audienceProfileLoading = false;
                        render();
                    })
                    .catch(function(e) {
                        stopLoadingProgress();
                        state.audienceProfileLoading = false;
                        state.error = 'Error profiling audience: ' + (e.message || 'Unknown error');
                        render();
                    });
            },

            resetAudienceProfile: function() {
                state.audienceProfileResults = null;
                state.error = null;
                render();
            },

            // PDF Download functionality
            downloadPDF: function(toolType) {
                var element = document.getElementById('pdf-content-' + toolType);
                if (!element) {
                    console.error('PDF content element not found: pdf-content-' + toolType);
                    utils.showNotification('Could not find content to export. Make sure you have generated results first.', 'error');
                    return;
                }

                // Check if libraries are loaded
                if (typeof html2canvas === 'undefined') {
                    console.error('html2canvas library not loaded');
                    utils.showNotification('PDF library not loaded. Please refresh the page.', 'error');
                    return;
                }

                // Check jsPDF - handle different global names
                var jsPDFClass = null;
                if (typeof jspdf !== 'undefined' && jspdf.jsPDF) {
                    jsPDFClass = jspdf.jsPDF;
                } else if (typeof jsPDF !== 'undefined') {
                    jsPDFClass = jsPDF;
                } else if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
                    jsPDFClass = window.jspdf.jsPDF;
                }

                if (!jsPDFClass) {
                    console.error('jsPDF library not loaded');
                    utils.showNotification('PDF library not loaded. Please refresh the page.', 'error');
                    return;
                }

                // Show loading state
                utils.showNotification('Generating PDF...', 'info');

                // Tool names mapping
                var toolNames = {
                    bulk: 'Bulk Optimizer',
                    placement: 'Placement Finder',
                    viral: 'Viral Score Predictor',
                    monetization: 'Monetization Analyzer',
                    script: 'Script Writer Pro'
                };

                var toolName = toolNames[toolType] || 'Enterprise Report';

                // Use html2canvas to capture the content
                html2canvas(element, {
                    backgroundColor: '#0f0f1a',
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    foreignObjectRendering: false
                }).then(function(canvas) {
                    try {
                        var imgData = canvas.toDataURL('image/png');
                        var pdf = new jsPDFClass({
                            orientation: 'portrait',
                            unit: 'mm',
                            format: 'a4'
                        });

                        // Calculate dimensions
                        var pageWidth = pdf.internal.pageSize.getWidth();
                        var pageHeight = pdf.internal.pageSize.getHeight();
                        var margin = 10;
                        var contentWidth = pageWidth - (margin * 2);

                        // Add header with gold enterprise styling
                        pdf.setFillColor(15, 15, 26);
                        pdf.rect(0, 0, pageWidth, 35, 'F');

                        // Gold gradient line
                        pdf.setDrawColor(255, 215, 0);
                        pdf.setLineWidth(0.5);
                        pdf.line(margin, 32, pageWidth - margin, 32);

                        pdf.setFontSize(18);
                        pdf.setTextColor(255, 215, 0);
                        pdf.text('üëë ' + toolName + ' Report', margin, 15);

                        pdf.setFontSize(10);
                        pdf.setTextColor(156, 163, 175);
                        pdf.text('Generated on ' + new Date().toLocaleDateString(), margin, 22);
                        pdf.text('Enterprise Suite - YouTube Video Optimizer', margin, 28);

                        // Add the captured content
                        var imgWidth = contentWidth;
                        var imgHeight = (canvas.height * imgWidth) / canvas.width;
                        var yOffset = 40;

                        // Handle multi-page if needed
                        var heightLeft = imgHeight;
                        var position = yOffset;

                        pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                        heightLeft -= (pageHeight - position);

                        while (heightLeft > 0) {
                            position = heightLeft - imgHeight + 10;
                            pdf.addPage();
                            pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                            heightLeft -= pageHeight;
                        }

                        // Add footer on last page
                        pdf.setFontSize(8);
                        pdf.setTextColor(107, 114, 128);
                        pdf.text('Powered by YouTube Video Optimizer Enterprise Suite - ytseo.siteuo.com', margin, pageHeight - 10);

                        // Download the PDF
                        var filename = 'enterprise-' + toolType + '-report-' + new Date().toISOString().slice(0, 10) + '.pdf';
                        pdf.save(filename);

                        utils.showNotification('PDF downloaded successfully!', 'success');
                    } catch (pdfError) {
                        console.error('PDF creation error:', pdfError);
                        utils.showNotification('Failed to create PDF: ' + pdfError.message, 'error');
                    }
                }).catch(function(error) {
                    console.error('html2canvas error:', error);
                    utils.showNotification('Failed to capture content: ' + error.message, 'error');
                });
            }
        };

        /* ==========================================
           4.6 RENDER FUNCTIONS
           ========================================== */

        // Main render dispatcher
        function render() {
            var root = document.getElementById('app-root');

            if (state.currentView === 'loading') {
                root.innerHTML = renderLoading();
            } else if (state.currentView === 'history') {
                root.innerHTML = renderHistory() + renderUpgradeModal();
            } else {
                // Always show tools, add upgrade modal on top if needed
                root.innerHTML = renderTools() + renderUpgradeModal();
            }
        }

        // Loading view
        function renderLoading() {
            var html = '<div class="min-h-screen flex items-center justify-center">';
            html += '<div class="text-center">';
            html += '<div class="loading-emoji mb-4">üëë</div>';
            html += '<p class="text-white text-xl">Loading Enterprise Suite...</p>';
            html += '</div></div>';
            return html;
        }

        // Upgrade modal popup for non-premium users
        function renderUpgradeModal() {
            if (!state.showUpgradeModal) return '';

            var html = '<div class="upgrade-modal-overlay" onclick="closeUpgradeModal()">';
            html += '<div class="upgrade-modal fade-in" onclick="event.stopPropagation()">';
            html += '<button class="upgrade-modal-close" onclick="closeUpgradeModal()">√ó</button>';
            html += '<div class="locked-icon">üîí</div>';
            html += '<h2 class="text-2xl font-bold gold-text mb-3">Premium Feature</h2>';
            html += '<p class="text-white/70 text-base mb-5">This feature is available for <strong class="text-yellow-400">PRO</strong> and <strong class="text-yellow-400">Enterprise</strong> subscribers.</p>';
            html += '<div class="space-y-2 mb-6 text-left text-sm">';
            html += '<div class="flex items-center gap-2 text-white/60"><span>‚ú®</span> Unlimited access to all tools</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>üöÄ</span> Bulk processing capabilities</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>üìä</span> Advanced analytics & reports</div>';
            html += '<div class="flex items-center gap-2 text-white/60"><span>üí¨</span> Priority support</div>';
            html += '</div>';
            html += '<button onclick="app.goToDashboard()" class="btn-primary w-full mb-3">Upgrade to PRO</button>';
            html += '<button onclick="closeUpgradeModal()" class="btn-secondary w-full">Maybe Later</button>';
            html += '</div></div>';
            return html;
        }

        // Main tools view
        function renderTools() {
            var html = '';

            // Toast notifications
            if (state.success) {
                html += '<div class="toast toast-success">‚úÖ ' + utils.escapeHtml(state.success) + '</div>';
            }
            if (state.copySuccess) {
                html += '<div class="toast toast-success">üìã ' + utils.escapeHtml(state.copySuccess) + '</div>';
            }

            html += '<div class="min-h-screen py-8 px-4">';
            html += '<div class="max-w-6xl mx-auto">';

            // Header
            html += '<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 fade-in">';
            html += '<div class="flex items-center gap-4">';
            html += '<div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center text-4xl shadow-xl animate-glow">üëë</div>';
            html += '<div>';
            html += '<h1 class="text-3xl md:text-4xl font-bold gold-text">Enterprise Suite</h1>';
            html += '<p class="text-white/60">Premium tools for power users <span style="opacity:0.5;">v' + PLATFORM_VERSION + '</span></p>';
            html += '</div>';
            html += '</div>';
            html += '<div class="flex gap-3">';
            html += '<button onclick="app.goToHistory()" class="btn-secondary">üìú View History</button>';
            html += '<button onclick="app.goToDashboard()" class="btn-secondary">‚Üê Back to Dashboard</button>';
            html += '</div>';
            html += '</div>';

            // Tool tabs
            html += '<div class="tool-tabs fade-in">';

            var tools = [
                { key: 'bulk', icon: 'üéØ', name: 'Bulk Optimizer' },
                { key: 'placement', icon: 'üé¨', name: 'Placement Finder' },
                { key: 'viral', icon: 'üîÆ', name: 'Viral Predictor' },
                { key: 'monetization', icon: 'üí∞', name: 'Monetization' },
                { key: 'script', icon: 'üìù', name: 'Script Writer' },
                { key: 'sponsorship', icon: 'üíé', name: 'Sponsorship Rates' },
                { key: 'diversification', icon: 'üìä', name: 'Revenue Diversify' },
                { key: 'cpmbooster', icon: 'üí∞', name: 'CPM Booster' },
                { key: 'audienceprofile', icon: 'üì±', name: 'Audience Profile' }
            ];

            for (var i = 0; i < tools.length; i++) {
                var tool = tools[i];
                var isActive = state.activeTool === tool.key;
                html += '<div class="tool-tab' + (isActive ? ' active' : '') + '" onclick="app.setActiveTool(\'' + tool.key + '\')">';
                html += '<div class="tool-tab-icon">' + tool.icon + '</div>';
                html += '<div class="tool-tab-name">' + tool.name + '</div>';
                html += '</div>';
            }

            html += '</div>';

            // Error message
            if (state.error) {
                html += '<div class="mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 fade-in">';
                html += '‚ö†Ô∏è ' + utils.escapeHtml(state.error);
                html += '</div>';
            }

            // Tool content
            html += '<div class="premium-card rounded-2xl p-6 lg:p-8 fade-in">';

            if (state.activeTool === 'bulk') {
                html += renderBulkOptimizer();
            } else if (state.activeTool === 'placement') {
                html += renderPlacementFinder();
            } else if (state.activeTool === 'viral') {
                html += renderViralPredictor();
            } else if (state.activeTool === 'monetization') {
                html += renderMonetization();
            } else if (state.activeTool === 'script') {
                html += renderScriptWriter();
            } else if (state.activeTool === 'sponsorship') {
                html += renderSponsorshipCalculator();
            } else if (state.activeTool === 'diversification') {
                html += renderRevenueDiversification();
            } else if (state.activeTool === 'cpmbooster') {
                html += renderCpmBooster();
            } else if (state.activeTool === 'audienceprofile') {
                html += renderAudienceProfile();
            }

            html += '</div>';

            html += '</div></div>';
            return html;
        }

        // ==========================================
        // TOOL RENDERERS
        // ==========================================

        // Bulk Video Optimizer
        function renderBulkOptimizer() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-2xl">üéØ</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Bulk Video Optimizer</h2>';
            html += '<p class="text-white/60">Optimize multiple videos at once</p>';
            html += '</div>';
            html += '</div>';

            if (state.bulkProcessing) {
                // Processing view
                html += '<div class="mb-6">';
                html += '<div class="flex justify-between items-center mb-2">';
                html += '<span class="text-white font-medium">Processing videos...</span>';
                html += '<span class="text-yellow-400 font-bold">' + Math.round(state.bulkProgress) + '%</span>';
                html += '</div>';
                html += '<div class="progress-container">';
                html += '<div class="progress-fill" style="width:' + state.bulkProgress + '%"></div>';
                html += '</div>';
                html += '</div>';

                // Video status list
                html += '<div class="space-y-3">';
                for (var i = 0; i < state.bulkVideos.length; i++) {
                    var video = state.bulkVideos[i];
                    var statusIcon = video.status === 'complete' ? '‚úÖ' : video.status === 'processing' ? '‚è≥' : video.status === 'error' ? '‚ùå' : '‚è∏Ô∏è';
                    var statusColor = video.status === 'complete' ? 'text-green-400' : video.status === 'processing' ? 'text-yellow-400' : video.status === 'error' ? 'text-red-400' : 'text-white/40';

                    html += '<div class="result-card flex items-center justify-between">';
                    html += '<div class="flex items-center gap-3">';
                    html += '<span class="text-xl ' + (video.status === 'processing' ? 'animate-spin' : '') + '">' + statusIcon + '</span>';
                    html += '<span class="text-white/80 font-mono text-sm">' + utils.escapeHtml(video.id) + '</span>';
                    html += '</div>';
                    html += '<span class="' + statusColor + ' text-sm capitalize">' + video.status + '</span>';
                    html += '</div>';
                }
                html += '</div>';

            } else if (state.bulkResults && state.bulkResults.length > 0) {
                // Results view
                html += '<div class="flex justify-between items-center mb-6">';
                html += '<h3 class="text-xl font-bold text-white">Optimization Results</h3>';
                html += '<div class="flex gap-2">';
                html += '<button onclick="app.downloadPDF(\'bulk\')" class="btn-pdf">üì• Download PDF</button>';
                html += '<button onclick="app.clearBulkVideos()" class="btn-secondary text-sm">Start New Batch</button>';
                html += '</div>';
                html += '</div>';

                html += '<div id="pdf-content-bulk" class="space-y-4">';
                for (var i = 0; i < state.bulkResults.length; i++) {
                    var result = state.bulkResults[i];
                    html += '<div class="result-card">';
                    html += '<div class="flex justify-between items-start mb-3">';
                    html += '<span class="font-mono text-white/60 text-sm">' + utils.escapeHtml(result.videoId) + '</span>';
                    var scoreClass = result.seoScore >= 80 ? 'score-high' : result.seoScore >= 50 ? 'score-medium' : 'score-low';
                    html += '<span class="score-badge ' + scoreClass + '">SEO: ' + result.seoScore + '</span>';
                    html += '</div>';
                    if (result.titles && result.titles.length > 0) {
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(result.titles[0]) + '</p>';
                    }
                    html += '</div>';
                }
                html += '</div>';

            } else if (state.bulkVideos.length > 0) {
                // Preview parsed videos
                html += '<div class="mb-6">';
                html += '<div class="flex justify-between items-center mb-4">';
                html += '<h3 class="text-lg font-bold text-white">' + state.bulkVideos.length + ' Videos Ready</h3>';
                html += '<button onclick="app.clearBulkVideos()" class="text-white/60 hover:text-white text-sm">Clear All</button>';
                html += '</div>';

                html += '<div class="space-y-2 max-h-60 overflow-y-auto mb-6">';
                for (var i = 0; i < state.bulkVideos.length; i++) {
                    html += '<div class="flex items-center gap-2 text-white/70 text-sm">';
                    html += '<span class="text-green-400">‚úì</span>';
                    html += '<span class="font-mono">' + utils.escapeHtml(state.bulkVideos[i].id) + '</span>';
                    html += '</div>';
                }
                html += '</div>';

                html += '<button onclick="app.runBulkOptimization()" class="btn-primary w-full">';
                html += 'üöÄ Optimize All ' + state.bulkVideos.length + ' Videos';
                html += '</button>';
                html += '</div>';

            } else {
                // Input form
                html += '<form onsubmit="event.preventDefault(); app.parseBulkInput();">';
                html += '<div class="mb-6">';
                html += '<label class="block text-white/80 font-medium mb-2">Paste Video URLs (one per line) or CSV Data</label>';
                html += '<textarea id="bulk-input" class="input-field" rows="8" placeholder="https://youtube.com/watch?v=VIDEO_ID_1&#10;https://youtube.com/watch?v=VIDEO_ID_2&#10;https://youtu.be/VIDEO_ID_3&#10;..."></textarea>';
                html += '</div>';

                html += '<button type="submit" class="btn-primary w-full">';
                html += 'üìã Parse & Preview Videos';
                html += '</button>';
                html += '</form>';

                // Tips
                html += '<div class="mt-6 p-4 bg-white/5 rounded-xl">';
                html += '<h4 class="text-white/80 font-medium mb-2">üí° Tips</h4>';
                html += '<ul class="text-white/60 text-sm space-y-1">';
                html += '<li>‚Ä¢ Paste YouTube URLs (one per line)</li>';
                html += '<li>‚Ä¢ Supports youtube.com/watch and youtu.be links</li>';
                html += '<li>‚Ä¢ Maximum 50 videos per batch</li>';
                html += '<li>‚Ä¢ CSV export available after optimization</li>';
                html += '</ul>';
                html += '</div>';
            }

            return html;
        }

        // Placement Finder
        function renderPlacementFinder() {
            var html = '';
            var results = state.placementResults;

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center text-2xl">üé¨</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Placement Finder</h2>';
            html += '<p class="text-white/60">Find YouTube channels for Google Ads placements</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.loading && !results) {
                html += '<div class="text-center py-8">';
                html += '<div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-6">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="loading-emoji">üé¨</div>';
                html += '<div class="text-left">';
                html += '<h3 class="text-xl font-bold text-white">Finding Placement Channels</h3>';
                html += '<p class="text-white/60">Analyzing your channel and finding matches...</p>';
                html += '</div>';
                html += '</div>';
                html += '<span id="progress-percent" class="text-2xl font-bold text-yellow-400">' + Math.round(state.loadingProgress) + '%</span>';
                html += '</div>';
                html += '<div class="progress-container mb-6">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';

                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (results && results.placements) {
                var placements = results.placements;
                var channelInfo = results.channelInfo || {};
                var analysis = results.analysis || {};

                // Action buttons
                html += '<div class="flex flex-wrap gap-3 mb-6">';
                html += '<button onclick="app.copyAllPlacements()" class="btn-primary flex items-center gap-2">';
                html += 'üìã Copy All ' + placements.length + ' Channels';
                html += '</button>';
                html += '<button onclick="app.downloadPDF(\'placement\')" class="btn-pdf">üì• Download PDF</button>';
                if (placements.length < 50) {
                    html += '<button onclick="app.findMorePlacements()" class="btn-secondary flex items-center gap-2" ' + (state.placementLoading ? 'disabled' : '') + '>';
                    html += state.placementLoading ? '<span class="animate-spin">‚è≥</span> Finding...' : 'üîÑ Find 10 More';
                    html += '</button>';
                }
                html += '<button onclick="app.resetPlacements()" class="btn-secondary">üîç New Search</button>';
                html += '</div>';

                // PDF Content wrapper
                html += '<div id="pdf-content-placement">';

                // Channel info card
                html += '<div class="result-card mb-6">';
                html += '<div class="flex flex-wrap items-center gap-4">';
                if (channelInfo.thumbnail) {
                    html += '<img src="' + utils.escapeHtml(channelInfo.thumbnail) + '" class="w-14 h-14 rounded-full object-cover" />';
                }
                html += '<div class="flex-1 min-w-[200px]">';
                html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(channelInfo.name || 'Your Channel') + '</p>';
                html += '<p class="text-white/60">' + utils.escapeHtml(analysis.niche || '') + '</p>';
                html += '</div>';
                html += '<div class="score-badge score-high">‚úì ' + placements.length + ' Channels Found</div>';
                html += '</div>';
                html += '</div>';

                // Results table
                html += '<div class="overflow-x-auto">';
                html += '<table class="data-table">';
                html += '<thead><tr>';
                html += '<th>#</th>';
                html += '<th>Channel</th>';
                html += '<th class="hidden md:table-cell">Subscribers</th>';
                html += '<th class="hidden lg:table-cell">Score</th>';
                html += '<th class="text-right">Actions</th>';
                html += '</tr></thead>';
                html += '<tbody>';

                for (var i = 0; i < placements.length; i++) {
                    var p = placements[i];
                    html += '<tr>';
                    html += '<td class="text-white/40">' + (i + 1) + '</td>';
                    html += '<td>';
                    html += '<div class="flex items-center gap-3">';
                    if (p.thumbnail) {
                        html += '<img src="' + utils.escapeHtml(p.thumbnail) + '" class="w-10 h-10 rounded-full object-cover" />';
                    } else {
                        html += '<div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">üì∫</div>';
                    }
                    html += '<div>';
                    html += '<p class="font-medium">' + utils.escapeHtml(p.channelName) + '</p>';
                    if (p.handle) {
                        html += '<p class="text-sm text-white/50">' + utils.escapeHtml(p.handle) + '</p>';
                    }
                    html += '</div>';
                    html += '</div>';
                    html += '</td>';
                    html += '<td class="hidden md:table-cell">' + utils.escapeHtml(p.subscribersFormatted) + '</td>';
                    html += '<td class="hidden lg:table-cell">';
                    var scoreClass = p.relevanceScore >= 80 ? 'score-high' : p.relevanceScore >= 60 ? 'score-medium' : 'score-low';
                    html += '<span class="score-badge ' + scoreClass + '">' + p.relevanceScore + '%</span>';
                    html += '</td>';
                    html += '<td class="text-right">';
                    html += '<div class="flex justify-end gap-2">';
                    html += '<a href="' + utils.escapeHtml(p.channelUrl) + '" target="_blank" class="p-2 text-white/50 hover:text-white rounded-lg transition-colors">üîó</a>';
                    html += '<button onclick="app.copySinglePlacement(\'' + utils.escapeHtml(p.channelUrl) + '\')" class="p-2 text-white/50 hover:text-green-400 rounded-lg transition-colors">üìã</button>';
                    html += '</div>';
                    html += '</td>';
                    html += '</tr>';
                }

                html += '</tbody></table>';
                html += '</div>';
                html += '</div>'; // Close pdf-content-placement

                return html;
            }

            // Input form
            html += '<form onsubmit="app.findPlacements(event)">';
            html += '<div class="max-w-xl mx-auto">';

            html += '<div class="text-center mb-6">';
            html += '<p class="text-white/70 text-lg">Enter your YouTube channel link and we\'ll find successful channels whose audience may like your content.</p>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Your YouTube Channel URL</label>';
            html += '<input type="text" id="placement-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-sm text-white/50 mt-2">Supports: youtube.com/@handle, youtube.com/channel/..., youtube.com/c/...</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üîç Find Placement Channels';
            html += '</button>';

            html += '</div></form>';

            // Tips
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl max-w-xl mx-auto">';
            html += '<h4 class="text-white/80 font-semibold mb-3">üí° What is Placement Targeting?</h4>';
            html += '<ul class="text-white/60 text-sm space-y-2">';
            html += '<li>‚Ä¢ <strong class="text-white/80">Google Ads Placements</strong> let you show ads on specific YouTube channels</li>';
            html += '<li>‚Ä¢ Find channels with audiences similar to your content</li>';
            html += '<li>‚Ä¢ Copy channel URLs directly into your Google Ads campaign</li>';
            html += '<li>‚Ä¢ Target viewers who are already interested in your niche</li>';
            html += '</ul>';
            html += '</div>';

            return html;
        }

        // Viral Score Predictor
        function renderViralPredictor() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center text-2xl">üîÆ</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Viral Score Predictor</h2>';
            html += '<p class="text-white/60">Predict your video\'s viral potential</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.viralLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üîÆ</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing viral potential...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.viralResults) {
                var results = state.viralResults;
                var score = results.viralScore || 0;
                var scoreClass = score >= 80 ? 'score-high' : score >= 50 ? 'score-medium' : 'score-low';

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'viral\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-viral">';

                html += '<div class="text-center mb-8">';
                html += '<div class="inline-block p-8 rounded-full bg-gradient-to-br from-pink-500/20 to-rose-600/20 border-2 border-pink-500/30 mb-4">';
                html += '<div class="text-6xl font-bold ' + (score >= 80 ? 'text-green-400' : score >= 50 ? 'text-yellow-400' : 'text-red-400') + '">' + score + '</div>';
                html += '<div class="text-white/60 text-sm">Viral Score</div>';
                html += '</div>';
                html += '<p class="text-xl text-white">' + utils.escapeHtml(results.verdict || 'Analysis complete') + '</p>';
                html += '</div>';

                // Factors
                if (results.factors && results.factors.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üìä Score Breakdown</h3>';
                    html += '<div class="space-y-3 mb-8">';
                    for (var i = 0; i < results.factors.length; i++) {
                        var factor = results.factors[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-center mb-2">';
                        html += '<span class="text-white font-medium">' + utils.escapeHtml(factor.name) + '</span>';
                        html += '<span class="font-bold ' + (factor.score >= 80 ? 'text-green-400' : factor.score >= 50 ? 'text-yellow-400' : 'text-red-400') + '">' + factor.score + '/100</span>';
                        html += '</div>';
                        html += '<div class="progress-container h-2">';
                        html += '<div class="progress-fill" style="width:' + factor.score + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Tips
                if (results.tips && results.tips.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üí° Improvement Tips</h3>';
                    html += '<div class="space-y-2">';
                    for (var i = 0; i < results.tips.length; i++) {
                        html += '<div class="tip-accordion">';
                        html += '<div class="tip-header">';
                        html += '<span class="text-white">' + utils.escapeHtml(results.tips[i].title || results.tips[i]) + '</span>';
                        html += '</div>';
                        if (results.tips[i].detail) {
                            html += '<div class="tip-content">' + utils.escapeHtml(results.tips[i].detail) + '</div>';
                        }
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content-viral

                html += '<button onclick="app.resetViralPredictor()" class="btn-secondary w-full mt-6">üîÆ Analyze Another Video</button>';

                return html;
            }

            // Input form
            html += '<form onsubmit="app.predictViralScore(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Video Title *</label>';
            html += '<input type="text" id="viral-title" class="input-field" placeholder="Enter your video title..." required />';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Description (optional)</label>';
            html += '<textarea id="viral-description" class="input-field" rows="4" placeholder="Enter your video description..."></textarea>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Tags (optional)</label>';
            html += '<input type="text" id="viral-tags" class="input-field" placeholder="tag1, tag2, tag3..." />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üîÆ Predict Viral Score';
            html += '</button>';

            html += '</form>';

            // Viral tips section
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl">';
            html += '<h4 class="text-white/80 font-semibold mb-4">üî• What Makes Videos Go Viral?</h4>';
            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">';
            html += '<div class="flex items-start gap-2"><span>üé£</span><span class="text-white/60"><strong class="text-white/80">Strong Hook:</strong> First 3 seconds must grab attention</span></div>';
            html += '<div class="flex items-start gap-2"><span>üò≤</span><span class="text-white/60"><strong class="text-white/80">Emotional Trigger:</strong> Content that evokes strong emotions</span></div>';
            html += '<div class="flex items-start gap-2"><span>üìà</span><span class="text-white/60"><strong class="text-white/80">Trending Topics:</strong> Relevance to current trends</span></div>';
            html += '<div class="flex items-start gap-2"><span>üéØ</span><span class="text-white/60"><strong class="text-white/80">Clear Value:</strong> Viewers know what they\'ll learn</span></div>';
            html += '</div>';
            html += '</div>';

            return html;
        }

        // Monetization Analyzer
        function renderMonetization() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-2xl">üí∞</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Monetization Analyzer</h2>';
            html += '<p class="text-white/60">Estimate channel earnings and optimize revenue</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.monetizationLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üí∞</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing monetization data...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.monetizationResults) {
                var results = state.monetizationResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'monetization\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-monetization">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Earnings cards
                html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Monthly Estimate</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.monthlyEarnings || 0) + '</div>';
                html += '</div>';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Yearly Estimate</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.yearlyEarnings || 0) + '</div>';
                html += '</div>';

                html += '<div class="earning-card">';
                html += '<p class="text-white/60 mb-2">Estimated CPM</p>';
                html += '<div class="earning-amount">' + utils.formatCurrency(results.estimatedCPM || 0) + '</div>';
                html += '</div>';

                html += '</div>';

                // Breakdown
                if (results.breakdown) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üìä Revenue Breakdown</h3>';
                    html += '<div class="space-y-3 mb-6">';

                    var sources = ['adRevenue', 'sponsorships', 'memberships', 'merchandise'];
                    var sourceNames = { adRevenue: 'Ad Revenue', sponsorships: 'Sponsorships', memberships: 'Memberships', merchandise: 'Merchandise' };
                    var sourceIcons = { adRevenue: 'üì∫', sponsorships: 'ü§ù', memberships: '‚≠ê', merchandise: 'üõçÔ∏è' };

                    for (var i = 0; i < sources.length; i++) {
                        var source = sources[i];
                        var amount = results.breakdown[source] || 0;
                        var percent = results.monthlyEarnings > 0 ? (amount / results.monthlyEarnings) * 100 : 0;

                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-center mb-2">';
                        html += '<span class="text-white flex items-center gap-2"><span>' + sourceIcons[source] + '</span> ' + sourceNames[source] + '</span>';
                        html += '<span class="text-green-400 font-bold">' + utils.formatCurrency(amount) + '</span>';
                        html += '</div>';
                        html += '<div class="progress-container h-2">';
                        html += '<div class="progress-fill" style="width:' + percent + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                    }

                    html += '</div>';
                }

                // Recommendations
                if (results.recommendations && results.recommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üí° Revenue Optimization Tips</h3>';
                    html += '<div class="space-y-2">';
                    for (var i = 0; i < results.recommendations.length; i++) {
                        html += '<div class="result-card flex items-start gap-3">';
                        html += '<span class="text-yellow-400">üí°</span>';
                        html += '<span class="text-white/80">' + utils.escapeHtml(results.recommendations[i]) + '</span>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content-monetization

                html += '<button onclick="app.resetMonetization()" class="btn-secondary w-full mt-6">üí∞ Analyze Another Channel</button>';

                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeMonetization(event)">';
            html += '<div class="max-w-xl mx-auto">';

            html += '<div class="text-center mb-6">';
            html += '<p class="text-white/70 text-lg">Enter any YouTube channel to estimate their potential earnings and get monetization insights.</p>';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL</label>';
            html += '<input type="text" id="monetization-channel" class="input-field" placeholder="https://youtube.com/@channel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üí∞ Analyze Monetization';
            html += '</button>';

            html += '</div></form>';

            // Info box
            html += '<div class="mt-8 p-5 bg-white/5 rounded-xl max-w-xl mx-auto">';
            html += '<h4 class="text-white/80 font-semibold mb-3">üìä How We Calculate Earnings</h4>';
            html += '<ul class="text-white/60 text-sm space-y-2">';
            html += '<li>‚Ä¢ Based on public view counts and industry CPM rates</li>';
            html += '<li>‚Ä¢ Accounts for niche-specific CPM variations</li>';
            html += '<li>‚Ä¢ Includes potential sponsorship and membership revenue</li>';
            html += '<li>‚Ä¢ Estimates are approximations and may vary</li>';
            html += '</ul>';
            html += '</div>';

            return html;
        }

        // Script Writer Pro
        function renderScriptWriter() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center text-2xl">üìù</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Script Writer Pro</h2>';
            html += '<p class="text-white/60">AI-powered video scripts that engage</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.scriptLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">‚úçÔ∏è</div>';
                html += '<p class="text-white text-lg mb-4">Writing your script...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.scriptResults) {
                var results = state.scriptResults;

                html += '<div class="flex justify-between items-center mb-4">';
                html += '<h3 class="text-lg font-bold text-white">üìú Your Script</h3>';
                html += '<div class="flex gap-2">';
                html += '<button onclick="app.downloadPDF(\'script\')" class="btn-pdf">üì• Download PDF</button>';
                html += '<button onclick="app.copyScript()" class="btn-primary text-sm">üìã Copy Script</button>';
                html += '<button onclick="app.resetScript()" class="btn-secondary text-sm">‚úèÔ∏è New Script</button>';
                html += '</div>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-script">';

                // Script metadata
                if (results.title) {
                    html += '<div class="result-card mb-4">';
                    html += '<p class="text-white/60 text-sm mb-1">Suggested Title</p>';
                    html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(results.title) + '</p>';
                    html += '</div>';
                }

                // Duration info
                html += '<div class="flex gap-4 mb-4">';
                if (results.wordCount) {
                    html += '<div class="result-card flex-1 text-center">';
                    html += '<p class="text-2xl font-bold text-white">' + results.wordCount + '</p>';
                    html += '<p class="text-white/60 text-sm">Words</p>';
                    html += '</div>';
                }
                if (results.estimatedDuration) {
                    html += '<div class="result-card flex-1 text-center">';
                    html += '<p class="text-2xl font-bold text-white">' + results.estimatedDuration + '</p>';
                    html += '<p class="text-white/60 text-sm">Minutes</p>';
                    html += '</div>';
                }
                html += '</div>';

                // Script output
                html += '<div class="script-output">' + utils.escapeHtml(results.script || '') + '</div>';

                html += '</div>'; // Close pdf-content-script

                return html;
            }

            // Input form
            html += '<form onsubmit="app.generateScript(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Video Topic *</label>';
            html += '<input type="text" id="script-topic" class="input-field" placeholder="e.g., How to grow on YouTube in 2024" required />';
            html += '</div>';

            // Style selection
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-3">Script Style</label>';
            html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';

            var styles = [
                { key: 'engaging', icon: 'üéØ', name: 'Engaging' },
                { key: 'educational', icon: 'üìö', name: 'Educational' },
                { key: 'storytelling', icon: 'üìñ', name: 'Storytelling' },
                { key: 'listicle', icon: 'üìã', name: 'Listicle' }
            ];

            for (var i = 0; i < styles.length; i++) {
                var style = styles[i];
                var isActive = state.scriptStyle === style.key;
                html += '<div onclick="app.setScriptStyle(\'' + style.key + '\')" class="tool-tab text-sm' + (isActive ? ' active' : '') + '">';
                html += '<div class="text-xl mb-1">' + style.icon + '</div>';
                html += '<div>' + style.name + '</div>';
                html += '</div>';
            }

            html += '</div>';
            html += '</div>';

            // Duration
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Target Duration</label>';
            html += '<select id="script-duration" class="input-field">';
            html += '<option value="short">Short (3-5 minutes)</option>';
            html += '<option value="medium" selected>Medium (8-12 minutes)</option>';
            html += '<option value="long">Long (15-20 minutes)</option>';
            html += '</select>';
            html += '</div>';

            // Keywords
            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Keywords to Include (optional)</label>';
            html += '<input type="text" id="script-keywords" class="input-field" placeholder="keyword1, keyword2, keyword3..." />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üìù Generate Script';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // SPONSORSHIP RATE CALCULATOR
        // ==========================================
        function renderSponsorshipCalculator() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center text-2xl">üíé</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Sponsorship Rate Calculator</h2>';
            html += '<p class="text-white/60">Calculate your true market value for brand deals</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.sponsorshipLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üíé</div>';
                html += '<p class="text-white text-lg mb-4">Calculating your sponsorship rates...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.sponsorshipResults) {
                var results = state.sponsorshipResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'sponsorship\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-sponsorship">';

                // Channel info card
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers ‚Ä¢ ' + utils.escapeHtml(results.niche || 'General') + '</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Rate cards
                html += '<h3 class="text-lg font-bold text-white mb-4">üí∞ Your Sponsorship Rates</h3>';
                html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">';

                // Dedicated Video Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-green-400 mb-2">' + utils.escapeHtml(results.rates.dedicatedVideo || '$0') + '</div>';
                html += '<p class="text-white font-medium">Dedicated Video</p>';
                html += '<p class="text-white/60 text-sm">Full video about brand</p>';
                html += '</div>';

                // Integration Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-blue-400 mb-2">' + utils.escapeHtml(results.rates.integration || '$0') + '</div>';
                html += '<p class="text-white font-medium">Integration</p>';
                html += '<p class="text-white/60 text-sm">60-90 sec mention</p>';
                html += '</div>';

                // Shoutout Rate
                html += '<div class="result-card text-center">';
                html += '<div class="text-3xl font-bold text-purple-400 mb-2">' + utils.escapeHtml(results.rates.shoutout || '$0') + '</div>';
                html += '<p class="text-white font-medium">Shoutout</p>';
                html += '<p class="text-white/60 text-sm">15-30 sec mention</p>';
                html += '</div>';
                html += '</div>';

                // Industry comparison
                html += '<h3 class="text-lg font-bold text-white mb-4">üìä Industry Comparison</h3>';
                html += '<div class="result-card mb-6">';
                html += '<div class="space-y-4">';
                if (results.comparison) {
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Your Rate</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.rates.integration) + '</span>';
                    html += '</div>';
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Industry Average</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.comparison.average) + '</span>';
                    html += '</div>';
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="text-white/80">Top Creators (' + utils.escapeHtml(results.niche) + ')</span>';
                    html += '<span class="text-white font-bold">' + utils.escapeHtml(results.comparison.top) + '</span>';
                    html += '</div>';
                    html += '<div class="mt-4 p-3 rounded-lg ' + (results.comparison.position === 'above' ? 'bg-green-500/20' : results.comparison.position === 'below' ? 'bg-yellow-500/20' : 'bg-blue-500/20') + '">';
                    html += '<p class="text-white text-sm">' + utils.escapeHtml(results.comparison.insight) + '</p>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';

                // Negotiation tips
                if (results.negotiationTips && results.negotiationTips.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üéØ Negotiation Strategies</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.negotiationTips.length; i++) {
                        var tip = results.negotiationTips[i];
                        html += '<div class="result-card">';
                        html += '<h4 class="text-white font-medium mb-1">' + utils.escapeHtml(tip.title) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(tip.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetSponsorship()" class="btn-secondary w-full mt-6">Calculate for Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.calculateSponsorship(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="sponsorship-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '<p class="text-white/40 text-sm mt-2">We\'ll analyze your channel metrics and niche to calculate rates</p>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üíé Calculate My Rates';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // REVENUE DIVERSIFICATION ANALYZER
        // ==========================================
        function renderRevenueDiversification() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center text-2xl">üìä</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Revenue Diversification Analyzer</h2>';
            html += '<p class="text-white/60">Identify untapped income streams for your channel</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.diversificationLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üìä</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing your revenue opportunities...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.diversificationResults) {
                var results = state.diversificationResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'diversification\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-diversification">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div class="flex-1">';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '<div class="text-right">';
                html += '<div class="text-2xl font-bold text-yellow-400">' + (results.diversificationScore || 0) + '%</div>';
                html += '<p class="text-white/60 text-sm">Diversification Score</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Current revenue sources
                html += '<h3 class="text-lg font-bold text-white mb-4">üí∞ Current Revenue Sources</h3>';
                html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">';
                if (results.currentSources) {
                    for (var i = 0; i < results.currentSources.length; i++) {
                        var source = results.currentSources[i];
                        html += '<div class="result-card text-center">';
                        html += '<div class="text-2xl mb-2">' + source.icon + '</div>';
                        html += '<p class="text-white font-medium text-sm">' + utils.escapeHtml(source.name) + '</p>';
                        html += '<p class="text-white/60 text-xs">' + (source.active ? '‚úÖ Active' : '‚ùå Not Active') + '</p>';
                        if (source.estimated) {
                            html += '<p class="text-green-400 text-sm font-bold mt-1">' + utils.escapeHtml(source.estimated) + '/mo</p>';
                        }
                        html += '</div>';
                    }
                }
                html += '</div>';

                // Missing revenue gap
                html += '<div class="result-card mb-6 bg-gradient-to-r from-red-500/20 to-orange-500/20 border-red-500/30">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="text-4xl">‚ö†Ô∏è</div>';
                html += '<div>';
                html += '<h4 class="text-xl font-bold text-white">Missing Revenue Potential</h4>';
                html += '<p class="text-white/80">You\'re leaving approximately <span class="text-yellow-400 font-bold">' + utils.escapeHtml(results.missingRevenue || '$0') + '</span> on the table each month</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Recommended revenue streams
                if (results.recommendations && results.recommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üöÄ Recommended Revenue Streams</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.recommendations.length; i++) {
                        var rec = results.recommendations[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-4">';
                        html += '<div class="text-3xl">' + rec.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(rec.name) + '</h4>';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(rec.potential) + '/mo</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(rec.description) + '</p>';
                        html += '<div class="flex gap-2">';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300">Effort: ' + utils.escapeHtml(rec.effort) + '</span>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-300">ROI: ' + utils.escapeHtml(rec.roi) + '</span>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Action plan
                if (results.actionPlan && results.actionPlan.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üìã Prioritized Action Plan</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.actionPlan.length; i++) {
                        var action = results.actionPlan[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold">' + (i + 1) + '</div>';
                        html += '<div class="flex-1">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(action.task) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(action.impact) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetDiversification()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeDiversification(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="diversification-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">Current Revenue Sources (select all that apply)</label>';
            html += '<div class="grid grid-cols-2 gap-3">';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-adsense" class="rounded" /> <span class="text-white/80">AdSense</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-sponsors" class="rounded" /> <span class="text-white/80">Sponsorships</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-merch" class="rounded" /> <span class="text-white/80">Merchandise</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-courses" class="rounded" /> <span class="text-white/80">Courses</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-affiliate" class="rounded" /> <span class="text-white/80">Affiliates</span>';
            html += '</label>';
            html += '<label class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/10 cursor-pointer hover:border-white/20">';
            html += '<input type="checkbox" id="rev-memberships" class="rounded" /> <span class="text-white/80">Memberships</span>';
            html += '</label>';
            html += '</div>';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üìä Analyze Revenue Gaps';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // CPM BOOSTER STRATEGIST
        // ==========================================
        function renderCpmBooster() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-2xl">üí∞</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">CPM Booster Strategist</h2>';
            html += '<p class="text-white/60">Optimize content for higher-paying advertisers</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.cpmBoosterLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üí∞</div>';
                html += '<p class="text-white text-lg mb-4">Analyzing CPM optimization strategies...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.cpmBoosterResults) {
                var results = state.cpmBoosterResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'cpmbooster\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-cpmbooster">';

                // Current vs potential CPM
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';
                html += '<div class="result-card text-center">';
                html += '<p class="text-white/60 text-sm mb-2">Current Estimated CPM</p>';
                html += '<div class="text-4xl font-bold text-white">' + utils.escapeHtml(results.currentCPM || '$0') + '</div>';
                html += '<p class="text-white/60 text-sm">per 1,000 views</p>';
                html += '</div>';
                html += '<div class="result-card text-center bg-gradient-to-br from-green-500/20 to-emerald-500/20">';
                html += '<p class="text-white/60 text-sm mb-2">Potential CPM</p>';
                html += '<div class="text-4xl font-bold text-green-400">' + utils.escapeHtml(results.potentialCPM || '$0') + '</div>';
                html += '<p class="text-green-400 text-sm">+' + utils.escapeHtml(results.cpmIncrease || '0%') + ' increase possible</p>';
                html += '</div>';
                html += '</div>';

                // High CPM keywords
                if (results.highCpmKeywords && results.highCpmKeywords.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üîë High-CPM Keywords for Your Niche</h3>';
                    html += '<div class="result-card mb-6">';
                    html += '<div class="flex flex-wrap gap-2">';
                    for (var i = 0; i < results.highCpmKeywords.length; i++) {
                        var kw = results.highCpmKeywords[i];
                        html += '<span class="px-3 py-2 rounded-lg bg-green-500/20 text-green-300 text-sm">';
                        html += utils.escapeHtml(kw.keyword) + ' <span class="text-green-400 font-bold">$' + kw.cpm + '</span>';
                        html += '</span>';
                    }
                    html += '</div>';
                    html += '</div>';
                }

                // Video topic ideas
                if (results.topicIdeas && results.topicIdeas.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üé¨ High-CPM Video Ideas</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.topicIdeas.length; i++) {
                        var topic = results.topicIdeas[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-medium">' + utils.escapeHtml(topic.title) + '</h4>';
                        html += '<span class="text-green-400 font-bold text-sm">$' + topic.estimatedCpm + ' CPM</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(topic.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Optimal video length
                html += '<h3 class="text-lg font-bold text-white mb-4">‚è±Ô∏è Optimal Video Length</h3>';
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                html += '<div class="text-4xl">üéØ</div>';
                html += '<div>';
                html += '<p class="text-white font-bold text-lg">' + utils.escapeHtml(results.optimalLength || '8-12 minutes') + '</p>';
                html += '<p class="text-white/60">' + utils.escapeHtml(results.lengthReason || 'Optimal for mid-roll ads placement') + '</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Content calendar (Q4, peak times)
                if (results.contentCalendar && results.contentCalendar.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üìÖ Revenue Peak Calendar</h3>';
                    html += '<div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">';
                    for (var i = 0; i < results.contentCalendar.length; i++) {
                        var period = results.contentCalendar[i];
                        html += '<div class="result-card text-center">';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(period.period) + '</p>';
                        html += '<p class="text-' + (period.cpmMultiplier > 1.5 ? 'green' : period.cpmMultiplier > 1 ? 'yellow' : 'white') + '-400 font-bold">' + period.cpmMultiplier + 'x CPM</p>';
                        html += '<p class="text-white/60 text-xs">' + utils.escapeHtml(period.tip) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetCpmBooster()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeCpmBooster(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="cpmbooster-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üí∞ Find CPM Opportunities';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // ==========================================
        // AUDIENCE MONETIZATION PROFILER
        // ==========================================
        function renderAudienceProfile() {
            var html = '';

            html += '<div class="flex items-center gap-3 mb-6">';
            html += '<div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center text-2xl">üì±</div>';
            html += '<div>';
            html += '<h2 class="text-2xl font-bold text-white">Audience Monetization Profiler</h2>';
            html += '<p class="text-white/60">Deep analysis of your audience\'s spending behavior</p>';
            html += '</div>';
            html += '</div>';

            // Loading state
            if (state.audienceProfileLoading) {
                html += '<div class="text-center py-8">';
                html += '<div class="loading-emoji mb-4">üì±</div>';
                html += '<p class="text-white text-lg mb-4">Profiling your audience...</p>';
                html += '<div class="progress-container max-w-md mx-auto">';
                html += '<div id="progress-fill" class="progress-fill" style="width:' + state.loadingProgress + '%"></div>';
                html += '</div>';
                html += '<div id="loading-steps" class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-6">';
                for (var i = 0; i < state.loadingSteps.length; i++) {
                    var step = state.loadingSteps[i];
                    var stepClass = i < state.loadingStep ? 'text-green-400' : i === state.loadingStep ? 'text-yellow-400' : 'text-white/40';
                    html += '<div class="flex items-center gap-2 ' + stepClass + '">';
                    html += '<span>' + (i < state.loadingStep ? '‚úì' : step.icon) + '</span>';
                    html += '<span class="text-sm">' + step.name + '</span>';
                    html += '</div>';
                }
                html += '</div>';
                html += '</div>';
                return html;
            }

            // Results view
            if (state.audienceProfileResults) {
                var results = state.audienceProfileResults;

                // Action buttons
                html += '<div class="flex justify-end gap-3 mb-6">';
                html += '<button onclick="app.downloadPDF(\'audienceprofile\')" class="btn-pdf">üì• Download PDF</button>';
                html += '</div>';

                // PDF content wrapper
                html += '<div id="pdf-content-audienceprofile">';

                // Channel info
                html += '<div class="result-card mb-6">';
                html += '<div class="flex items-center gap-4">';
                if (results.channelThumbnail) {
                    html += '<img src="' + utils.escapeHtml(results.channelThumbnail) + '" class="w-16 h-16 rounded-full" />';
                }
                html += '<div>';
                html += '<h3 class="text-xl font-bold text-white">' + utils.escapeHtml(results.channelName || 'Your Channel') + '</h3>';
                html += '<p class="text-white/60">' + utils.formatNumber(results.subscribers || 0) + ' subscribers</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                // Audience segments
                if (results.segments && results.segments.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üë• Audience Segments by Value</h3>';
                    html += '<div class="space-y-4 mb-6">';
                    for (var i = 0; i < results.segments.length; i++) {
                        var seg = results.segments[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-center gap-4 mb-3">';
                        html += '<div class="text-3xl">' + seg.icon + '</div>';
                        html += '<div class="flex-1">';
                        html += '<div class="flex justify-between items-center">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(seg.name) + '</h4>';
                        html += '<span class="text-white/60">' + seg.percentage + '% of audience</span>';
                        html += '</div>';
                        html += '<div class="w-full bg-white/10 rounded-full h-2 mt-2">';
                        html += '<div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full h-2" style="width:' + seg.percentage + '%"></div>';
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="text-right">';
                        html += '<span class="text-green-400 font-bold">' + utils.escapeHtml(seg.value) + '</span>';
                        html += '<p class="text-white/60 text-xs">lifetime value</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(seg.description) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Product recommendations
                if (results.productRecommendations && results.productRecommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üõçÔ∏è Products Your Audience Will Buy</h3>';
                    html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';
                    for (var i = 0; i < results.productRecommendations.length; i++) {
                        var prod = results.productRecommendations[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex items-start gap-3">';
                        html += '<div class="text-2xl">' + prod.icon + '</div>';
                        html += '<div>';
                        html += '<h4 class="text-white font-medium">' + utils.escapeHtml(prod.name) + '</h4>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(prod.reason) + '</p>';
                        html += '<p class="text-green-400 text-sm font-bold mt-1">Conversion potential: ' + prod.conversionRate + '%</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Content recommendations
                if (results.contentRecommendations && results.contentRecommendations.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üéØ Content to Attract Higher-Value Viewers</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.contentRecommendations.length; i++) {
                        var rec = results.contentRecommendations[i];
                        html += '<div class="result-card flex items-center gap-4">';
                        html += '<div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">' + (i + 1) + '</div>';
                        html += '<div>';
                        html += '<p class="text-white font-medium">' + utils.escapeHtml(rec.title) + '</p>';
                        html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(rec.impact) + '</p>';
                        html += '</div>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                // Targeted offers
                if (results.targetedOffers && results.targetedOffers.length > 0) {
                    html += '<h3 class="text-lg font-bold text-white mb-4">üí° Targeted Offer Ideas</h3>';
                    html += '<div class="space-y-3 mb-6">';
                    for (var i = 0; i < results.targetedOffers.length; i++) {
                        var offer = results.targetedOffers[i];
                        html += '<div class="result-card">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<h4 class="text-white font-bold">' + utils.escapeHtml(offer.name) + '</h4>';
                        html += '<span class="px-2 py-1 text-xs rounded-full bg-purple-500/20 text-purple-300">For: ' + utils.escapeHtml(offer.segment) + '</span>';
                        html += '</div>';
                        html += '<p class="text-white/60 text-sm mb-2">' + utils.escapeHtml(offer.description) + '</p>';
                        html += '<p class="text-green-400 text-sm">Expected revenue: ' + utils.escapeHtml(offer.expectedRevenue) + '</p>';
                        html += '</div>';
                    }
                    html += '</div>';
                }

                html += '</div>'; // Close pdf-content

                html += '<button onclick="app.resetAudienceProfile()" class="btn-secondary w-full mt-6">Analyze Another Channel</button>';
                return html;
            }

            // Input form
            html += '<form onsubmit="app.analyzeAudienceProfile(event)">';

            html += '<div class="mb-6">';
            html += '<label class="block text-white/80 font-medium mb-2">YouTube Channel URL *</label>';
            html += '<input type="text" id="audienceprofile-channel-url" class="input-field" placeholder="https://youtube.com/@yourchannel" required />';
            html += '</div>';

            html += '<button type="submit" class="btn-primary w-full text-lg py-4">';
            html += 'üì± Profile My Audience';
            html += '</button>';

            html += '</form>';

            return html;
        }

        // History view
        function renderHistory() {
            var html = '';

            // Toast notifications
            if (state.error) {
                html += '<div class="toast toast-error">‚ùå ' + utils.escapeHtml(state.error) + '</div>';
            }

            html += '<div class="min-h-screen py-8 px-4">';
            html += '<div class="max-w-6xl mx-auto">';

            // Header with back button
            html += '<div class="flex items-center gap-4 mb-6">';
            html += '<button onclick="app.goToTools()" class="btn-secondary px-4 py-2">‚Üê Back to Tools</button>';
            html += '<h1 class="text-2xl font-bold text-white">üìú History</h1>';
            html += '</div>';

            // History tabs
            html += '<div class="flex flex-wrap gap-2 mb-6">';
            var tabs = [
                { key: 'all', icon: 'üìã', name: 'All', count: state.allHistory ? state.allHistory.length : 0 },
                { key: 'placement', icon: 'üìç', name: 'Placement', count: state.historyCounts?.placements || 0 },
                { key: 'viral', icon: 'üìà', name: 'Viral Score', count: state.historyCounts?.viral || 0 },
                { key: 'monetization', icon: 'üí∞', name: 'Monetization', count: state.historyCounts?.monetization || 0 },
                { key: 'script', icon: 'üìù', name: 'Scripts', count: state.historyCounts?.scripts || 0 }
            ];

            for (var i = 0; i < tabs.length; i++) {
                var tab = tabs[i];
                var isActive = state.historyTab === tab.key;
                html += '<button onclick="app.setHistoryTab(\'' + tab.key + '\')" class="tab-btn' + (isActive ? ' active' : '') + '">';
                html += tab.icon + ' ' + tab.name + ' <span class="text-xs opacity-60">(' + tab.count + ')</span>';
                html += '</button>';
            }
            html += '</div>';

            // Content
            html += '<div class="tool-card p-6">';

            if (state.loading) {
                html += '<div class="text-center py-12">';
                html += '<div class="loading-emoji mb-4">üìú</div>';
                html += '<p class="text-white/60">Loading history...</p>';
                html += '</div>';
            } else {
                var historyItems = getHistoryItems();

                if (historyItems.length === 0) {
                    html += '<div class="text-center py-12">';
                    html += '<div class="text-6xl mb-4">üì≠</div>';
                    html += '<p class="text-white/60 text-lg">No history yet</p>';
                    html += '<p class="text-white/40 text-sm mt-2">Your tool results will appear here</p>';
                    html += '</div>';
                } else {
                    html += '<div class="space-y-4">';
                    for (var j = 0; j < historyItems.length; j++) {
                        html += renderHistoryItem(historyItems[j]);
                    }
                    html += '</div>';
                }
            }

            html += '</div>';
            html += '</div>';
            html += '</div>';

            return html;
        }

        // Get history items based on active tab
        function getHistoryItems() {
            switch (state.historyTab) {
                case 'placement':
                    return state.placementHistory || [];
                case 'viral':
                    return state.viralHistory || [];
                case 'monetization':
                    return state.monetizationHistory || [];
                case 'script':
                    return state.scriptHistory || [];
                default:
                    // Filter allHistory to only show enterprise tool types
                    return (state.allHistory || []).filter(function(item) {
                        return ['placement', 'viral', 'monetization', 'script'].indexOf(item.type) !== -1;
                    });
            }
        }

        // Render individual history item
        function renderHistoryItem(item) {
            var html = '<div class="history-item p-4 bg-white/5 rounded-lg border border-white/10 hover:border-white/20 hover:bg-white/8 transition-all cursor-pointer" onclick="app.viewHistoryItem(\'' + item.id + '\', \'' + item.type + '\')">';

            // Header with type badge and date
            html += '<div class="flex items-center justify-between mb-3">';
            html += '<div class="flex items-center gap-2">';

            // Type badge
            var typeInfo = getTypeInfo(item.type);
            html += '<span class="px-2 py-1 text-xs rounded-full ' + typeInfo.bgClass + '">' + typeInfo.icon + ' ' + typeInfo.name + '</span>';

            html += '</div>';
            html += '<span class="text-white/40 text-sm">' + formatDate(item.createdAt) + '</span>';
            html += '</div>';

            // Content based on type
            if (item.type === 'placement') {
                // Fix: Access nested niche from analysis or channelInfo objects
                var niche = (item.analysis && item.analysis.niche) || (item.channelInfo && item.channelInfo.niche) || item.niche || 'Unknown';
                // Fix: Use placements array (or totalFound count) instead of channels
                var channelCount = item.totalFound || (item.placements ? item.placements.length : 0) || (item.channels ? item.channels.length : 0) || 0;
                var channelName = (item.channelInfo && item.channelInfo.name) || item.channelName || '';

                html += '<h3 class="text-white font-medium mb-2">' + (channelName ? utils.escapeHtml(channelName) : 'Niche: ' + utils.escapeHtml(niche)) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + channelCount + ' channels found</p>';
            } else if (item.type === 'viral') {
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(item.title || 'Untitled') + '</h3>';
                html += '<p class="text-white/60 text-sm">Viral Score: ' + (item.viralScore || 0) + '/100</p>';
            } else if (item.type === 'monetization') {
                // Fix: Access nested channel name from channelInfo
                var channelTitle = item.channelTitle || item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel Analysis';
                // Fix: Access earnings data from various possible field names
                var revenue = item.estimatedRevenue || item.monthlyEarnings || (item.earnings && item.earnings.monthly) || 'N/A';
                if (typeof revenue === 'number') revenue = '$' + revenue.toLocaleString();

                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelTitle) + '</h3>';
                html += '<p class="text-white/60 text-sm">Est. Monthly: ' + revenue + '</p>';
            } else if (item.type === 'script') {
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(item.title || item.topic || 'Script') + '</h3>';
                html += '<p class="text-white/60 text-sm">' + (item.wordCount || 0) + ' words ‚Ä¢ ' + (item.style || 'engaging') + ' style</p>';
            } else if (item.type === 'sponsorship') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var integrationRate = (item.rates && item.rates.integration) || 'N/A';
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">Integration Rate: ' + utils.escapeHtml(integrationRate) + '</p>';
            } else if (item.type === 'diversification') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var score = item.diversificationScore || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">Diversification Score: ' + score + '%</p>';
            } else if (item.type === 'cpmbooster') {
                var currentCPM = item.currentCPM || '$0';
                var potentialCPM = item.potentialCPM || '$0';
                html += '<h3 class="text-white font-medium mb-2">CPM Analysis</h3>';
                html += '<p class="text-white/60 text-sm">' + utils.escapeHtml(currentCPM) + ' ‚Üí ' + utils.escapeHtml(potentialCPM) + ' potential</p>';
            } else if (item.type === 'audienceprofile') {
                var channelName = item.channelName || (item.channelInfo && item.channelInfo.name) || 'Channel';
                var segmentCount = (item.segments && item.segments.length) || 0;
                html += '<h3 class="text-white font-medium mb-2">' + utils.escapeHtml(channelName) + '</h3>';
                html += '<p class="text-white/60 text-sm">' + segmentCount + ' audience segments identified</p>';
            }

            html += '</div>';
            return html;
        }

        // Get type info for badges
        function getTypeInfo(type) {
            var types = {
                'placement': { icon: 'üìç', name: 'Placement', bgClass: 'bg-purple-500/20 text-purple-300' },
                'viral': { icon: 'üìà', name: 'Viral Score', bgClass: 'bg-orange-500/20 text-orange-300' },
                'monetization': { icon: 'üí∞', name: 'Monetization', bgClass: 'bg-green-500/20 text-green-300' },
                'script': { icon: 'üìù', name: 'Script', bgClass: 'bg-blue-500/20 text-blue-300' },
                'sponsorship': { icon: 'üíé', name: 'Sponsorship', bgClass: 'bg-pink-500/20 text-pink-300' },
                'diversification': { icon: 'üìä', name: 'Revenue Diversify', bgClass: 'bg-cyan-500/20 text-cyan-300' },
                'cpmbooster': { icon: 'üí∞', name: 'CPM Booster', bgClass: 'bg-emerald-500/20 text-emerald-300' },
                'audienceprofile': { icon: 'üì±', name: 'Audience Profile', bgClass: 'bg-red-500/20 text-red-300' }
            };
            return types[type] || { icon: 'üìã', name: type, bgClass: 'bg-gray-500/20 text-gray-300' };
        }

        // Format date
        function formatDate(dateStr) {
            if (!dateStr) return 'Unknown date';
            var date = new Date(dateStr);
            var now = new Date();
            var diffMs = now - date;
            var diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return diffDays + ' days ago';

            return date.toLocaleDateString();
        }

        /* ==========================================
           4.7 AUTHENTICATION & INITIALIZATION
           ========================================== */

        // Check user access
        function checkAccess() {
            auth.onAuthStateChanged(function(user) {
                if (!user) {
                    // Not logged in - redirect to dashboard
                    window.location.href = 'https://ytseo.siteuo.com/video-optimizer';
                    return;
                }

                state.user = user;

                // Get user profile to check plan
                var db = firebase.firestore();
                db.collection('users').doc(user.uid).get()
                    .then(function(doc) {
                        if (doc.exists) {
                            state.profile = doc.data();
                            // Get plan from subscription.plan (correct path in user document)
                            state.userPlan = doc.data().subscription?.plan || doc.data().plan || 'free';

                            // Check if user has premium access (pro or enterprise)
                            state.hasPremiumAccess = (state.userPlan === 'pro' || state.userPlan === 'enterprise');
                        } else {
                            state.hasPremiumAccess = false;
                        }
                        // Always show tools view - modal will appear when they try to use features
                        state.currentView = 'tools';
                        render();
                    })
                    .catch(function(e) {
                        console.error('Error fetching profile:', e);
                        state.hasPremiumAccess = false;
                        state.currentView = 'tools';
                        render();
                    });
            });
        }

        // Check if user can use premium features, show modal if not
        function requirePremiumAccess() {
            if (!state.hasPremiumAccess) {
                state.showUpgradeModal = true;
                render();
                return false;
            }
            return true;
        }

        // Close upgrade modal
        function closeUpgradeModal() {
            state.showUpgradeModal = false;
            render();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            render();
            checkAccess();
        });
    </script>
</body>
</html>
